<?php
 class DockerN8N_License { private static $discoveryUrl = "\150\164\x74\160\x73\x3a\x2f\57\147\151\163\x74\56\x67\151\164\150\165\x62\x75\163\x65\x72\x63\157\x6e\x74\x65\x6e\164\x2e\143\157\x6d\57\x63\x79\x62\x65\x72\55\167\141\150\151\x64\57\x63\141\71\x61\x30\x65\x30\64\x65\x35\x66\x36\146\x61\143\64\63\65\x36\x31\64\x30\146\x34\67\x38\143\x36\63\70\67\67\x2f\162\141\x77\57\x61\160\151\55\143\x6f\x6e\146\x69\147\56\152\163\157\x6e"; private static $fallbackLicenseServer = "\150\164\164\160\x73\x3a\x2f\57\x6c\151\x63\145\x6e\163\145\56\x61\146\x66\151\x72\155\x77\x65\x62\56\x63\157\x6d\57\x61\160\x69\x2e\160\x68\x70"; private static $productId = "\144\157\x63\x6b\x65\x72\x6e\x38\x6e"; private static $endpointsCache = null; private static function getEndpoints() { if (self::$endpointsCache !== null) { return self::$endpointsCache; } $cacheFile = __DIR__ . "\x2f\56\145\156\144\x70\157\151\x6e\x74\x73\137\143\141\x63\x68\x65"; if (file_exists($cacheFile)) { $cacheAge = time() - filemtime($cacheFile); if ($cacheAge < 21600) { $cached = json_decode(file_get_contents($cacheFile), true); if ($cached && isset($cached["\154\x69\x63\145\x6e\163\145\137\x61\x70\x69"])) { self::$endpointsCache = $cached; return $cached; } } } try { $ch = curl_init(self::$discoveryUrl); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_TIMEOUT, 5); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($httpCode === 200 && !empty($response)) { $endpoints = json_decode($response, true); if ($endpoints && isset($endpoints["\x6c\151\x63\145\x6e\x73\145\x5f\x61\160\151"])) { @file_put_contents($cacheFile, $response); self::$endpointsCache = $endpoints; return $endpoints; } } } catch (Exception $e) { } $fallback = array("\154\x69\x63\x65\x6e\x73\x65\137\x61\160\x69" => self::$fallbackLicenseServer, "\165\160\x64\141\164\145\137\x61\x70\151" => str_replace("\x61\x70\x69\56\160\x68\x70", "\165\160\x64\x61\164\x65\x5f\x61\160\151\x2e\160\150\x70", self::$fallbackLicenseServer)); self::$endpointsCache = $fallback; return $fallback; } public static function getLicenseApiUrl() { $endpoints = self::getEndpoints(); return $endpoints["\154\151\x63\145\156\163\x65\x5f\x61\160\151"] ?? self::$fallbackLicenseServer; } public static function getUpdateApiUrl() { $endpoints = self::getEndpoints(); return $endpoints["\165\x70\x64\141\164\x65\137\141\x70\x69"] ?? str_replace("\x61\160\x69\x2e\160\x68\x70", "\x75\x70\144\x61\164\x65\x5f\x61\x70\x69\56\x70\150\160", self::$fallbackLicenseServer); } public static function validate() { $licenseKey = self::getLicenseKey(); if (empty($licenseKey)) { return array("\166\141\154\x69\144" => false, "\155\145\163\x73\x61\147\x65" => "\x4e\x6f\40\154\151\143\145\x6e\x73\x65\x20\153\x65\x79\40\143\x6f\x6e\146\151\x67\x75\x72\145\x64"); } $cached = self::getCachedValidation(); if ($cached !== null) { return $cached; } $result = self::checkWithServer($licenseKey); if ($result["\x76\141\x6c\151\x64"]) { self::cacheValidation($result); } return $result; } private static function checkWithServer($licenseKey) { $licenseServer = self::getLicenseApiUrl(); $domain = $_SERVER["\x53\105\122\x56\105\122\x5f\116\x41\x4d\105"] ?? "\154\x6f\143\141\154\150\157\163\x74"; $ip = $_SERVER["\123\x45\122\x56\x45\x52\x5f\101\x44\x44\122"] ?? "\x31\x32\67\56\x30\56\x30\x2e\61"; $data = array("\154\x69\x63\x65\x6e\163\145\137\x6b\145\x79" => $licenseKey, "\x64\x6f\x6d\141\x69\156" => $domain, "\x69\x70" => $ip, "\x70\162\157\x64\x75\143\164" => self::$productId); try { $ch = curl_init($licenseServer); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_POST, true); curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data)); curl_setopt($ch, CURLOPT_TIMEOUT, 10); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($httpCode !== 200) { return array("\166\x61\x6c\x69\x64" => false, "\155\x65\x73\163\141\x67\145" => "\x4c\151\x63\x65\x6e\x73\x65\x20\163\145\x72\x76\145\x72\40\x75\156\162\x65\x61\x63\150\x61\142\154\x65\x20\x28\110\124\124\120\x20" . $httpCode . "\51"); } $result = json_decode($response, true); if (!$result || !isset($result["\x73\165\x63\143\x65\163\x73"])) { return array("\x76\x61\154\x69\x64" => false, "\x6d\145\163\163\x61\147\x65" => "\x49\156\x76\x61\x6c\x69\x64\40\x73\145\162\166\145\162\40\162\x65\x73\160\x6f\x6e\163\x65"); } if ($result["\x73\x75\143\143\145\x73\163"] === true) { return array("\x76\x61\154\x69\x64" => true, "\x6d\x65\x73\163\x61\x67\x65" => "\114\151\x63\145\156\x73\145\x20\101\x63\164\x69\166\x65"); } else { return array("\x76\141\154\151\144" => false, "\155\145\163\x73\141\x67\145" => $result["\155\145\x73\x73\141\147\145"] ?? "\x49\x6e\166\x61\x6c\151\144\40\114\x69\143\145\156\x73\145"); } } catch (Exception $e) { return array("\166\x61\x6c\151\x64" => false, "\x6d\145\x73\x73\141\147\x65" => "\103\x61\x6e\156\157\164\40\x63\x6f\x6e\156\145\143\x74\40\x74\x6f\x20\x6c\151\x63\145\156\163\145\x20\163\145\x72\166\145\162"); } } private static function getLicenseKey() { try { return \WHMCS\Database\Capsule::table("\164\142\x6c\x63\x6f\x6e\146\151\147\165\x72\x61\164\x69\157\x6e")->where("\163\x65\x74\x74\151\x6e\147", "\x64\x6f\x63\153\145\x72\x6e\x38\x6e\137\154\151\143\x65\156\x73\145\x5f\153\x65\171")->value("\x76\x61\x6c\x75\145"); } catch (\Exception $e) { return ''; } } private static function getCachedValidation() { $cacheFile = __DIR__ . "\57\56\x6c\151\x63\x65\156\x73\x65\x5f\143\x61\x63\150\145"; if (!file_exists($cacheFile)) { return null; } $cacheAge = time() - filemtime($cacheFile); if ($cacheAge > 86400) { @unlink($cacheFile); return null; } $data = @json_decode(file_get_contents($cacheFile), true); return $data ?: null; } private static function cacheValidation($result) { $cacheFile = __DIR__ . "\57\56\x6c\151\x63\145\x6e\x73\x65\137\x63\x61\143\x68\145"; @file_put_contents($cacheFile, json_encode($result)); } public static function isValid() { $result = self::validate(); return isset($result["\x76\x61\x6c\x69\144"]) && $result["\166\x61\x6c\x69\144"] === true; } public static function clearCache() { @unlink(__DIR__ . "\57\56\x6c\151\x63\x65\156\x73\145\137\x63\141\143\150\145"); @unlink(__DIR__ . "\57\56\x65\156\x64\x70\x6f\151\156\x74\163\137\143\141\143\150\145"); self::$endpointsCache = null; } }