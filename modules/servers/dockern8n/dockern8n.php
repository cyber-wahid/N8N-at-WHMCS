<?php
 if (!defined("\x57\x48\115\x43\x53")) { die("\124\150\151\x73\40\146\x69\x6c\145\40\x63\141\x6e\x6e\x6f\x74\x20\x62\145\x20\x61\143\143\x65\163\x73\x65\x64\x20\144\151\x72\x65\x63\x74\154\x79"); } define("\104\x4f\103\113\x45\x52\116\70\116\137\126\105\x52\x53\111\x4f\116", "\62\x2e\x30"); define("\x44\x4f\103\x4b\105\x52\116\70\116\x5f\x47\111\124\x48\125\102\x5f\x52\105\120\117", "\143\x79\x62\145\162\55\x77\x61\150\151\x64\x2f\x4e\70\x4e\55\141\x74\x2d\x57\110\115\103\x53"); define("\x44\x4f\103\113\x45\122\x4e\x38\x4e\x5f\x55\x50\x44\101\124\105\x5f\125\x52\x4c", "\150\x74\x74\160\163\x3a\57\x2f\x61\x70\151\x2e\147\x69\x74\150\x75\142\x2e\x63\157\x6d\57\x72\145\160\157\163\57\143\x79\x62\145\162\55\167\141\x68\x69\144\57\x4e\x38\x4e\x2d\x61\x74\x2d\x57\x48\x4d\103\123\x2f\162\145\154\145\141\163\145\x73\57\154\141\x74\x65\163\164"); define("\104\117\x43\113\x45\x52\116\x38\116\x5f\104\x45\102\125\x47\137\x4c\117\x47\x47\111\116\107", false); require_once __DIR__ . "\57\103\157\x72\145\56\x70\x68\160"; require_once __DIR__ . "\x2f\154\x69\x63\145\x6e\163\x65\56\160\150\x70"; require_once __DIR__ . "\57\x44\x6f\143\153\145\x72\x41\x50\x49\56\x70\x68\x70"; require_once __DIR__ . "\57\104\x6f\155\x61\x69\x6e\x48\145\x6c\160\x65\162\x73\x2e\160\x68\x70"; require_once __DIR__ . "\x2f\116\x67\x69\x6e\x78\124\x65\x6d\x70\x6c\141\x74\145\163\56\x70\150\160"; require_once __DIR__ . "\57\x50\125\x51\103\157\x6d\x70\x61\164\151\x62\151\x6c\151\x74\171\x2e\x70\150\160"; use WHMCS\Database\Capsule; use WHMCS\Module\Server\Dockern8n\System; goto H0VRb; s32iR: function dockern8n_CreateBackup($params) { try { $hostname = $params["\163\x65\x72\166\x65\x72\150\x6f\x73\x74\156\x61\x6d\x65"] ? $params["\x73\x65\x72\x76\145\162\x68\157\x73\x74\156\141\x6d\145"] : $params["\x73\145\162\x76\145\x72\151\160"]; $username = $params["\163\x65\x72\166\145\x72\x75\x73\x65\x72\156\141\x6d\x65"]; $password = $params["\x73\145\162\x76\x65\x72\x70\x61\x73\163\167\x6f\162\144"]; $serviceId = $params["\163\145\162\166\151\x63\145\x69\144"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $backupDir = "\x2f\x76\x61\162\57\x77\167\x77\x2f\144\157\143\x6b\145\x72\156\x38\x6e\x2f\x62\x61\143\153\x75\x70\163\57\163\x65\162\166\x69\143\145\x2d{$serviceId}"; $logFile = "\57\166\x61\162\57\x77\167\167\57\144\157\x63\153\x65\x72\156\x38\x6e\57\x6c\157\x67\163\x2f\142\141\143\x6b\x75\160\x2d{$serviceId}\x2e\x6c\x6f\x67"; $timestamp = date("\131\x2d\155\55\x64\x5f\x48\55\x69\x2d\163"); $backupFile = "\x62\x61\143\x6b\165\x70\137{$timestamp}\x2e\164\x61\162\x2e\147\172"; $backupPath = "{$backupDir}\57{$backupFile}"; if ($puqInfo["\151\163\137\x70\x75\161"]) { $serviceDir = $puqInfo["\163\145\162\166\x69\x63\x65\137\x64\x69\x72"]; $dataPath = $puqInfo["\x6d\157\165\156\164\137\144\x69\162"]; $asyncCmd = "\x6d\x6b\144\151\162\40\55\160\40{$backupDir}\40\46\46\x20\143\x64\x20{$serviceDir}\40\46\x26\x20\x64\157\x63\153\x65\162\55\143\157\x6d\x70\157\x73\145\40\163\x74\157\160\40\x26\x26\x20\164\141\162\x20\x2d\143\172\146\x20{$backupPath}\x20\55\x43\x20{$dataPath}\x20\x2e\x20\x26\46\40\x64\157\143\153\x65\162\55\143\157\155\160\157\x73\145\x20\165\160\x20\x2d\144"; } else { $serviceDir = "\x2f\x76\141\x72\57\x77\167\x77\57\x64\157\143\x6b\145\x72\x6e\70\x6e\x2f\x73\145\162\166\x69\x63\145\55{$serviceId}"; $volumeName = "\x73\x65\x72\166\x69\143\x65\55{$serviceId}\137\x6e\x38\x6e\55\x64\141\x74\x61"; $volumePath = "\x2f\166\x61\x72\x2f\x6c\151\142\57\144\157\x63\x6b\x65\x72\57\x76\157\154\165\155\x65\x73\x2f{$volumeName}\57\137\x64\x61\164\141"; $asyncCmd = "\155\153\x64\151\162\x20\x2d\x70\x20{$backupDir}\x20\46\x26\x20\143\144\40{$serviceDir}\40\x26\46\x20\x64\x6f\143\x6b\145\x72\40\x63\x6f\155\x70\157\x73\145\40\x73\164\x6f\x70\40\46\46\40\x74\x61\x72\x20\x2d\x63\172\x66\40{$backupPath}\x20\55\x43\40{$volumePath}\x20\x2e\x20\46\46\x20\144\157\x63\153\145\162\x20\x63\x6f\155\160\x6f\x73\145\40\x75\x70\x20\x2d\x64"; } $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $asyncCmd); dockern8n_LogActivity($params, "\x62\x61\143\153\165\160\x5f\x63\x72\x65\x61\x74\x65\144", "\x42\x61\x63\153\x75\160\40\143\162\x65\x61\x74\x65\x64\72\x20{$backupFile}"); return array("\x73\x75\x63\143\145\163\163" => true, "\155\x65\x73\163\x61\x67\145" => "\102\141\x63\153\x75\x70\x20\x63\162\145\x61\x74\145\144\40\x73\165\143\143\145\x73\163\x66\x75\154\x6c\171\41", "\x66\x69\154\x65\x6e\x61\x6d\x65" => $backupFile, "\164\x69\155\145\x73\164\x61\155\160" => $timestamp); } catch (Exception $e) { return array("\163\165\143\143\x65\163\163" => false, "\155\145\163\163\141\147\x65" => $e->getMessage()); } } goto Zd_WQ; mzf7G: function dockern8n_AdminStop($params) { $res = dockern8n_stop($params); return $res === "\x73\165\143\143\145\x73\163" ? "\163\165\143\x63\145\x73\x73" : "\105\162\162\x6f\162\x3a\40" . $res; } goto S3VKp; S3VKp: function dockern8n_AdminMount($params) { try { $hostname = $params["\163\145\x72\x76\145\162\x68\157\x73\164\156\141\x6d\145"] ?: $params["\163\145\162\x76\x65\x72\x69\160"]; $sshUsername = $params["\163\145\x72\166\145\x72\x75\163\145\x72\156\x61\155\145"]; $sshPassword = $params["\x73\145\162\x76\145\162\160\x61\163\x73\167\x6f\162\x64"]; $domain = $params["\144\x6f\155\141\x69\x6e"]; $mountCmd = "\x73\x75\144\x6f\40\155\157\x75\156\164\x20\x2f\x6d\x6e\x74\57{$domain}\x20\x32\76\46\x31\x20\174\174\40\163\x75\x64\157\x20\x6d\x6f\165\x6e\x74\40\55\x61\x20\62\76\x26\61"; $output = dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $mountCmd); if (strpos($output, "\105\x72\162\157\x72") !== false || strpos($output, "\146\141\151\x6c\x65\144") !== false) { return "\x4d\x6f\165\x6e\164\x20\x66\x61\151\154\145\x64\72\x20" . $output; } return "\163\165\143\143\145\163\x73"; } catch (Exception $e) { return $e->getMessage(); } } goto KlmPJ; kd1ON: function dockern8n_UpdateVersion($params, $newVersion) { try { $hostname = $params["\163\145\162\166\145\x72\150\x6f\x73\164\x6e\x61\155\x65"] ?: $params["\163\145\162\166\x65\x72\x69\160"]; $username = $params["\x73\x65\x72\166\x65\162\x75\x73\x65\162\x6e\x61\155\x65"]; $password = $params["\163\145\162\x76\145\x72\160\141\163\x73\x77\x6f\162\144"]; $containerInfo = dockern8n_GetContainerInfo($params); $composeFile = $containerInfo["\x63\157\x6d\160\157\163\145\137\146\151\x6c\145"]; $serviceDir = $containerInfo["\163\145\162\x76\x69\x63\145\137\144\x69\162"]; $cmdRead = "\x63\141\x74\x20{$composeFile}"; $composeContent = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdRead); if (empty($composeContent) || strpos($composeContent, "\163\145\162\166\x69\x63\145\163\x3a") === false) { return array("\163\x75\x63\x63\x65\x73\163" => false, "\x6d\x65\163\163\141\147\145" => "\x43\157\165\154\x64\40\x6e\x6f\x74\x20\162\145\x61\x64\x20\143\157\x6e\146\x69\x67\165\x72\x61\164\151\x6f\x6e\x20\146\151\x6c\145\40\141\x74\x20" . $composeFile); } $pattern = "\x2f\x28\x69\x6d\x61\147\x65\x3a\x5c\x73\x2a\133\42\47\135\x3f\x29\x28\x3f\x3a\x64\x6f\143\x6b\x65\x72\134\x2e\x6e\x38\x6e\134\x2e\151\157\x5c\57\156\70\156\x69\x6f\134\57\x6e\x38\x6e\x7c\156\x38\156\x69\x6f\x5c\x2f\x6e\x38\156\x29\50\x3f\72\x3a\x5b\x5e\42\x27\134\163\x5d\53\51\x3f\x28\133\x22\47\135\77\x29\57"; $replacement = "\44\61\x64\157\143\x6b\x65\162\56\156\x38\156\56\x69\157\57\x6e\x38\x6e\151\x6f\x2f\156\70\x6e\72{$newVersion}\44\x32"; if (!preg_match($pattern, $composeContent)) { return array("\x73\165\x63\x63\145\163\x73" => false, "\155\x65\163\163\x61\x67\145" => "\x43\157\165\154\x64\40\x6e\157\164\x20\146\151\156\x64\40\156\70\156\x20\151\155\141\x67\145\40\x64\x65\146\x69\x6e\151\x74\151\x6f\x6e\40\151\156\40\143\157\155\160\x6f\x73\x65\x20\146\151\154\145\x2e"); } $newContent = preg_replace($pattern, $replacement, $composeContent); $b64Compose = base64_encode($newContent); $cmdWrite = "\145\143\150\x6f\x20\47{$b64Compose}\x27\40\174\x20\142\x61\163\145\66\64\40\x2d\144\x20\x3e\x20{$composeFile}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdWrite); $cmdUpdate = "\x63\144\x20{$serviceDir}\40\x26\46\x20\x64\157\143\153\x65\x72\40\143\x6f\x6d\x70\x6f\163\145\40\x70\165\x6c\x6c\x20\156\70\156\40\46\46\40\144\x6f\x63\x6b\x65\162\x20\x63\157\155\160\157\163\145\40\165\160\x20\55\x64\x20\x6e\x38\x6e\40\62\76\46\x31"; $updateOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdUpdate); if (stripos($updateOutput, "\145\162\162\x6f\162") !== false || stripos($updateOutput, "\x66\141\151\x6c\145\144") !== false) { if (stripos($updateOutput, "\162\x65\143\162\145\141\x74\x65\x64") === false && stripos($updateOutput, "\163\164\x61\x72\x74\145\x64") === false && stripos($updateOutput, "\162\165\x6e\x6e\x69\156\147") === false && stripos($updateOutput, "\144\x6f\156\x65") === false) { return array("\x73\165\x63\x63\x65\163\x73" => false, "\155\x65\x73\163\141\x67\x65" => "\125\160\x64\x61\x74\145\x20\x66\141\151\x6c\x65\x64\x3a\x20" . substr($updateOutput, 0, 150)); } } $serviceId = $params["\163\145\162\166\x69\143\145\151\144"]; $customField = Capsule::table("\x74\x62\x6c\143\165\163\164\x6f\155\x66\151\x65\x6c\x64\x73")->where("\x72\145\x6c\151\x64", $params["\160\141\x63\153\141\147\x65\x69\x64"])->where("\146\151\145\154\144\x6e\x61\x6d\145", "\x53\x65\162\166\x69\x63\145\x20\x44\x65\164\141\151\x6c\x73")->where("\164\x79\160\145", "\x70\x72\157\144\x75\143\164")->first(); if ($customField) { $value = Capsule::table("\164\142\154\x63\165\x73\164\x6f\155\146\151\x65\x6c\x64\163\166\x61\x6c\x75\x65\163")->where("\146\x69\145\x6c\144\x69\x64", $customField->id)->where("\x72\145\x6c\151\x64", $serviceId)->value("\x76\141\x6c\x75\x65"); if ($value) { $details = json_decode(html_entity_decode($value), true); $details["\166\x65\162\163\151\x6f\156"] = $newVersion; Capsule::table("\x74\x62\154\x63\165\x73\164\157\x6d\146\151\x65\154\144\163\166\x61\154\165\x65\163")->where("\x66\151\x65\x6c\144\151\x64", $customField->id)->where("\x72\145\154\x69\x64", $serviceId)->update(array("\166\x61\x6c\165\145" => json_encode($details))); } } dockern8n_LogActivity($params, "\x75\x70\144\x61\x74\x65\x5f\166\145\162\x73\x69\157\x6e", "\x55\x70\144\x61\x74\145\x64\40\x6e\70\x6e\x20\164\x6f\40\166\145\162\163\x69\157\156\x20{$newVersion}"); return array("\163\165\143\x63\x65\x73\163" => true, "\x6d\145\x73\163\141\147\x65" => "\x4e\x38\116\x20\x75\160\144\141\164\x65\144\x20\164\x6f\40\166\145\x72\163\x69\157\156\x20{$newVersion}\40\163\x75\143\143\x65\x73\x73\146\165\x6c\x6c\x79\56"); } catch (Exception $e) { return array("\163\165\143\x63\x65\x73\163" => false, "\x6d\145\x73\163\141\147\145" => $e->getMessage()); } } goto dKAPY; lCtly: function dockern8n_AdminLink($params) { $serviceId = $params["\x73\145\x72\x76\x69\143\145\x69\144"]; $customField = Capsule::table("\164\x62\154\143\x75\x73\164\157\x6d\x66\x69\x65\154\144\x73")->where("\162\x65\154\151\144", $params["\x70\x61\x63\x6b\141\x67\x65\151\144"])->where("\146\x69\145\154\x64\x6e\141\x6d\x65", "\x53\x65\162\166\x69\143\145\40\x44\x65\164\141\151\x6c\x73")->where("\x74\x79\x70\145", "\160\162\x6f\x64\165\x63\x74")->first(); if ($customField) { $value = Capsule::table("\x74\x62\154\143\165\x73\x74\x6f\x6d\146\151\x65\x6c\144\x73\x76\141\154\x75\x65\163")->where("\146\151\x65\x6c\144\x69\x64", $customField->id)->where("\x72\x65\x6c\x69\144", $serviceId)->value("\x76\141\154\165\145"); if ($value) { $details = json_decode(html_entity_decode($value), true); if (!empty($details["\x64\157\155\x61\151\x6e"])) { return $details["\144\x6f\155\x61\151\156"]; } } } return ''; } goto EWShb; h9GS7: $GLOBALS["\x64\x6f\x63\153\x65\x72\156\x38\156\x5f\163\x74\141\x74\165\x73\x5f\143\x61\143\x68\145"] = array(); goto hGQFQ; Yk_0Y: function dockern8n_ConfigOptions() { return array("\x73\x65\x72\166\x69\143\145\x5f\x74\145\155\160\154\141\x74\x65" => array("\106\x72\x69\145\x6e\x64\154\171\116\x61\155\x65" => "\123\x65\x72\166\x69\x63\x65\x20\x54\145\155\160\x6c\141\164\145", "\x54\171\160\x65" => "\144\162\157\160\144\157\x77\x6e", "\x4f\x70\x74\151\x6f\x6e\163" => "\156\x38\156\55\x73\x71\x6c\151\164\145\54\x6e\x38\x6e\55\x70\147\x73\161\154\54\156\x38\156\55\x71\165\x65\x75\x65", "\x44\145\x66\x61\165\154\164" => "\x6e\70\156\55\160\147\x73\x71\154", "\104\x65\x73\x63\162\x69\160\164\151\x6f\x6e" => "\74\142\x72\76\74\x73\164\x72\157\156\x67\76\x6e\x38\156\x2d\x73\x71\154\x69\164\x65\72\74\x2f\163\164\x72\x6f\156\147\x3e\x20\106\x6f\x72\40\163\155\141\x6c\154\40\167\157\162\153\154\x6f\x61\x64\163\74\142\162\76\74\x73\164\162\157\x6e\x67\x3e\x6e\70\x6e\55\x70\x67\163\161\x6c\x3a\74\57\163\164\162\157\x6e\147\x3e\40\106\157\162\40\x70\x72\x6f\144\x75\x63\x74\151\157\x6e\x3c\x62\162\x3e\x3c\163\164\x72\157\156\147\76\156\x38\x6e\x2d\161\x75\145\x75\145\x3a\x3c\x2f\x73\x74\x72\157\156\x67\76\x20\x46\x6f\x72\40\x68\151\147\150\x2d\x73\143\x61\x6c\x65\x20\x65\156\164\x65\162\160\162\x69\163\145"), "\x63\x70\165\137\x6c\x69\155\x69\x74" => array("\x46\162\151\145\156\x64\x6c\x79\116\141\155\145" => "\103\x50\125\x20\114\151\x6d\151\x74", "\124\x79\160\x65" => "\x74\145\x78\x74", "\123\x69\172\145" => "\61\60", "\104\145\x66\141\165\154\x74" => "\x31", "\x44\145\x73\143\162\151\160\x74\x69\157\x6e" => "\116\x75\155\142\x65\162\40\157\x66\x20\x43\120\x55\x73\x20\x28\145\56\x67\x2e\54\40\60\x2e\65\x20\x6f\x72\40\x31\51\x2e\40\x30\x20\x66\157\x72\40\165\x6e\x6c\x69\155\151\x74\x65\x64\x2e"), "\155\145\155\157\x72\x79\137\x6c\151\x6d\x69\164" => array("\106\162\x69\145\x6e\144\154\171\116\141\155\x65" => "\115\x65\155\x6f\x72\x79\x20\114\151\x6d\x69\x74", "\x54\171\160\145" => "\x74\x65\170\164", "\x53\151\x7a\145" => "\61\60", "\x44\145\x66\141\165\x6c\x74" => "\61\x47", "\x44\145\x73\x63\162\x69\160\x74\151\x6f\x6e" => "\115\x65\x6d\157\162\171\40\154\x69\x6d\x69\x74\40\50\x65\56\x67\x2e\54\40\x35\61\62\x4d\40\157\162\x20\61\x47\51\56\40\60\40\146\157\162\x20\165\156\154\x69\155\x69\164\145\144\x2e"), "\144\151\163\153\x5f\x6c\x69\x6d\x69\164" => array("\106\162\x69\145\x6e\144\154\x79\x4e\x61\155\x65" => "\x44\151\x73\153\x20\114\151\x6d\151\x74", "\124\171\x70\x65" => "\x74\145\x78\x74", "\123\151\x7a\x65" => "\x31\60", "\104\x65\146\x61\165\x6c\x74" => "\65\x47", "\x44\145\x73\143\162\151\160\164\151\x6f\x6e" => "\x53\x74\157\x72\141\x67\x65\x20\154\151\x6d\151\x74\x20\x28\x65\x2e\x67\x2e\x2c\40\x31\107\x2c\40\x35\107\54\40\61\x30\x47\51"), "\155\x61\x69\x6e\x5f\144\x6f\155\141\x69\x6e" => array("\x46\x72\151\145\x6e\x64\x6c\171\x4e\141\x6d\x65" => "\x4d\x61\x69\x6e\x20\x44\157\x6d\141\x69\156", "\x54\x79\160\x65" => "\164\145\x78\x74", "\123\x69\172\145" => "\63\x30", "\104\x65\146\x61\x75\x6c\164" => '', "\104\145\x73\143\x72\x69\x70\164\151\157\156" => "\x42\x61\x73\145\x20\144\157\x6d\x61\x69\156\x20\x66\157\162\40\141\x75\164\x6f\55\x67\145\156\145\162\x61\164\145\144\40\163\165\x62\144\x6f\155\x61\x69\x6e\163\40\50\145\56\x67\56\54\x20\156\70\x6e\x62\171\163\156\142\x64\56\x74\x6f\160\x29\56\x20\114\145\141\166\x65\x20\145\155\x70\164\171\x20\164\157\x20\x75\x73\145\40\x73\x65\x72\166\x65\162\40\150\x6f\163\164\x6e\141\x6d\145\x2e"), "\163\x75\x62\144\x6f\x6d\141\151\156\137\x66\157\162\x6d\x61\164" => array("\106\162\151\x65\156\x64\x6c\171\116\141\155\x65" => "\x53\x75\x62\x64\157\x6d\x61\x69\156\40\106\157\162\155\x61\x74", "\x54\171\x70\145" => "\164\145\x78\x74", "\123\x69\172\145" => "\63\60", "\x44\x65\146\141\x75\x6c\x74" => "\x7b\x75\163\x65\x72\x5f\151\x64\175\55\173\x73\145\162\x76\151\143\x65\137\x69\x64\x7d", "\104\145\163\143\162\151\x70\x74\151\x6f\156" => "\101\x75\164\157\55\x73\x75\x62\x64\x6f\x6d\x61\151\x6e\x20\x66\x6f\x72\x6d\x61\x74\x2e\x20\115\141\143\x72\157\163\72\40\173\x75\163\145\162\x5f\151\x64\x7d\x2c\40\173\x73\145\x72\166\x69\x63\145\x5f\151\x64\x7d\54\40\173\x72\141\156\x64\x6f\x6d\x5f\144\x69\147\151\164\x5f\130\x7d\x2c\x20\x7b\162\141\x6e\x64\x6f\x6d\137\154\x65\164\x74\145\x72\137\130\175\x2c\40\x7b\165\x6e\x69\170\164\151\x6d\145\x7d"), "\144\x69\x73\153\x5f\156\x6f\x74\151\x66\151\143\141\164\x69\x6f\156" => array("\106\x72\x69\x65\156\x64\x6c\171\x4e\x61\155\145" => "\104\151\x73\x6b\x20\x41\x6c\x65\x72\x74\40\x54\150\x72\145\x73\x68\x6f\154\x64\40\45", "\x54\x79\x70\x65" => "\164\x65\x78\164", "\x53\x69\172\x65" => "\x35", "\104\145\x66\x61\165\154\x74" => "\70\x30", "\x44\145\163\143\x72\151\x70\x74\151\157\156" => "\123\x65\x6e\x64\x20\x6e\157\164\151\x66\x69\143\x61\x74\151\157\156\40\x77\150\x65\156\x20\x64\x69\x73\x6b\40\165\163\141\x67\145\x20\x65\170\143\145\x65\x64\163\40\164\x68\151\x73\40\x70\145\x72\x63\x65\156\x74\x61\x67\x65"), "\154\x65\164\163\x65\156\143\162\171\160\164\x5f\x65\155\141\x69\154" => array("\106\x72\151\145\x6e\144\x6c\x79\116\x61\x6d\145" => "\114\145\164\47\163\40\105\x6e\143\x72\x79\x70\164\x20\105\155\141\x69\x6c", "\x54\171\x70\145" => "\x74\145\170\164", "\x53\x69\172\x65" => "\63\60", "\104\145\146\141\x75\x6c\x74" => '', "\x44\145\163\143\x72\x69\x70\164\x69\x6f\x6e" => "\105\155\x61\151\x6c\40\146\157\x72\x20\x53\123\114\40\143\145\x72\164\x69\x66\x69\x63\x61\x74\145\163\x2e\x20\114\x65\141\x76\145\x20\145\x6d\x70\164\171\40\x74\x6f\x20\x75\x73\x65\40\x61\144\x6d\151\x6e\100\x64\x6f\155\141\151\x6e")); } goto eeqE8; Vdbic: function dockern8n_GetWorkflowExports($params) { try { $hostname = $params["\163\x65\x72\x76\x65\162\x68\x6f\x73\164\x6e\141\x6d\x65"] ?: $params["\x73\x65\162\166\x65\x72\151\160"]; $username = $params["\x73\145\x72\166\145\162\165\x73\145\162\x6e\141\x6d\145"]; $password = $params["\x73\x65\x72\166\x65\162\160\141\x73\x73\167\x6f\x72\144"]; $serviceId = $params["\x73\145\162\x76\151\x63\145\151\144"]; $exportDir = "\x2f\x76\x61\162\57\167\167\x77\57\x64\157\143\153\145\162\156\70\156\x2f\x65\x78\160\x6f\x72\164\163\57\163\145\x72\x76\x69\143\145\x2d{$serviceId}"; $cmdMkdir = "\155\x6b\144\x69\x72\40\55\x70\x20{$exportDir}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdMkdir); $cmd = "\143\144\x20{$exportDir}\40\46\x26\40\154\163\x20\x2d\x31\x20\x2a\56\x6a\x73\x6f\x6e\x20\x32\x3e\57\x64\x65\166\57\156\165\154\x6c"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $exports = array(); if (!empty($output) && strpos($output, "\x4e\x6f\40\163\165\143\150\x20\x66\151\154\x65") === false) { $files = explode("\12", trim($output)); foreach ($files as $file) { $file = trim($file); if (empty($file)) { continue; } $statCmd = "\x63\144\40{$exportDir}\x20\46\x26\40\x73\164\x61\x74\x20\x2d\x63\40\47\x25\x73\x20\x25\x79\x27\x20{$file}"; $statOut = dockern8n_ssh_RunCommand($hostname, $username, $password, $statCmd); $size = "\60\40\x42"; $date = ''; if (preg_match("\x2f\136\50\x5c\144\x2b\51\x5c\163\53\50\x2e\53\51\x24\57", trim($statOut), $m)) { $bytes = $m[1]; $date = substr($m[2], 0, 19); if ($bytes < 1024) { $size = $bytes . "\x20\102"; } elseif ($bytes < 1048576) { $size = round($bytes / 1024, 2) . "\40\x4b\x42"; } else { $size = round($bytes / 1048576, 2) . "\40\x4d\102"; } } $exports[] = array("\x66\x69\154\x65\156\x61\155\x65" => $file, "\163\x69\172\145" => $size, "\x64\141\164\145" => $date); } } return array("\163\165\143\x63\x65\163\x73" => true, "\x65\170\x70\157\x72\164\163" => $exports); } catch (Exception $e) { return array("\163\x75\143\x63\145\x73\163" => false, "\155\x65\x73\163\x61\x67\145" => $e->getMessage()); } } goto EW6q0; H09a_: function dockern8n_FullReset($params) { try { $serviceId = $params["\x73\x65\162\x76\151\143\145\x69\144"]; $hostname = $params["\163\145\x72\x76\x65\x72\150\157\163\164\156\x61\x6d\x65"] ?: $params["\163\145\162\x76\145\x72\151\160"]; $username = $params["\x73\x65\162\x76\145\x72\x75\x73\x65\x72\156\x61\155\145"]; $password = $params["\163\145\162\x76\x65\162\160\x61\x73\x73\x77\157\162\x64"]; $info = dockern8n_GetContainerInfo($params); $serviceDir = $info["\x73\145\162\x76\151\143\x65\137\144\151\162"]; $projectName = $info["\x70\162\157\x6a\145\x63\x74\x5f\x6e\141\155\x65"]; $n8nContainer = $info["\x6e\x38\x6e\x5f\143\157\156\x74\x61\x69\156\x65\x72"]; if ($info["\x69\x73\137\160\165\161"]) { $mountDir = $info["\x6d\x6f\165\x6e\x74\x5f\x64\x69\x72"] ?: "\57\155\x6e\x74\57" . $params["\144\x6f\155\141\151\156"]; $cmdWipe = "\x63\x64\x20{$serviceDir}\x20\46\x26\x20\x28\144\157\x63\x6b\145\x72\x20\143\x6f\x6d\160\157\x73\145\40\x2d\160\x20{$projectName}\40\x64\x6f\x77\x6e\x20\174\174\40\x64\157\143\x6b\x65\162\40\x73\164\x6f\160\x20{$n8nContainer}\51\x20\x26\46\x20" . "\x72\x6d\40\x2d\x72\x66\40{$mountDir}\x2f\x2a\40\46\x26\40\162\x6d\40\55\162\x66\x20{$mountDir}\x2f\56\52\x20\x32\76\x2f\x64\x65\166\x2f\156\x75\154\154\x20\46\x26\40" . "\x6d\x6f\165\x6e\164\x20\55\141\x20\x26\x26\x20\50\144\x6f\143\x6b\x65\162\40\x63\157\155\160\x6f\x73\x65\40\x2d\160\40{$projectName}\40\165\160\40\55\144\x20\x7c\174\40\x64\157\x63\x6b\x65\162\55\143\x6f\155\160\157\x73\145\40\x2d\x70\40{$projectName}\40\x75\x70\40\55\x64\51\40\62\76\x26\x31"; } else { $cmdWipe = "\143\144\40{$serviceDir}\40\x26\x26\40\50\x64\x6f\143\153\145\162\x20\x63\157\155\160\x6f\x73\x65\x20\x2d\x70\x20{$projectName}\x20\x64\157\x77\x6e\40\x2d\x76\40\x2d\x2d\x72\x65\x6d\157\166\x65\55\x6f\162\x70\x68\x61\x6e\x73\x20\174\174\40\x64\x6f\143\x6b\x65\x72\55\143\x6f\155\160\x6f\x73\145\40\x2d\x70\x20{$projectName}\x20\x64\x6f\x77\x6e\40\x2d\x76\40\x2d\x2d\162\x65\155\157\166\x65\x2d\x6f\x72\x70\150\x61\156\x73\x29\x20\x26\x26\x20" . "\x28\144\x6f\143\x6b\145\x72\x20\x63\157\x6d\160\157\x73\145\40\x2d\160\x20{$projectName}\x20\165\160\x20\55\144\40\174\x7c\40\x64\x6f\143\x6b\x65\x72\x2d\143\157\155\160\157\x73\x65\x20\55\x70\x20{$projectName}\x20\165\160\x20\x2d\144\x29\x20\x32\x3e\x26\61"; } $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdWipe, 180); dockern8n_LogActivity($params, "\x66\165\154\x6c\x5f\x72\145\163\x65\164", "\106\x75\x6c\x6c\x20\x73\x65\162\x76\151\143\x65\x20\167\151\x70\145\40\143\157\x6d\160\154\145\x74\145\144\56"); unset($GLOBALS["\144\x6f\x63\153\145\162\156\70\x6e\x5f\x73\x74\x61\x74\165\x73\x5f\x63\x61\143\x68\145"]["\163\x74\x61\164\x75\163\x5f" . $serviceId]); return array("\163\165\143\143\145\x73\163" => true, "\155\145\x73\163\x61\x67\145" => "\106\x75\154\x6c\40\x72\x65\x73\145\164\x20\x73\x75\143\143\145\163\x73\x21\40\101\x6c\154\40\x64\x61\x74\x61\40\150\141\x73\x20\x62\145\x65\156\40\167\151\x70\x65\144\x20\x61\x6e\x64\x20\x69\x6e\x73\164\141\x6e\143\x65\40\150\141\163\40\x62\x65\x65\x6e\x20\x72\145\x63\162\x65\x61\164\x65\144\56"); } catch (Exception $e) { return array("\x73\x75\x63\x63\145\x73\163" => false, "\x6d\x65\x73\163\141\147\x65" => $e->getMessage()); } } goto c9MPa; KlmPJ: function dockern8n_AdminUnmount($params) { try { $hostname = $params["\163\x65\162\x76\145\x72\x68\157\x73\x74\x6e\141\155\x65"] ?: $params["\163\145\162\166\145\x72\151\160"]; $sshUsername = $params["\x73\x65\162\x76\145\162\x75\163\145\x72\156\x61\155\145"]; $sshPassword = $params["\x73\x65\x72\x76\x65\x72\160\x61\163\163\x77\157\162\x64"]; $domain = $params["\x64\x6f\x6d\x61\151\x6e"]; $umountCmd = "\x73\165\x64\x6f\40\x75\x6d\157\x75\x6e\x74\40\55\154\40\57\x6d\156\x74\57{$domain}\x20\62\x3e\x26\61"; $output = dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $umountCmd); return "\163\x75\x63\143\x65\163\163"; } catch (Exception $e) { return $e->getMessage(); } } goto L2hEd; RcVrm: $GLOBALS["\144\157\x63\x6b\x65\162\x6e\x38\156\137\x73\163\150\x5f\160\157\157\x6c"] = array(); goto MIPbe; EWShb: function dockern8n_ChangePackage($params) { try { $hostname = $params["\x73\x65\162\166\145\x72\x68\x6f\x73\164\x6e\141\x6d\145"] ? $params["\x73\145\x72\166\145\162\150\157\163\x74\156\141\155\145"] : $params["\x73\x65\162\x76\145\162\x69\x70"]; $username = $params["\163\145\x72\x76\145\162\x75\x73\x65\x72\156\141\x6d\x65"]; $password = $params["\163\x65\162\166\x65\162\x70\141\163\163\x77\157\x72\144"]; $serviceId = $params["\x73\145\162\x76\151\x63\x65\x69\x64"]; $newCpuLimit = $params["\x63\157\156\146\151\147\x6f\160\164\x69\x6f\156\62"] ?: "\61"; $newMemoryLimit = $params["\x63\157\x6e\146\151\147\x6f\160\164\x69\157\x6e\x33"] ?: "\61\x47"; $newDiskLimit = $params["\x63\x6f\156\x66\151\147\157\160\164\x69\x6f\x6e\64"] ?: "\x31\x30\107"; $serviceDir = "\57\166\141\162\x2f\167\167\167\57\144\157\x63\x6b\x65\x72\x6e\x38\x6e\57\163\x65\162\166\x69\x63\145\x2d{$serviceId}"; $composeFile = "{$serviceDir}\57\144\157\x63\x6b\x65\162\55\143\157\x6d\x70\157\163\145\56\x79\155\x6c"; $cmdRead = "\143\141\x74\40{$composeFile}"; $composeContent = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdRead); $composeContent = preg_replace("\x2f\x63\x70\165\163\x3a\134\163\52\x5b\x22\x27\135\x3f\x5b\x5c\144\56\135\x2b\x5b\42\47\135\x3f\x2f", "\x63\x70\165\163\72\40\47{$newCpuLimit}\47", $composeContent); $composeContent = preg_replace("\x2f\x6d\x65\155\x6f\x72\x79\72\x5c\163\x2a\133\x22\47\x5d\77\x5b\134\x64\x47\x4d\113\x42\x5d\x2b\133\x22\x27\x5d\x3f\57", "\x6d\x65\155\x6f\162\171\72\40\x27{$newMemoryLimit}\47", $composeContent); $composeContent = preg_replace("\x2f\x73\151\x7a\145\72\134\x73\52\x5b\42\47\135\77\x5b\134\144\x47\x4d\x4b\x42\135\x2b\x5b\42\x27\x5d\x3f\x2f", "\x73\151\172\x65\72\40\47{$newDiskLimit}\x27", $composeContent); $b64Compose = base64_encode($composeContent); $cmdWrite = "\145\x63\150\x6f\x20\x27{$b64Compose}\x27\40\x20\x7c\x20\x62\141\163\x65\x36\64\x20\x2d\144\x20\x3e\40{$composeFile}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdWrite); $cmdRestart = "\x63\x64\x20{$serviceDir}\40\x26\46\40\x64\x6f\x63\x6b\x65\x72\x20\x63\157\x6d\160\x6f\x73\145\x20\163\164\157\x70\x20\46\46\40\x64\157\x63\153\145\x72\x20\x63\x6f\155\160\157\x73\145\x20\165\x70\x20\55\144"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdRestart); logActivity("\x44\157\x63\x6b\x65\162\x4e\x38\116\40\x50\141\143\x6b\x61\147\x65\x20\125\x70\147\x72\141\144\x65\x20\x2d\40\x53\x65\x72\166\x69\x63\x65\x20\x49\x44\x3a\x20{$serviceId}\x2c\40\x43\120\x55\72\40{$newCpuLimit}\x2c\x20\122\101\x4d\x3a\40{$newMemoryLimit}\x2c\x20\104\151\163\x6b\72\40{$newDiskLimit}"); return "\163\x75\x63\x63\145\163\x73"; } catch (Exception $e) { logActivity("\x44\x6f\x63\x6b\145\162\116\x38\116\40\120\x61\143\153\141\147\x65\x20\125\160\147\x72\x61\144\x65\x20\106\141\x69\154\x65\x64\x20\55\x20\x53\x65\x72\x76\151\x63\145\40\x49\104\x3a\40{$serviceId}\x2c\x20\105\162\162\157\162\x3a\x20" . $e->getMessage()); return "\x50\141\x63\153\x61\x67\x65\x20\165\x70\x67\162\x61\x64\x65\40\x66\x61\151\x6c\145\x64\72\40" . $e->getMessage(); } } goto SswwX; et63A: function dockern8n_ssh_RunCommand($hostname, $username, $password, $command, $timeout = 60) { try { $ssh = dockern8n_ssh_GetConnection($hostname, $username, $password); $ssh->setTimeout($timeout); return $ssh->exec($command); } catch (Exception $e) { throw $e; } } goto kFLhe; J4hYN: function dockern8n_ListWorkflowExports($params) { try { $hostname = $params["\x73\145\x72\x76\x65\162\150\157\x73\164\156\141\155\145"] ?: $params["\x73\145\x72\x76\x65\x72\x69\x70"]; $username = $params["\163\x65\162\x76\145\x72\165\x73\x65\162\156\141\155\145"]; $password = $params["\x73\145\162\x76\x65\x72\x70\x61\163\163\167\157\x72\144"]; $serviceId = $params["\x73\x65\x72\166\151\143\145\151\144"]; $exportDir = "\57\x76\x61\x72\x2f\x77\167\x77\57\144\157\x63\153\145\x72\156\x38\x6e\57\145\x78\x70\157\x72\x74\x73\x2f\163\x65\162\166\151\143\x65\55{$serviceId}"; $cmdCheck = "\x74\x65\163\x74\40\x2d\x64\x20{$exportDir}\x20\x26\46\x20\145\x63\150\x6f\x20\x27\x65\170\151\x73\164\163\47\x20\174\174\40\145\x63\x68\157\40\x27\155\151\x73\163\151\x6e\147\x27"; $checkResult = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCheck)); if ($checkResult !== "\145\x78\151\x73\164\163") { return array("\x73\x75\143\x63\x65\163\x73" => true, "\x65\x78\160\x6f\162\x74\x73" => array()); } $cmdList = "\146\x69\156\144\40{$exportDir}\x20\55\x6e\141\x6d\145\x20\47\x2a\x2e\x6a\x73\157\x6e\47\x20\55\164\171\x70\145\40\x66\40\55\x65\x78\x65\x63\x20\x73\164\141\164\x20\55\x2d\146\x6f\162\155\x61\164\75\47\x25\156\x7c\45\163\174\45\x79\47\40\x7b\175\40\x5c\x3b\40\x32\x3e\57\x64\145\x76\57\x6e\x75\x6c\x6c"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdList); $output = trim($output); $exports = array(); if (!empty($output)) { $lines = preg_split("\x2f\x5b\xd\xa\x5d\53\x2f", $output); foreach ($lines as $line) { $line = trim($line); if (empty($line)) { continue; } $parts = explode("\x7c", $line); if (count($parts) >= 3) { $fullPath = trim($parts[0]); $sizeBytes = (int) trim($parts[1]); $dateStr = trim($parts[2]); if ($sizeBytes >= 1024 * 1024) { $size = round($sizeBytes / (1024 * 1024), 1) . "\115"; } elseif ($sizeBytes >= 1024) { $size = round($sizeBytes / 1024, 1) . "\x4b"; } else { $size = $sizeBytes . "\x42"; } $date = substr($dateStr, 0, 16); $date = str_replace("\55", "\57", substr($date, 5, 5)) . "\40" . substr($date, 11, 5); $exports[] = array("\146\x69\x6c\x65\x6e\141\155\x65" => basename($fullPath), "\x73\151\172\x65" => $size, "\x64\x61\x74\145" => $date, "\160\x61\x74\x68" => $fullPath); } } } usort($exports, function ($a, $b) { return strcmp($b["\x66\151\x6c\145\156\141\155\145"], $a["\x66\x69\154\x65\156\141\155\x65"]); }); return array("\x73\165\143\x63\145\163\163" => true, "\145\170\x70\x6f\162\x74\163" => $exports); } catch (Exception $e) { return array("\163\165\x63\143\145\163\x73" => false, "\155\145\163\x73\141\147\x65" => $e->getMessage()); } } goto HuB4X; kFLhe: function dockern8n_ssh_RunBatch($hostname, $username, $password, $commands) { if (empty($commands)) { return array(); } if (count($commands) === 1) { return array(0 => dockern8n_ssh_RunCommand($hostname, $username, $password, $commands[0])); } $separator = "\x5f\137\137\104\x4f\103\x4b\x45\122\x4e\x38\x4e\x5f\x43\x4d\104\x5f\123\105\x50\137\x5f\x5f"; $batchCommand = ''; foreach ($commands as $i => $cmd) { if ($i > 0) { $batchCommand .= "\40\46\46\40\145\x63\150\157\40\47{$separator}\x27\x20\x26\x26\x20"; } $batchCommand .= "\50" . $cmd . "\x20\x32\76\46\x31\40\174\174\40\x74\x72\x75\x65\x29"; } $ssh = dockern8n_ssh_GetConnection($hostname, $username, $password); $output = $ssh->exec($batchCommand); $results = explode($separator, $output); $parsed = array(); foreach ($results as $i => $result) { $parsed[$i] = trim($result); } return $parsed; } goto VQofT; H0VRb: function dockern8n_MetaData() { return array("\x44\151\x73\160\154\141\171\x4e\x61\155\145" => "\x4e\x38\x4e\x20\x44\x6f\x63\153\145\162\40\x4d\141\x6e\x61\x67\145\x72", "\101\120\x49\x56\x65\162\x73\151\x6f\x6e" => "\61\x2e\61", "\x52\x65\x71\165\151\x72\145\x73\123\145\x72\x76\x65\x72" => true, "\x41\x75\x74\x68\x6f\162" => "\101\x66\146\151\162\x6d\x77\x65\142", "\x56\145\x72\x73\151\157\156" => DOCKERN8N_VERSION); } goto Yk_0Y; DZucn: function dockern8n_GetAvailableVersions() { $fallbackVersions = array("\x6c\x61\x74\x65\x73\x74", "\x32\x2e\x30\x2e\x33", "\62\x2e\x30\56\x32", "\62\56\60\x2e\x31", "\62\56\60\56\x30", "\61\56\x37\x31\56\63", "\x31\x2e\x37\61\x2e\x32", "\61\x2e\x37\x31\x2e\x31", "\61\x2e\x37\61\56\x30", "\x31\x2e\67\60\56\x33", "\x31\56\67\60\56\x32", "\61\x2e\x37\x30\x2e\61", "\61\56\67\x30\56\60", "\x31\x2e\66\71\56\x32", "\61\56\66\x39\56\61", "\x31\x2e\66\71\x2e\60", "\x31\x2e\66\70\x2e\x31", "\61\56\66\x38\x2e\x30"); $cacheFile = sys_get_temp_dir() . "\x2f\x64\x6f\143\153\145\162\x6e\x38\x6e\x5f\x76\x65\x72\x73\x69\157\x6e\163\137\x63\x61\143\150\145\56\x6a\x73\x6f\x6e"; $cacheTime = 3600; if (file_exists($cacheFile)) { $cacheData = json_decode(file_get_contents($cacheFile), true); if ($cacheData && isset($cacheData["\164\x69\155\145\163\164\141\155\x70"]) && time() - $cacheData["\164\x69\x6d\x65\x73\x74\141\x6d\160"] < $cacheTime) { return $cacheData["\166\x65\162\x73\x69\157\x6e\163"]; } } $versions = array("\x6c\x61\x74\145\163\x74"); $url = "\x68\164\x74\160\x73\72\x2f\x2f\x61\160\x69\x2e\147\151\164\x68\165\x62\56\143\157\155\57\x72\145\x70\157\163\57\156\70\156\55\151\x6f\57\x6e\70\156\57\x72\145\x6c\145\x61\x73\145\x73\77\160\145\x72\137\160\x61\147\145\x3d\63\x30"; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_TIMEOUT, 5); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 3); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_USERAGENT, "\x57\x48\x4d\103\x53\x2d\x44\x6f\143\x6b\x65\x72\116\x38\116\x2d\x4d\x6f\144\165\x6c\x65"); curl_setopt($ch, CURLOPT_HTTPHEADER, array("\x41\143\x63\145\160\x74\72\40\x61\x70\160\154\151\x63\x61\x74\151\157\156\57\166\x6e\144\56\147\x69\164\x68\x75\x62\53\152\163\157\156")); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($httpCode === 200 && !empty($response)) { $releases = json_decode($response, true); if ($releases && is_array($releases)) { foreach ($releases as $release) { $tagName = $release["\164\x61\147\137\x6e\141\155\145"] ?? ''; $version = str_replace("\x6e\70\156\x40", '', $tagName); if (!empty($version) && preg_match("\57\136\x5c\144\53\134\56\134\x64\53\x28\134\x2e\x5c\144\53\x29\77\44\57", $version)) { if (!in_array($version, $versions)) { $versions[] = $version; } } } } } if (count($versions) <= 1) { $url = "\x68\x74\164\x70\163\x3a\x2f\x2f\x68\x75\x62\x2e\x64\157\143\x6b\x65\x72\56\143\x6f\155\x2f\x76\x32\57\x72\x65\x70\157\x73\151\164\x6f\x72\x69\x65\163\57\x6e\70\x6e\x69\157\57\156\70\x6e\57\x74\141\147\163\x3f\x70\141\147\x65\x5f\x73\x69\x7a\145\75\x33\60\46\157\x72\x64\x65\x72\151\156\x67\x3d\154\141\x73\x74\x5f\165\x70\x64\x61\x74\x65\x64"; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_TIMEOUT, 5); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 3); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_USERAGENT, "\115\157\x7a\151\x6c\x6c\x61\x2f\65\56\60"); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($httpCode === 200 && !empty($response)) { $data = json_decode($response, true); if ($data && isset($data["\x72\x65\163\x75\154\164\x73"])) { foreach ($data["\162\x65\163\165\154\x74\x73"] as $tag) { $name = $tag["\156\141\x6d\x65"] ?? ''; if (!empty($name) && preg_match("\57\x5e\134\x64\x2b\x5c\x2e\134\144\x2b\50\134\x2e\x5c\x64\x2b\x29\x3f\44\x2f", $name) && strpos($name, "\163\150\141\62\x35\66") === false) { if (!in_array($name, $versions)) { $versions[] = $name; } } } } } } if (count($versions) <= 1) { $versions = $fallbackVersions; } usort($versions, function ($a, $b) { if ($a === "\x6c\x61\x74\145\x73\164") { return -1; } if ($b === "\154\x61\164\x65\163\164") { return 1; } return version_compare($b, $a); }); @file_put_contents($cacheFile, json_encode(array("\x74\151\x6d\145\x73\x74\141\x6d\160" => time(), "\166\145\162\x73\151\157\156\x73" => $versions))); return $versions; } goto h9GS7; YA2G2: function dockern8n_GetTemplate($type, $domain, $serviceId, $cpuLimit = 0, $memoryLimit = 0, $version = "\154\141\164\x65\163\x74", $username = '', $password = '', $timezone = "\101\x73\151\141\57\x44\150\x61\153\x61", $existingCreds = array()) { $domainHost = preg_replace("\43\136\x68\164\x74\x70\x73\77\x3a\x2f\57\43", '', $domain); $domainHost = rtrim($domainHost, "\57"); $credentials = array("\x64\x6f\x6d\141\151\x6e" => "\x68\164\x74\x70\163\x3a\57\57" . $domainHost, "\x63\162\x65\x61\164\145\144\x5f\x61\x74" => date("\131\x2d\155\55\x64\x20\x48\x3a\151\72\x73")); $dockerCompose = ''; $encryptionKey = $existingCreds["\145\156\x63\x72\171\x70\164\x69\157\156\137\153\145\x79"] ?? dockern8n_GeneratePassword(32); $n8nUser = $username ?: $existingCreds["\x75\163\145\x72\x6e\141\155\x65"] ?? "\141\144\155\151\x6e"; $n8nPass = $password ?: $existingCreds["\x70\141\x73\163\167\157\162\x64"] ?? dockern8n_GeneratePassword(); $credentials["\165\163\x65\x72\x6e\141\155\145"] = $n8nUser; $credentials["\160\x61\x73\163\x77\157\x72\x64"] = $n8nPass; $credentials["\x65\x6e\143\162\171\160\164\151\x6f\156\x5f\153\x65\171"] = $encryptionKey; $credentials["\x74\145\x6d\160\154\141\x74\145"] = $type; $credentials["\160\x6f\x73\164\147\x72\x65\x73\x5f\160\x61\x73\x73\x77\x6f\162\x64"] = $existingCreds["\x70\x6f\x73\164\x67\162\x65\163\137\x70\141\163\x73\167\x6f\162\x64"] ?? dockern8n_GeneratePassword(); $deployBlock = ''; if (!empty($cpuLimit) && $cpuLimit !== "\x30" || !empty($memoryLimit) && $memoryLimit !== "\x30") { $deployBlock = "\xa\40\x20\x20\x20\144\145\x70\x6c\157\171\72\xa\40\40\40\x20\x20\x20\x72\145\163\157\x75\162\143\145\163\x3a\xa\x20\40\40\x20\40\x20\40\x20\x6c\151\x6d\151\x74\163\72"; if (!empty($cpuLimit) && $cpuLimit !== "\x30") { $deployBlock .= "\xa\40\40\x20\x20\40\x20\x20\x20\40\x20\143\160\165\x73\72\40\x27{$cpuLimit}\47"; } if (!empty($memoryLimit) && $memoryLimit !== "\60") { $deployBlock .= "\12\40\40\40\40\x20\40\x20\x20\x20\40\x6d\145\155\x6f\x72\x79\x3a\40\x27{$memoryLimit}\x27"; } } $commonEnv = "\x20\x20\x20\x20\x20\x20\x2d\x20\x27\x4e\70\116\137\x48\117\x53\124\x3d{$domainHost}\x27\xa\40\40\40\x20\x20\x20\x2d\x20\47\x4e\70\x4e\x5f\105\x44\111\124\117\x52\x5f\x42\x41\x53\x45\137\125\x52\114\75\150\x74\164\160\x73\72\x2f\57{$domainHost}\47\xa\x20\40\x20\40\x20\x20\x2d\x20\x27\x57\x45\102\x48\x4f\x4f\x4b\x5f\x55\122\x4c\x3d\x68\x74\x74\x70\163\72\x2f\x2f{$domainHost}\x27\12\40\40\40\40\x20\x20\x2d\x20\x27\107\x45\116\x45\122\111\103\137\124\111\115\105\132\117\116\x45\x3d{$timezone}\47\12\40\40\x20\40\40\x20\55\x20\47\x54\132\x3d{$timezone}\x27\xa\40\x20\40\x20\x20\x20\55\40\x27\x4e\x38\116\137\105\116\103\x52\131\x50\124\x49\117\x4e\137\113\105\x59\x3d{$encryptionKey}\47\12\40\40\40\x20\x20\40\x2d\40\x27\x4e\70\x4e\x5f\x53\105\x43\x55\122\x45\x5f\x43\x4f\x4f\113\x49\x45\x3d\x66\x61\154\x73\x65\x27\12\40\40\40\40\40\40\55\x20\x27\x4e\x38\x4e\137\102\114\117\103\x4b\x5f\105\116\x56\x5f\101\103\103\x45\x53\123\x5f\x49\116\137\116\117\104\x45\75\164\x72\x75\145\x27\12\x20\x20\x20\40\x20\40\x2d\40\x27\116\70\116\137\105\x4e\106\117\x52\103\x45\137\x53\105\x54\x54\x49\116\x47\x53\137\x46\x49\x4c\105\x5f\120\105\122\115\111\123\123\111\x4f\x4e\123\75\x74\162\x75\145\47\xa\40\40\40\x20\40\x20\55\40\47\x4e\70\116\x5f\120\x52\117\x58\x59\137\x48\117\x50\x53\x3d\x31\47"; switch ($type) { case "\156\70\x6e\x2d\163\161\x6c\x69\x74\x65": $dockerCompose = "\163\x65\162\x76\x69\x63\145\163\72\xa\40\40\156\x38\x6e\x3a\12\x20\40\x20\40\151\155\x61\147\145\x3a\40\47\144\x6f\x63\153\145\162\56\156\x38\x6e\x2e\x69\x6f\x2f\x6e\70\x6e\151\157\x2f\156\70\x6e\72{$version}\x27\xa\40\x20\40\40\x63\157\x6e\164\141\x69\x6e\x65\162\x5f\x6e\141\x6d\145\72\40\163\x65\162\x76\151\143\145\55{$serviceId}\x2d\156\70\x6e\12\40\x20\x20\x20\x72\145\163\164\141\x72\x74\x3a\40\165\156\154\145\x73\x73\x2d\163\164\157\x70\160\x65\144{$deployBlock}\12\x20\40\40\40\143\157\x6d\155\141\x6e\144\x3a\x20\163\164\141\x72\x74\12\40\40\40\40\x65\x6e\x76\x69\x72\x6f\x6e\x6d\145\156\164\x3a\xa{$commonEnv}\12\x20\40\x20\40\x65\170\x70\157\x73\145\72\12\x20\40\40\40\x20\40\x2d\x20\x27\x35\x36\x37\x38\x27\xa\x20\40\40\40\x6e\x65\x74\x77\157\162\x6b\163\x3a\xa\40\40\x20\x20\x20\40\x2d\x20\x64\x65\x66\x61\165\154\164\xa\x20\40\40\40\40\40\x2d\40\156\147\x69\x6e\x78\x2d\x70\162\x6f\170\x79\x5f\167\x65\142\12\40\x20\x20\40\x76\x6f\x6c\x75\x6d\145\x73\x3a\12\40\x20\x20\40\40\40\55\x20\x27\156\x38\156\55\x64\x61\164\x61\72\57\x68\157\x6d\x65\x2f\x6e\x6f\144\x65\x2f\56\x6e\x38\x6e\47\12\40\40\x20\40\x6c\141\x62\x65\154\x73\72\xa\x20\40\x20\40\40\x20\x2d\x20\x27\x56\111\x52\x54\125\101\114\x5f\x48\x4f\x53\x54\x3d{$domainHost}\47\xa\40\x20\x20\x20\x20\x20\x2d\40\47\x56\x49\x52\x54\125\x41\x4c\137\120\x4f\122\x54\x3d\65\66\x37\70\x27\12\x20\x20\40\x20\x20\x20\55\40\47\114\105\124\x53\x45\x4e\x43\122\x59\x50\124\x5f\x48\x4f\123\x54\x3d{$domainHost}\47\xa\x20\40\x20\x20\x68\x65\141\x6c\x74\150\x63\x68\145\143\x6b\72\12\x20\x20\40\x20\40\x20\x74\145\x73\164\72\x20\x5b\47\x43\x4d\x44\x2d\x53\x48\x45\x4c\114\47\54\40\x27\x77\x67\x65\164\40\x2d\x71\x4f\55\x20\150\x74\x74\160\x3a\x2f\57\x31\62\67\x2e\x30\x2e\x30\56\x31\x3a\65\x36\x37\x38\x2f\150\x65\141\x6c\x74\150\172\x20\x7c\174\40\145\170\x69\164\x20\61\47\x5d\xa\x20\x20\40\40\40\40\151\x6e\164\x65\162\166\x61\x6c\72\x20\61\x30\163\xa\40\40\40\x20\x20\40\x74\x69\155\145\x6f\165\x74\x3a\x20\61\60\x73\xa\40\40\40\40\40\40\x72\145\x74\162\151\145\x73\x3a\40\x32\x30\12\40\x20\40\40\40\x20\163\164\x61\x72\x74\x5f\x70\x65\x72\151\157\144\x3a\40\x34\x35\163\xa\12\x76\x6f\154\x75\155\x65\x73\x3a\12\40\40\156\x38\x6e\55\x64\141\x74\x61\x3a\xa\12\156\145\x74\x77\157\x72\153\x73\72\xa\x20\40\156\147\x69\x6e\170\55\160\162\x6f\170\171\137\x77\x65\x62\72\12\40\x20\x20\x20\145\170\164\x65\162\156\141\x6c\72\x20\x74\x72\165\x65"; break; case "\156\70\156": case "\x6e\x38\x6e\55\160\x67\163\x71\x6c": $postgresPassword = $credentials["\x70\157\163\x74\147\162\x65\x73\137\x70\141\x73\163\167\x6f\x72\144"]; $dockerCompose = "\x73\x65\x72\166\151\x63\145\163\x3a\xa\x20\x20\156\70\x6e\72\xa\x20\40\x20\40\x69\x6d\x61\x67\145\72\x20\x27\x64\157\x63\153\145\x72\56\156\70\156\x2e\x69\x6f\57\x6e\70\156\151\157\57\x6e\x38\x6e\72{$version}\47\xa\40\x20\40\40\143\157\156\x74\x61\151\x6e\145\x72\x5f\156\x61\x6d\145\72\40\163\x65\x72\166\151\x63\145\x2d{$serviceId}\55\x6e\x38\x6e\xa\40\x20\x20\40\162\x65\x73\x74\x61\162\x74\72\x20\165\156\154\145\x73\x73\55\163\x74\x6f\160\160\145\x64{$deployBlock}\xa\40\40\x20\40\143\x6f\155\x6d\x61\x6e\x64\x3a\40\163\164\141\x72\x74\12\x20\x20\x20\x20\x65\156\166\151\x72\157\x6e\155\x65\x6e\164\72\xa{$commonEnv}\12\40\x20\40\x20\40\40\55\x20\47\x44\x42\137\124\x59\x50\105\x3d\160\x6f\x73\x74\x67\162\145\163\144\x62\47\12\40\40\40\40\x20\x20\x2d\40\x27\x44\102\137\x50\117\123\124\107\x52\105\x53\104\102\x5f\104\x41\x54\101\102\101\x53\x45\75\x6e\70\156\47\xa\x20\40\40\40\x20\40\55\40\x27\x44\x42\x5f\120\x4f\123\124\107\x52\105\x53\x44\x42\137\110\x4f\x53\x54\75\160\x6f\163\164\x67\162\x65\x73\161\154\47\12\40\x20\40\40\40\40\55\40\47\x44\x42\x5f\x50\x4f\x53\x54\x47\x52\x45\x53\104\102\137\x50\x4f\122\124\x3d\x35\64\63\62\47\12\x20\40\40\x20\40\40\x2d\40\x27\104\102\137\120\x4f\123\x54\107\122\105\123\x44\x42\x5f\x55\x53\105\x52\x3d\156\x38\156\47\xa\40\x20\x20\40\x20\40\55\40\x27\104\x42\x5f\120\117\123\x54\107\x52\x45\x53\104\102\x5f\x53\103\110\105\x4d\101\75\x70\165\142\154\x69\143\x27\xa\x20\x20\x20\40\x20\40\x2d\x20\47\x44\x42\x5f\x50\x4f\x53\x54\107\x52\105\123\x44\x42\x5f\x50\101\x53\x53\x57\x4f\122\104\75{$postgresPassword}\x27\xa\x20\40\x20\x20\x65\170\160\x6f\163\145\72\xa\x20\x20\40\40\x20\40\55\40\x27\65\x36\x37\x38\47\12\x20\40\x20\x20\x6e\x65\x74\167\157\162\153\163\72\xa\40\40\40\40\40\40\x2d\40\144\x65\x66\x61\165\154\164\xa\x20\x20\x20\40\40\40\55\40\156\147\151\x6e\x78\55\160\162\157\170\x79\x5f\167\145\x62\12\x20\x20\x20\x20\166\157\154\165\x6d\x65\163\72\xa\x20\x20\x20\40\40\40\x2d\40\x27\x6e\x38\156\x2d\144\141\x74\141\72\57\x68\x6f\155\x65\x2f\x6e\157\x64\145\57\56\156\x38\x6e\x27\xa\40\40\x20\40\154\x61\x62\x65\154\163\x3a\xa\40\x20\x20\40\40\40\55\x20\47\x56\111\122\124\125\x41\114\x5f\110\x4f\x53\124\x3d{$domainHost}\x27\xa\x20\x20\x20\x20\40\x20\55\40\x27\x56\111\122\124\x55\x41\114\x5f\x50\x4f\122\x54\x3d\65\66\67\70\47\xa\x20\40\x20\x20\x20\x20\55\x20\47\114\105\x54\123\105\116\103\x52\131\120\124\137\x48\x4f\123\x54\x3d{$domainHost}\47\12\x20\40\x20\x20\x68\145\x61\x6c\x74\150\143\x68\x65\x63\x6b\72\xa\40\x20\x20\x20\x20\40\x74\x65\163\x74\x3a\x20\133\x27\103\x4d\104\x2d\123\x48\105\114\x4c\47\54\40\47\x77\147\145\164\40\55\161\x4f\55\x20\150\164\164\x70\x3a\x2f\x2f\x31\62\x37\x2e\x30\56\x30\56\x31\72\65\x36\x37\x38\57\x68\145\x61\154\164\x68\172\x20\174\174\x20\x65\x78\151\x74\x20\61\47\135\12\40\40\40\x20\x20\x20\x69\156\164\x65\x72\166\141\x6c\72\x20\61\60\x73\xa\x20\x20\40\x20\40\x20\164\x69\155\145\x6f\x75\164\x3a\40\x31\x30\x73\xa\40\40\x20\x20\40\x20\x72\145\164\x72\151\145\x73\72\40\x32\x30\xa\40\40\40\40\x20\x20\163\164\x61\x72\x74\137\160\x65\162\x69\x6f\144\72\40\x36\60\x73\12\40\x20\x20\40\144\145\x70\x65\x6e\144\x73\137\157\156\x3a\xa\40\x20\40\40\40\40\x70\157\x73\164\147\162\x65\163\161\154\72\12\40\40\40\40\x20\40\40\x20\x63\x6f\x6e\144\x69\164\151\x6f\156\x3a\x20\163\145\x72\166\151\x63\145\137\x73\x74\x61\x72\164\x65\x64\xa\12\40\40\160\157\163\x74\147\x72\145\163\x71\154\72\xa\40\x20\40\x20\x69\x6d\x61\147\145\x3a\x20\47\160\x6f\163\x74\147\x72\145\163\x3a\x31\66\55\x61\x6c\x70\x69\x6e\x65\47\xa\x20\40\40\40\x63\x6f\156\x74\x61\151\x6e\145\162\137\x6e\x61\x6d\145\72\x20\x73\145\x72\x76\151\143\145\55{$serviceId}\55\160\157\163\164\147\162\x65\163\12\40\x20\40\40\x72\x65\x73\x74\x61\x72\x74\x3a\x20\165\x6e\154\145\x73\x73\x2d\x73\x74\x6f\x70\x70\145\144\xa\40\x20\x20\x20\166\157\x6c\x75\155\145\163\72\xa\x20\40\x20\x20\40\x20\55\x20\x27\x70\x6f\163\164\147\162\x65\163\x71\154\x2d\x64\x61\x74\141\x3a\57\166\141\x72\x2f\x6c\151\142\57\x70\x6f\163\x74\147\x72\145\x73\161\154\57\144\x61\x74\x61\x27\xa\x20\40\x20\x20\x65\x6e\x76\151\x72\157\x6e\x6d\145\156\164\72\xa\40\40\x20\40\40\x20\55\x20\x27\120\x4f\123\x54\107\x52\105\x53\137\125\123\105\x52\75\156\70\156\47\xa\40\40\40\x20\x20\x20\55\40\47\120\x4f\123\x54\107\x52\105\x53\137\x50\x41\123\123\127\x4f\x52\x44\x3d{$postgresPassword}\47\12\40\40\x20\40\x20\40\55\40\x27\120\117\x53\124\107\122\105\123\x5f\x44\102\75\156\x38\156\x27\12\40\x20\x20\40\150\145\x61\x6c\164\x68\143\150\x65\x63\x6b\x3a\12\40\40\x20\x20\x20\x20\164\x65\163\x74\72\40\133\x27\x43\x4d\104\x2d\x53\110\x45\x4c\x4c\47\x2c\x20\x27\x70\x67\137\151\163\x72\x65\x61\144\x79\40\55\125\x20\x6e\70\x6e\x20\55\x64\40\156\70\x6e\40\174\x7c\x20\145\170\151\x74\x20\x31\x27\135\xa\x20\x20\x20\40\40\x20\151\x6e\164\145\x72\166\141\x6c\x3a\40\65\x73\xa\40\x20\x20\40\40\x20\164\x69\x6d\x65\157\165\x74\x3a\x20\x31\x30\163\xa\x20\x20\x20\40\40\x20\x72\x65\x74\x72\151\x65\163\x3a\x20\63\60\xa\40\40\x20\x20\40\x20\163\x74\141\x72\x74\x5f\x70\x65\x72\x69\x6f\144\x3a\x20\62\60\x73\12\xa\x76\x6f\x6c\165\x6d\x65\x73\x3a\12\x20\40\x6e\70\x6e\x2d\x64\141\x74\x61\72\12\x20\40\160\157\x73\x74\x67\162\145\x73\161\x6c\x2d\144\141\x74\141\x3a\xa\xa\156\x65\x74\167\x6f\x72\153\163\x3a\12\40\40\x6e\147\x69\x6e\170\55\160\x72\x6f\x78\x79\137\167\x65\142\72\12\x20\40\x20\x20\x65\x78\x74\x65\x72\156\141\x6c\72\x20\x74\162\165\145"; break; case "\156\70\156\55\x71\x75\145\165\x65": $postgresPassword = $credentials["\x70\157\163\164\147\162\x65\163\x5f\x70\141\x73\163\167\157\x72\144"]; $credentials["\155\157\x64\x65"] = "\x70\145\x72\x66"; $dockerCompose = "\163\x65\x72\x76\151\143\145\163\72\xa\x20\40\x6e\x38\x6e\72\xa\x20\40\40\x20\x69\x6d\x61\147\x65\x3a\x20\47\x64\157\x63\153\145\x72\56\x6e\70\156\x2e\151\157\57\x6e\x38\156\151\x6f\57\156\x38\x6e\72{$version}\47\12\40\40\40\40\143\157\156\x74\141\151\x6e\x65\162\x5f\x6e\x61\x6d\x65\x3a\x20\x73\x65\162\x76\x69\143\145\55{$serviceId}\55\156\70\156\xa\40\x20\40\x20\162\x65\x73\164\x61\x72\164\72\40\165\156\154\145\x73\x73\55\163\164\x6f\x70\x70\x65\x64{$deployBlock}\12\x20\40\x20\x20\143\x6f\155\x6d\141\156\x64\x3a\40\163\164\x61\162\x74\xa\x20\40\40\40\145\x6e\x76\151\162\x6f\x6e\x6d\x65\x6e\x74\72\xa{$commonEnv}\12\40\x20\40\40\x20\40\55\x20\47\x44\x42\x5f\x54\131\120\105\75\160\x6f\163\164\x67\162\145\x73\144\x62\47\xa\x20\x20\x20\40\40\40\x2d\40\47\x44\102\137\x50\117\123\124\x47\122\x45\x53\104\x42\x5f\104\101\124\101\102\x41\123\105\x3d\156\x38\156\47\xa\40\x20\40\40\40\x20\55\40\47\x44\x42\x5f\120\117\x53\124\x47\x52\x45\x53\x44\x42\x5f\110\x4f\123\124\75\x70\157\163\164\x67\x72\x65\x73\161\154\x27\12\x20\40\40\x20\40\x20\x2d\40\x27\104\x42\x5f\120\117\x53\x54\107\122\x45\123\x44\x42\x5f\120\x4f\x52\124\75\65\64\x33\x32\x27\xa\40\40\40\40\x20\x20\55\x20\47\x44\x42\137\x50\117\x53\124\107\122\x45\x53\x44\x42\137\x55\x53\x45\x52\x3d\156\x38\156\47\12\x20\x20\x20\x20\x20\x20\x2d\x20\x27\x44\102\x5f\120\x4f\123\x54\107\122\x45\x53\x44\102\x5f\123\x43\110\105\115\x41\x3d\x70\165\142\154\151\143\47\xa\x20\40\x20\x20\40\40\55\40\x27\x44\102\x5f\120\117\123\x54\107\x52\105\123\104\102\137\120\x41\x53\123\x57\117\x52\x44\75{$postgresPassword}\47\12\x20\x20\40\x20\145\x78\x70\x6f\163\x65\72\12\x20\x20\40\40\40\x20\55\40\x27\x35\x36\67\70\47\12\40\40\40\40\156\x65\164\167\157\x72\x6b\163\x3a\12\x20\40\40\40\x20\40\55\x20\x64\145\146\x61\165\x6c\164\xa\x20\x20\40\40\x20\40\55\x20\x6e\x67\x69\156\170\x2d\x70\162\x6f\170\171\137\167\x65\142\xa\40\40\40\40\166\x6f\154\x75\155\x65\163\72\xa\40\40\40\x20\x20\x20\55\x20\x27\x6e\x38\156\55\144\x61\164\141\72\57\x68\x6f\155\x65\x2f\x6e\x6f\144\145\x2f\56\x6e\x38\x6e\x27\xa\x20\40\x20\x20\x6c\141\142\145\x6c\163\x3a\12\40\40\x20\x20\x20\x20\x2d\x20\47\126\x49\x52\124\125\101\114\137\x48\117\123\124\x3d{$domainHost}\47\12\40\40\40\40\x20\x20\x2d\x20\x27\126\111\x52\124\125\x41\x4c\x5f\x50\117\122\124\x3d\x35\x36\x37\x38\47\xa\40\x20\40\x20\40\x20\55\x20\x27\x4c\x45\124\123\105\116\103\122\x59\x50\124\137\x48\x4f\x53\124\x3d{$domainHost}\47\xa\x20\x20\x20\40\x68\145\x61\x6c\164\150\143\x68\x65\x63\x6b\72\12\x20\40\x20\x20\x20\40\x74\x65\x73\164\x3a\40\x5b\47\x43\115\x44\55\x53\x48\105\114\x4c\47\x2c\x20\x27\x77\147\x65\x74\40\x2d\x71\x4f\x2d\x20\x68\164\164\160\x3a\57\x2f\61\x32\x37\x2e\60\56\60\x2e\x31\72\x35\x36\67\x38\57\150\145\x61\154\164\x68\x7a\40\174\174\x20\x65\x78\x69\x74\40\x31\47\135\12\40\40\40\40\40\40\151\x6e\164\145\162\x76\x61\154\72\x20\x31\60\163\12\40\x20\x20\40\40\x20\x74\x69\x6d\145\157\165\164\72\40\61\60\163\xa\x20\x20\40\40\40\40\x72\x65\x74\x72\151\x65\x73\72\40\62\x30\xa\x20\40\40\x20\x20\x20\163\x74\141\162\164\137\160\145\162\151\x6f\x64\72\x20\66\60\x73\12\x20\x20\x20\40\x64\x65\x70\145\x6e\x64\x73\x5f\157\x6e\x3a\12\x20\40\x20\40\40\40\x70\x6f\x73\164\x67\162\145\x73\161\154\72\12\x20\x20\x20\40\40\x20\x20\40\143\x6f\x6e\x64\151\x74\151\x6f\x6e\x3a\x20\x73\145\x72\166\151\143\145\x5f\x73\164\141\x72\164\145\x64\xa\40\40\40\x20\40\40\162\x65\144\x69\163\72\xa\x20\40\x20\x20\x20\40\x20\40\143\x6f\x6e\x64\151\164\151\157\156\x3a\40\x73\x65\x72\x76\151\143\145\137\163\164\x61\162\x74\145\x64\xa\12\x20\40\162\x65\x64\151\x73\x3a\12\40\40\x20\x20\151\x6d\x61\x67\x65\72\40\47\162\x65\144\x69\163\x3a\x37\x2d\x61\154\x70\151\x6e\145\x27\xa\x20\x20\40\x20\143\x6f\x6e\164\x61\x69\156\145\x72\x5f\156\141\x6d\x65\x3a\40\x73\145\x72\x76\x69\143\x65\55{$serviceId}\55\x72\x65\x64\151\x73\xa\x20\x20\x20\40\162\x65\163\164\141\162\x74\x3a\40\165\156\154\145\163\163\55\x73\164\x6f\160\x70\145\144\xa\40\x20\x20\40\166\157\x6c\165\x6d\x65\163\x3a\xa\x20\40\x20\x20\x20\x20\x2d\40\x27\x72\x65\144\151\163\x2d\x64\141\164\141\72\x2f\144\141\164\x61\47\12\40\x20\40\x20\150\145\141\154\164\150\x63\x68\145\143\153\x3a\xa\40\40\40\x20\x20\40\x74\x65\x73\164\x3a\40\x5b\47\103\x4d\104\x27\x2c\40\x27\162\145\x64\x69\163\55\x63\154\151\x27\54\40\x27\x70\x69\x6e\x67\47\x5d\xa\40\x20\x20\40\40\x20\151\x6e\x74\x65\162\x76\x61\x6c\x3a\40\x35\163\xa\40\x20\40\40\40\40\164\x69\155\145\x6f\x75\164\72\x20\x35\x73\xa\x20\40\40\40\40\40\x72\145\164\x72\x69\145\x73\x3a\x20\x31\60\12\xa\x20\x20\160\x6f\163\x74\x67\162\145\x73\161\154\x3a\12\x20\40\40\40\x69\x6d\x61\x67\x65\x3a\x20\47\x70\157\163\x74\x67\x72\145\x73\72\61\66\x2d\141\154\x70\x69\x6e\145\x27\xa\x20\x20\x20\40\x63\157\x6e\x74\x61\151\x6e\145\162\x5f\156\141\155\145\x3a\40\x73\145\162\x76\151\143\145\x2d{$serviceId}\x2d\x70\x6f\x73\x74\x67\162\145\x73\xa\x20\x20\40\40\x72\145\x73\164\x61\162\x74\x3a\x20\x75\x6e\x6c\145\x73\x73\55\163\164\157\x70\160\x65\x64\xa\40\x20\40\x20\x76\x6f\154\165\x6d\145\163\x3a\xa\x20\x20\x20\40\x20\x20\x2d\40\47\x70\157\x73\x74\x67\162\x65\163\x71\x6c\55\x64\x61\164\x61\72\57\166\141\x72\57\x6c\x69\142\57\x70\x6f\x73\164\x67\162\x65\x73\161\x6c\x2f\144\141\x74\141\47\xa\x20\40\40\x20\145\156\x76\151\x72\157\x6e\x6d\x65\156\x74\x3a\12\x20\40\40\x20\x20\40\x2d\x20\47\x50\x4f\123\124\x47\x52\105\123\x5f\125\123\105\x52\75\x6e\70\156\47\xa\40\x20\40\40\x20\40\x2d\x20\x27\x50\x4f\123\x54\x47\122\105\123\x5f\120\x41\123\x53\127\x4f\x52\104\75{$postgresPassword}\x27\12\40\x20\40\40\40\40\x2d\x20\x27\120\117\x53\124\x47\x52\x45\x53\137\x44\102\x3d\x6e\x38\x6e\x27\12\40\40\x20\x20\150\145\x61\154\x74\x68\143\150\x65\x63\153\x3a\12\x20\x20\40\x20\x20\40\164\x65\x73\164\72\x20\133\47\x43\115\x44\55\x53\x48\105\x4c\x4c\x27\x2c\40\x27\x70\x67\x5f\x69\163\x72\x65\x61\x64\x79\x20\55\125\x20\x6e\70\156\x20\55\144\x20\x6e\70\156\40\174\174\x20\x65\x78\151\x74\x20\x31\47\135\12\40\x20\x20\40\x20\40\151\156\164\x65\162\166\141\x6c\72\40\x35\x73\12\40\40\x20\x20\x20\40\164\x69\x6d\145\x6f\x75\x74\72\40\61\60\x73\12\40\40\x20\x20\40\40\162\x65\x74\162\x69\x65\163\x3a\x20\63\60\12\40\x20\x20\x20\40\40\x73\x74\141\x72\x74\x5f\160\145\x72\151\x6f\x64\72\40\x32\x30\x73\xa\xa\x76\157\154\165\155\x65\x73\x3a\xa\x20\x20\156\70\x6e\55\144\x61\x74\x61\72\12\x20\40\160\157\163\164\147\x72\145\x73\161\154\55\144\141\164\141\x3a\12\x20\40\162\145\144\x69\x73\x2d\144\x61\164\x61\x3a\12\12\156\x65\x74\x77\157\x72\x6b\163\x3a\xa\40\x20\x6e\x67\151\x6e\170\55\x70\162\x6f\170\171\137\x77\x65\x62\x3a\12\40\x20\40\x20\145\170\x74\145\162\156\141\x6c\72\40\164\162\x75\145"; break; default: throw new Exception("\x54\x65\x6d\160\x6c\141\x74\145\x20\x74\171\160\145\40\x27{$type}\x27\x20\x6e\157\164\40\163\x75\160\160\157\162\164\145\x64\x2e\40\x55\x73\145\x3a\40\156\70\156\x2d\x73\x71\x6c\x69\x74\x65\54\40\156\70\156\55\x70\147\x73\x71\154\x2c\40\x6f\x72\40\x6e\70\156\x2d\161\165\x65\165\145"); } return array("\x64\x6f\143\x6b\x65\x72\x5f\143\157\x6d\160\157\163\x65" => $dockerCompose, "\143\x72\x65\144\145\x6e\164\151\x61\x6c\163" => $credentials); } goto EF0HY; fsFyn: function dockern8n_EnsureComposeFile($params) { $serviceId = $params["\163\145\162\166\x69\x63\145\x69\x64"]; $hostname = $params["\163\145\x72\x76\145\x72\x68\x6f\x73\164\156\x61\155\x65"] ?: $params["\163\x65\x72\166\x65\x72\151\x70"]; $username = $params["\163\145\162\166\x65\x72\165\x73\x65\162\x6e\x61\155\x65"]; $password = $params["\x73\145\162\x76\145\162\x70\141\x73\163\167\157\x72\x64"]; $domain = preg_replace("\43\x5e\150\164\x74\160\163\77\72\x2f\57\43", '', $params["\x64\157\x6d\x61\151\156"] ?? ''); $domain = rtrim($domain, "\x2f"); $serviceDir = "\x2f\x76\x61\x72\57\167\167\x77\57\144\157\x63\x6b\x65\162\156\70\156\x2f\x73\145\162\x76\151\143\145\55{$serviceId}"; $composeFile = "{$serviceDir}\57\144\157\x63\153\145\x72\x2d\143\x6f\155\x70\x6f\163\x65\x2e\171\155\154"; $checkCmd = "\x5b\40\55\146\x20\x27{$composeFile}\47\40\x5d\x20\x26\46\x20\145\x63\x68\157\40\x27\145\170\x69\163\164\x73\x27\40\174\x7c\40\145\x63\150\157\40\x27\156\157\x74\x5f\146\x6f\x75\156\x64\x27"; $result = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $checkCmd)); if ($result === "\x65\x78\x69\163\x74\x73") { return array("\163\x75\143\143\145\163\x73" => true, "\155\x65\x73\163\141\x67\145" => "\x43\x6f\x6d\160\157\163\x65\x20\x66\x69\154\145\40\x61\x6c\x72\145\x61\x64\171\40\x65\x78\x69\163\164\x73"); } $n8nContainer = "\163\x65\162\x76\x69\x63\x65\x2d{$serviceId}\55\x6e\70\156"; $checkN8n = "\144\x6f\143\153\x65\x72\40\151\156\x73\160\145\143\x74\40{$n8nContainer}\x20\55\x2d\146\157\162\155\x61\164\x3d\47\173\x7b\x2e\x49\144\x7d\175\47\40\x32\x3e\57\x64\x65\x76\57\156\165\x6c\154\x20\x7c\40\x68\x65\141\144\40\x2d\143\x20\61\x32"; $n8nId = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $checkN8n)); if (empty($n8nId)) { $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); if ($puqInfo["\151\x73\137\160\165\161"]) { $checkPuq = "\x64\x6f\143\x6b\145\162\40\151\156\x73\160\145\x63\x74\x20{$puqInfo["\x63\x6f\156\x74\141\151\x6e\145\x72\137\156\141\155\145"]}\x20\x2d\55\x66\x6f\x72\x6d\141\164\x3d\x27\173\x7b\56\x49\144\x7d\175\x27\40\x32\x3e\57\144\x65\x76\x2f\156\x75\154\154\x20\x7c\x20\150\x65\141\144\x20\x2d\143\x20\61\62"; $n8nId = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $checkPuq)); if (!empty($n8nId)) { $n8nContainer = $puqInfo["\x63\157\x6e\x74\x61\x69\x6e\x65\x72\137\156\141\155\145"]; } } if (empty($n8nId)) { return array("\x73\165\x63\143\145\x73\x73" => false, "\155\x65\163\163\141\147\145" => "\103\157\156\164\x61\151\x6e\145\x72\x20\156\157\x74\x20\146\x6f\x75\156\x64\40\50\103\x68\x65\x63\153\145\144\x3a\40{$n8nContainer}\x29"); } } $envCmd = "\144\x6f\x63\x6b\x65\x72\40\x69\156\x73\x70\145\x63\x74\x20{$n8nContainer}\x20\x2d\55\x66\x6f\x72\155\x61\164\x3d\x27\173\x7b\162\141\156\x67\145\x20\56\x43\x6f\x6e\146\x69\x67\x2e\105\x6e\166\175\175\173\173\160\x72\151\156\164\154\x6e\40\56\x7d\175\173\173\x65\x6e\144\x7d\x7d\47"; $envOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $envCmd); $templateType = "\156\x38\x6e\55\163\x71\154\151\164\x65"; if (strpos($envOutput, "\x44\x42\x5f\124\x59\120\105\x3d\160\157\x73\164\x67\x72\x65\163\144\142") !== false) { if (strpos($envOutput, "\x45\x58\x45\x43\125\124\111\117\116\123\137\115\117\x44\105\x3d\x71\x75\145\165\145") !== false) { $templateType = "\156\70\156\55\161\165\145\x75\x65"; } else { $templateType = "\x6e\70\x6e\55\x70\147\x73\161\x6c"; } } $cpuLimit = $params["\x63\157\156\146\151\147\x6f\160\164\x69\157\x6e\x32"] ?? 0; $memoryLimit = $params["\x63\x6f\156\146\x69\x67\157\x70\164\x69\157\x6e\x33"] ?? 0; $existingCreds = array(); $timezone = "\101\163\x69\x61\57\x44\150\x61\x6b\x61"; $customField = Capsule::table("\164\142\154\143\165\x73\x74\x6f\x6d\146\151\x65\154\144\x73")->where("\162\x65\154\151\144", $params["\160\x61\143\x6b\x61\x67\x65\151\144"])->where("\x66\x69\x65\x6c\x64\156\141\155\145", "\x53\145\162\166\x69\143\x65\x20\x44\145\x74\x61\151\154\x73")->where("\x74\171\x70\145", "\x70\162\157\x64\x75\x63\164")->first(); if ($customField) { $value = Capsule::table("\164\x62\154\x63\x75\163\x74\x6f\155\146\x69\145\x6c\x64\x73\x76\x61\x6c\x75\x65\x73")->where("\x66\x69\x65\154\x64\151\144", $customField->id)->where("\x72\145\x6c\151\144", $serviceId)->value("\x76\141\154\x75\145"); if ($value) { $existingCreds = json_decode(html_entity_decode($value), true) ?: array(); if (!empty($existingCreds["\x74\x69\x6d\x65\172\157\x6e\x65"])) { $timezone = $existingCreds["\x74\x69\155\x65\172\157\x6e\145"]; } } } $templateResult = dockern8n_GetTemplate($templateType, $domain, $serviceId, $cpuLimit, $memoryLimit, $version, '', '', $timezone, $existingCreds); $compose = $templateResult["\144\x6f\143\153\x65\162\137\x63\157\x6d\x70\157\163\145"]; $mkdirCmd = "\x6d\x6b\144\151\162\40\x2d\160\40{$serviceDir}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $mkdirCmd); $b64Compose = base64_encode($compose); $writeCmd = "\x65\x63\150\x6f\40\x27{$b64Compose}\47\x20\174\40\142\141\x73\x65\66\x34\x20\55\x64\x20\76\x20{$composeFile}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $writeCmd); return array("\163\165\x63\x63\x65\163\163" => true, "\155\x65\163\x73\x61\147\x65" => "\103\x6f\155\160\x6f\x73\x65\40\x66\151\154\x65\40\x67\145\x6e\x65\x72\141\164\145\x64\x20\50{$templateType}\51"); } goto pEiK_; FL29g: function dockern8n_GetTraefikNetwork($hostname, $username, $password) { $cmd = "\x64\157\x63\153\x65\162\40\151\156\163\160\x65\143\164\x20\164\162\x61\145\x66\151\x6b\40\55\55\x66\x6f\x72\x6d\141\x74\40\x27\x7b\173\x72\141\156\x67\x65\40{$k}\54\40{$v}\x20\x3a\75\x20\x2e\116\145\x74\x77\x6f\162\x6b\123\145\164\164\x69\156\147\163\x2e\x4e\145\164\x77\157\x72\153\163\x7d\175\x7b{$k}\175\x7b\173\x65\156\144\x7d\x7d\47\x20\x32\x3e\57\144\x65\x76\57\x6e\165\x6c\154"; $network = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $network = trim($network); if (!empty($network) && strpos($network, "\105\x72\x72\157\162") === false) { return $network; } $commonNetworks = array("\x74\162\x61\145\x66\x69\x6b\137\x64\145\146\x61\165\x6c\x74", "\164\x72\x61\x65\x66\x69\153\55\160\x75\142\x6c\x69\x63", "\x70\x72\x6f\x78\171", "\x77\145\142", "\x74\x72\141\x65\x66\x69\x6b\x5f\160\x72\157\170\171", "\147\x61\x74\x65\x77\141\x79"); $cmdList = "\x64\157\143\153\x65\x72\40\156\x65\x74\x77\157\162\153\x20\154\163\40\x2d\55\146\x6f\162\155\141\164\40\x27\173\x7b\56\x4e\141\155\x65\x7d\175\x27"; $existingNetworks = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdList); foreach ($commonNetworks as $net) { if (strpos($existingNetworks, $net) !== false) { return $net; } } return "\164\x72\x61\145\146\151\x6b\137\144\x65\x66\141\165\154\164"; } goto kFrEO; uC3L1: function dockern8n_UnsuspendAccount(array $params) { $serviceId = $params["\163\145\x72\x76\151\x63\145\x69\x64"]; try { if (!class_exists("\104\157\143\153\145\162\x4e\x38\x4e\137\114\151\x63\145\x6e\x73\145")) { require_once __DIR__ . "\x2f\154\x69\x63\x65\x6e\x73\145\x2e\x70\x68\160"; } $licenseCheck = DockerN8N_License::validate(); if (!$licenseCheck["\x76\141\x6c\151\144"]) { return "\114\151\x63\x65\156\x73\145\40\105\162\162\157\162\72\x20\x49\x6e\x76\x61\x6c\x69\144\40\154\x69\143\x65\156\x73\145\56"; } $hostname = $params["\163\x65\162\x76\145\x72\150\x6f\x73\x74\x6e\141\x6d\x65"] ?: $params["\x73\x65\x72\166\x65\x72\x69\160"]; $username = $params["\x73\145\162\166\145\x72\165\163\145\x72\x6e\141\x6d\x65"]; $password = $params["\x73\145\162\x76\145\162\160\x61\163\x73\167\157\162\144"]; if (empty($hostname) || empty($username) || empty($password)) { $product = Capsule::table("\164\x62\x6c\x70\x72\157\x64\x75\143\164\163")->where("\151\x64", $params["\160\141\x63\x6b\x61\147\x65\151\x64"])->first(); if ($product && !empty($product->servergroup)) { $server = Capsule::table("\164\x62\154\163\x65\162\x76\x65\x72\163")->where("\141\x63\164\151\166\145", 1)->where("\163\145\162\166\145\162\x67\162\157\x75\160\151\x64", $product->servergroup)->first(); if ($server) { $hostname = $server->hostname ?: $server->ipaddress; $username = $server->username; $password = decrypt($server->password); } } } $domain = $params["\x64\157\x6d\141\x69\x6e"] ?: ''; $serviceDir = ''; if (!empty($domain) && $domain !== "\144\157\155\x61\x69\156\56\x63\157\155") { $serviceDir = dockern8n_GetServiceDirectory($domain, $serviceId, true); } else { $serviceDir = "\x2f\x76\x61\162\x2f\167\x77\167\x2f\x64\157\x63\x6b\x65\x72\x6e\70\156\57\x73\145\162\166\151\x63\x65\x2d{$serviceId}"; } if (strpos($serviceDir, "\57\157\160\x74\x2f\x64\157\143\x6b\145\x72\x2f\143\x6c\151\x65\156\164\163") !== false) { $mountCmd = "\155\x6f\165\156\x74\40\x2d\141\40\62\76\x26\61"; dockern8n_ssh_RunCommand($hostname, $username, $password, $mountCmd); } $cmdStart = "\143\x64\40{$serviceDir}\40\x26\x26\x20\x28\144\x6f\x63\153\x65\162\x20\143\x6f\x6d\x70\157\163\145\x20\163\x74\141\162\164\40\174\x7c\40\144\157\x63\153\x65\x72\x2d\x63\157\x6d\160\157\163\145\40\x73\x74\x61\162\x74\x20\174\174\40\144\x6f\143\x6b\145\162\40\143\157\x6d\x70\x6f\x73\145\40\x75\x70\x20\x2d\144\x29\40\62\76\46\61"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdStart); dockern8n_LogActivity($params, "\x73\x65\162\166\151\x63\x65\x5f\165\x6e\x73\x75\x73\160\145\156\144\145\x64", "\x4e\70\116\40\x73\145\x72\166\x69\x63\145\x20\x75\x6e\163\165\163\160\x65\x6e\x64\145\144\40\55\40\160\141\171\155\x65\156\164\x20\162\145\143\145\151\x76\x65\144\56\40\x44\151\163\153\40\143\x68\x65\x63\153\145\144\x20\x26\x20\x43\x6f\x6e\x74\x61\151\156\x65\x72\40\x73\164\141\162\164\145\x64\x2e"); return "\163\165\143\143\x65\x73\x73"; } catch (Exception $e) { return "\x55\156\163\165\163\160\x65\x6e\144\40\106\141\151\x6c\x65\144\72\40" . $e->getMessage(); } } goto ylZ3g; Zd_WQ: function dockern8n_ListBackups($params) { try { $hostname = $params["\163\145\x72\x76\145\x72\150\157\x73\x74\156\x61\x6d\145"] ? $params["\163\145\162\166\145\x72\x68\157\163\164\x6e\x61\155\145"] : $params["\163\145\162\166\145\162\151\160"]; $username = $params["\x73\x65\162\166\x65\x72\x75\x73\x65\162\x6e\x61\x6d\x65"]; $password = $params["\x73\x65\162\x76\x65\x72\x70\141\x73\x73\167\x6f\x72\144"]; $serviceId = $params["\163\145\162\x76\x69\x63\x65\x69\x64"]; $backupDir = "\x2f\x76\141\x72\57\167\x77\167\x2f\144\157\x63\x6b\x65\x72\x6e\70\x6e\x2f\142\x61\143\x6b\165\x70\163\57\163\x65\x72\166\151\143\x65\x2d{$serviceId}"; $cmdCheck = "\x5b\40\x2d\144\40{$backupDir}\40\x5d\40\46\x26\40\145\x63\150\x6f\40\47\145\x78\x69\x73\x74\x73\47\40\174\174\x20\145\143\x68\x6f\40\x27\155\x69\163\x73\151\x6e\x67\47"; $checkResult = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCheck)); if ($checkResult !== "\x65\x78\151\x73\x74\163") { return array("\163\165\x63\143\145\163\163" => true, "\142\x61\x63\153\x75\x70\x73" => array()); } $cmd = "\154\x73\40\55\x6c\150\40{$backupDir}\57\142\141\143\153\165\160\x5f\x2a\x2e\164\141\162\x2e\x67\x7a\40\x32\x3e\57\144\145\x76\57\x6e\165\x6c\154\x20\174\40\141\x77\153\x20\x27\x7b\160\162\151\156\164\x20\44\x39\42\x7c\x22\x24\65\42\x7c\42\44\x36\42\x20\42\x24\67\42\x20\x22\44\70\175\47\40\174\174\40\145\143\x68\x6f\40\47\47"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $backups = array(); if (!empty(trim($output))) { $lines = explode("\xa", trim($output)); foreach ($lines as $line) { if (empty($line)) { continue; } $parts = explode("\x7c", $line); if (count($parts) >= 3) { $filename = basename($parts[0]); $backups[] = array("\146\151\x6c\x65\156\141\x6d\145" => $filename, "\163\151\x7a\145" => $parts[1], "\144\x61\164\145" => $parts[2]); } } } usort($backups, function ($a, $b) { return strcmp($b["\146\151\x6c\x65\156\x61\155\145"], $a["\x66\x69\x6c\145\156\x61\x6d\x65"]); }); return array("\x73\165\143\143\x65\x73\x73" => true, "\142\141\x63\153\x75\x70\x73" => $backups); } catch (Exception $e) { return array("\x73\x75\x63\x63\145\x73\x73" => false, "\x6d\145\163\x73\141\147\145" => $e->getMessage()); } } goto reEfV; tzq6J: function dockern8n_DeleteBackup($params, $backupFilename) { try { $hostname = $params["\x73\x65\x72\166\x65\162\150\x6f\x73\x74\x6e\x61\155\145"] ? $params["\163\145\162\166\x65\x72\x68\157\x73\x74\x6e\x61\155\x65"] : $params["\x73\x65\x72\x76\145\x72\151\160"]; $username = $params["\163\x65\162\166\x65\162\165\x73\x65\x72\x6e\141\155\145"]; $password = $params["\163\x65\162\x76\145\x72\x70\x61\x73\x73\167\x6f\x72\144"]; $serviceId = $params["\x73\x65\162\x76\x69\143\145\x69\x64"]; if (empty($backupFilename)) { return array("\x73\165\x63\x63\x65\163\163" => false, "\x6d\145\x73\x73\141\x67\x65" => "\x42\x61\143\153\x75\160\40\x66\151\154\x65\156\x61\x6d\145\x20\x69\x73\x20\x72\x65\x71\165\151\x72\x65\x64"); } $backupDir = "\57\166\141\162\x2f\x77\167\x77\57\144\x6f\143\x6b\145\x72\156\70\156\57\142\x61\x63\x6b\165\160\163\57\x73\145\162\166\x69\143\x65\x2d{$serviceId}"; $backupPath = "{$backupDir}\57{$backupFilename}"; $cmd = "\x72\x6d\x20\x2d\x66\x20{$backupPath}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); return array("\x73\165\x63\x63\145\163\163" => true, "\x6d\x65\163\x73\x61\x67\145" => "\102\141\143\x6b\165\x70\x20\x64\145\x6c\x65\164\x65\x64\x20\163\x75\143\143\x65\x73\163\x66\165\x6c\x6c\x79"); } catch (Exception $e) { return array("\163\165\143\x63\x65\163\163" => false, "\x6d\x65\163\163\x61\x67\x65" => $e->getMessage()); } } goto SrZcd; l_nBp: function dockern8n_ChangePassword($params) { try { $serviceId = $params["\163\x65\x72\166\x69\143\145\151\144"]; $hostname = $params["\x73\x65\162\166\145\162\150\157\163\x74\x6e\x61\155\x65"] ? $params["\x73\x65\162\166\145\162\150\157\163\x74\x6e\x61\x6d\x65"] : $params["\x73\x65\x72\166\145\162\x69\160"]; $username = $params["\x73\145\162\x76\x65\162\165\x73\x65\x72\156\141\x6d\x65"]; $password = $params["\x73\145\162\x76\145\162\160\141\x73\x73\167\x6f\x72\x64"]; $newPassword = $params["\160\x61\163\163\167\x6f\162\144"]; $clientEmail = $params["\x63\154\x69\x65\156\164\x73\x64\145\x74\x61\151\154\163"]["\x65\x6d\x61\x69\154"] ?? "\x61\x64\x6d\x69\156\100\145\x78\141\155\x70\154\145\x2e\143\x6f\x6d"; $bcryptHash = password_hash($newPassword, PASSWORD_BCRYPT, array("\143\157\163\x74" => 10)); $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $n8nContainer = "\x73\x65\x72\166\x69\143\145\55{$serviceId}\x2d\x6e\70\x6e"; if ($puqInfo["\x69\x73\x5f\160\x75\x71"] && !empty($puqInfo["\x63\157\x6e\164\x61\x69\156\x65\x72\x5f\156\x61\x6d\x65"])) { $n8nContainer = $puqInfo["\x63\x6f\x6e\x74\141\151\x6e\x65\162\137\156\141\155\145"]; } $runHostSqlite = function ($dbPath, $sql) use($hostname, $username, $password) { $sqlEscaped = str_replace("\47", "\x27\134\x27\47", $sql); $cmd = "\163\x75\144\157\x20\163\x71\154\x69\x74\x65\x33\40{$dbPath}\40\47{$sqlEscaped}\47\40\62\76\46\61"; return dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); }; $runEphemeralSqlite = function ($volumeName, $sql) use($hostname, $username, $password) { $sqlEscaped = str_replace("\47", "\x27\134\x27\x27", $sql); $sqlShellSafe = str_replace("\x24", "\134\44", $sqlEscaped); $cmd = "\144\157\143\x6b\145\x72\x20\x72\165\156\x20\x2d\x2d\x72\155\x20\x2d\x76\x20{$volumeName}\x3a\57\x6e\x38\x6e\137\x64\x61\164\141\40\x61\154\x70\x69\x6e\x65\40\163\150\x20\55\x63\40\42\x61\x70\x6b\40\141\144\x64\40\55\55\156\157\x2d\143\x61\x63\x68\145\40\163\x71\154\151\x74\x65\40\x3e\57\144\145\x76\57\x6e\x75\x6c\x6c\40\62\x3e\x26\x31\40\x26\x26\x20\163\x71\154\151\164\x65\x33\40\x2f\x6e\70\156\137\x64\x61\x74\141\x2f\144\x61\x74\x61\x62\141\163\x65\x2e\x73\161\x6c\x69\164\145\40\x27{$sqlShellSafe}\x27\42\x20\62\76\x26\61"; return dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); }; $tryUpdateUser = function ($executor, $target) use($bcryptHash) { $rawOutput = $executor($target, "\123\105\x4c\105\103\124\40\x65\155\141\151\x6c\x20\x46\122\117\115\x20\42\165\x73\x65\x72\42\x20\x4f\x52\x44\105\122\x20\x42\x59\40\42\143\x72\145\141\x74\x65\x64\x41\164\42\40\101\123\103\40\x4c\111\115\111\x54\40\x31\x3b"); $email = ''; if (preg_match("\x2f\x5b\141\x2d\172\101\55\x5a\60\x2d\71\56\x5f\x25\x2b\x2d\135\53\100\133\141\x2d\x7a\101\x2d\x5a\x30\55\71\x2e\x2d\x5d\x2b\x5c\56\133\x61\x2d\x7a\101\55\x5a\x5d\173\x32\54\175\57", $rawOutput, $matches)) { $email = $matches[0]; } if (empty($email) || stripos($rawOutput, "\105\x72\162\x6f\162") !== false || stripos($rawOutput, "\156\x6f\x20\163\165\x63\x68\x20\x74\141\142\x6c\x65") !== false) { $rawOutput2 = $executor($target, "\123\x45\x4c\x45\103\x54\x20\145\x6d\141\151\x6c\x20\x46\x52\x4f\x4d\40\165\163\x65\x72\40\x4f\x52\x44\x45\x52\40\102\x59\x20\x63\x72\x65\141\x74\x65\x64\101\x74\x20\x41\x53\x43\40\114\111\115\111\124\x20\61\73"); if (preg_match("\57\133\x61\55\x7a\x41\x2d\x5a\60\55\71\56\x5f\45\x2b\x2d\135\x2b\x40\x5b\141\55\x7a\x41\55\x5a\x30\x2d\x39\x2e\55\135\53\134\x2e\x5b\x61\55\172\x41\x2d\x5a\x5d\x7b\x32\54\175\57", $rawOutput2, $matches)) { $email = $matches[0]; } } if (!empty($email) && stripos($email, "\105\162\162\157\162") === false && stripos($email, "\156\157\x20\x73\x75\x63\150\x20\164\141\142\x6c\x65") === false) { $combinedSql = "\x55\120\x44\101\x54\105\x20\x22\x75\163\x65\162\42\40\123\105\124\40\160\141\163\x73\x77\157\x72\144\x20\75\x20\47{$bcryptHash}\47\40\127\x48\x45\122\x45\x20\145\x6d\x61\x69\154\x20\75\40\x27{$email}\47\73\x20\x53\x45\114\x45\x43\124\40\143\150\x61\156\147\145\x73\x28\x29\x3b"; $start = microtime(true); $result = trim($executor($target, $combinedSql)); $changes = "\x30"; if (preg_match("\57\50\134\144\x2b\x29\134\163\x2a\x24\x2f", $result, $m)) { $changes = $m[1]; } if ($changes === "\x31") { return array("\163\x75\x63\x63\x65\163\163" => true, "\145\x6d\x61\151\154" => $email); } return array("\163\165\143\x63\145\163\163" => false, "\x65\162\162\157\162" => "\125\x70\144\141\x74\145\x20\x30\x20\162\157\167\163\40\146\x6f\x72\40{$email}\56\x20\122\141\x77\40\x4f\165\x74\160\165\x74\72\40{$result}"); } return array("\163\165\x63\143\145\x73\163" => false, "\x65\162\x72\157\x72" => "\x55\x73\145\x72\40\x6e\x6f\x74\40\146\157\165\156\144\x2e\x20\117\165\x74\160\165\x74\x3a\40{$rawOutput}"); }; $errors = array(); $inspectCmd = "\144\157\143\x6b\145\x72\x20\151\156\x73\x70\x65\x63\x74\40\x2d\x66\x20\47\x7b\173\x72\141\156\147\145\40\56\x4d\x6f\x75\x6e\x74\163\175\x7d\173\173\x69\x66\x20\x65\161\x20\x2e\104\x65\x73\x74\151\156\141\164\151\x6f\156\40\x22\57\x68\x6f\155\145\x2f\x6e\x6f\x64\x65\57\56\156\x38\x6e\x22\175\x7d\173\173\x2e\124\171\x70\x65\175\x7d\x7c\x7b\173\56\x53\157\x75\162\143\145\175\175\173\173\145\x6e\144\175\x7d\x7b\173\145\156\x64\x7d\175\x27\40{$n8nContainer}"; $mountInfo = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $inspectCmd)); $dbUpdated = false; if (!empty($mountInfo)) { $parts = explode("\174", $mountInfo); $type = $parts[0] ?? ''; $source = $parts[1] ?? ''; if ($type === "\x62\x69\x6e\x64") { $dbPath = $source . "\57\144\x61\164\141\x62\x61\x73\x65\x2e\163\x71\154\151\x74\145"; $res = $tryUpdateUser($runHostSqlite, $dbPath); if ($res["\163\165\143\143\145\163\x73"]) { $dbUpdated = true; } else { $errors[] = "\110\x6f\163\x74\x20\123\121\x4c\x69\x74\x65\x3a\x20" . $res["\x65\x72\x72\x6f\162"]; } } elseif ($type === "\x76\x6f\154\x75\x6d\145") { $res = $tryUpdateUser($runEphemeralSqlite, $source); if ($res["\163\x75\143\x63\x65\163\163"]) { $dbUpdated = true; } else { $errors[] = "\x45\160\x68\x65\155\145\x72\141\154\x20\x53\x51\x4c\x69\164\145\72\40" . $res["\x65\x72\x72\x6f\162"]; } } } else { $errors[] = "\103\x6f\165\154\x64\40\156\157\x74\40\x69\144\x65\156\x74\x69\146\171\x20\155\x6f\165\156\164\40\x74\171\x70\x65\x20\x66\x6f\162\40{$n8nContainer}"; } if ($dbUpdated) { dockern8n_ssh_RunCommand($hostname, $username, $password, "\144\x6f\143\x6b\x65\x72\x20\x72\145\163\164\x61\x72\x74\40{$n8nContainer}"); return "\163\165\x63\143\145\163\x73"; } $cleanDomain = preg_replace("\x23\x5e\150\x74\164\160\163\x3f\72\57\x2f\x23", '', $params["\144\157\155\141\151\x6e"]); $projectFilter = $puqInfo["\x70\x72\x6f\152\x65\143\x74\137\x6e\141\155\145"] ?? $serviceId; $findPgCmd = "\x64\x6f\x63\153\145\x72\x20\x70\x73\40\x2d\55\x66\x6f\x72\155\141\x74\40\x27\173\173\x2e\x4e\x61\155\145\x73\x7d\x7d\x27\x20\174\x20\x67\x72\x65\x70\x20\x27\x70\157\163\x74\147\162\x65\x73\47\40\x7c\x20\147\x72\x65\x70\40\55\x45\40\x27{$serviceId}\x7c{$cleanDomain}\x7c{$projectFilter}\x27\x20\174\40\x68\x65\x61\x64\40\x2d\156\40\x31"; $pgContainer = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $findPgCmd)); if (!empty($pgContainer)) { $findEmailSql = "\123\105\x4c\x45\x43\124\40\x65\155\x61\x69\x6c\40\106\122\x4f\x4d\40\x22\x75\x73\145\162\x22\40\117\x52\x44\105\122\x20\x42\131\40\x22\x63\x72\x65\x61\164\145\144\101\x74\x22\x20\101\x53\x43\x20\x4c\x49\x4d\x49\124\40\x31\x3b"; $findEmailSqlSafe = str_replace("\47", "\47\x5c\47\47", $findEmailSql); $findEmailCmd = "\145\x63\150\x6f\x20\x27{$findEmailSqlSafe}\47\40\x7c\x20\x64\x6f\x63\x6b\145\162\x20\x65\170\x65\x63\x20\x2d\x69\x20{$pgContainer}\x20\x70\x73\x71\154\x20\55\x55\x20\156\70\156\x20\x2d\144\40\156\70\156\40\x2d\x74\x20\x2d\x41\x20\x32\76\x26\x31"; $pgEmail = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $findEmailCmd)); if (!empty($pgEmail) && strpos($pgEmail, "\100") !== false) { $pgEmailSql = str_replace("\x27", "\47\47", $pgEmail); $bcryptHashSql = str_replace("\x27", "\x27\x27", $bcryptHash); $sqlInner = "\125\120\x44\101\124\105\40\42\165\163\x65\x72\42\x20\123\105\124\40\x70\141\x73\163\167\x6f\162\144\40\75\40\x27{$bcryptHashSql}\47\x20\127\x48\x45\122\x45\40\145\155\x61\x69\x6c\x20\75\40\x27{$pgEmailSql}\47\x3b"; $sqlShellSafe = str_replace("\47", "\x27\x5c\x27\47", $sqlInner); $rawCmd = "\145\x63\x68\157\40\x27{$sqlShellSafe}\47\40\x7c\40\144\157\x63\x6b\145\x72\x20\145\170\x65\x63\40\x2d\151\x20{$pgContainer}\x20\160\x73\161\x6c\40\55\x55\x20\x6e\70\x6e\40\55\x64\x20\x6e\70\156\40\62\x3e\x26\61"; $pgRes = dockern8n_ssh_RunCommand($hostname, $username, $password, $rawCmd); if (strpos($pgRes, "\x55\120\104\101\x54\x45\40\x31") !== false) { dockern8n_ssh_RunCommand($hostname, $username, $password, "\144\157\x63\153\145\162\40\162\x65\163\164\x61\x72\x74\x20{$n8nContainer}"); return "\163\165\143\x63\x65\x73\163"; } $errors[] = "\x50\157\163\164\x67\x72\x65\x73\40\125\x70\144\x61\164\x65\40\x28{$pgContainer}\51\x3a\40" . $pgRes; } else { $errors[] = "\x50\x6f\163\x74\x67\162\x65\x73\x20\105\155\x61\151\x6c\40\106\151\x6e\x64\x20\x28{$pgContainer}\x29\x3a\x20" . $pgEmail; } } $cmd_reset_owner = "\144\x6f\x63\x6b\x65\162\40\145\170\145\x63\40\x2d\x69\x20{$n8nContainer}\40\x6e\70\x6e\40\165\x73\x65\x72\55\155\x61\156\x61\147\x65\155\x65\156\164\x3a\x72\145\x73\x65\x74\55\x6f\x77\156\x65\x72\x20\x2d\55\x65\x6d\x61\151\x6c\75\42{$clientEmail}\x22\x20\55\x2d\160\141\x73\163\x77\157\162\144\x3d\x22{$newPassword}\x22\x20\x32\76\x26\61"; $cliRes_reset_owner = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd_reset_owner); if (stripos($cliRes_reset_owner, "\163\165\143\143\x65\x73\x73\x66\x75\154\x6c\x79") !== false || stripos($cliRes_reset_owner, "\x75\x70\144\x61\164\145\x64") !== false) { return "\163\165\143\x63\x65\163\163"; } if (empty($pgContainer)) { $cmd_reset = "\x64\157\x63\x6b\x65\x72\40\145\x78\145\x63\40\x2d\151\40{$n8nContainer}\40\156\70\156\40\165\163\145\x72\x2d\155\141\x6e\141\x67\145\155\145\x6e\x74\72\162\145\163\x65\164\40\x2d\55\x79\145\163\40\x32\76\46\61"; $cliRes_reset = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd_reset); if (stripos($cliRes_reset, "\x53\x75\143\x63\145\163\163\x66\165\154\154\x79\40\162\145\x73\145\x74") !== false) { return "\163\165\143\x63\145\163\163"; } $cmd_reset_no_yes = "\x64\157\x63\153\x65\162\x20\145\170\x65\143\x20\x2d\151\x20{$n8nContainer}\40\156\x38\x6e\x20\165\x73\x65\x72\55\155\x61\x6e\141\x67\145\x6d\x65\156\x74\x3a\x72\x65\x73\145\164\x20\x32\76\46\61"; $cliRes_reset_no_yes = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd_reset_no_yes); if (stripos($cliRes_reset_no_yes, "\x53\x75\x63\143\145\x73\163\x66\x75\x6c\x6c\x79\x20\162\x65\x73\x65\x74") !== false) { return "\163\165\x63\143\x65\163\x73"; } $errors[] = "\x43\x4c\111\x20\50\162\x65\163\x65\164\x29\x3a\x20" . $cliRes_reset; } else { $errors[] = "\x53\x6b\x69\160\160\151\156\147\x20\103\x4c\x49\40\x72\145\163\x65\164\x20\x66\157\x72\x20\120\157\x73\164\x67\x72\145\163\x20\164\157\x20\x70\162\145\166\145\x6e\x74\40\165\x73\145\162\x20\144\145\154\145\x74\151\x6f\x6e\56"; } $errors[] = "\103\114\x49\x20\50\x72\x65\163\x65\164\x2d\x6f\x77\x6e\145\162\51\x3a\x20" . $cliRes_reset_owner; return "\x41\154\x6c\x20\155\145\x74\x68\157\144\163\x20\x66\141\x69\154\x65\x64\56\xa" . implode("\xa", $errors); } catch (Exception $e) { return "\x45\162\162\x6f\162\72\x20" . $e->getMessage(); } } goto dRn3F; RHTVm: function dockern8n_parseDiskSize($size) { $size = strtoupper(trim($size)); $units = array("\102" => 1, "\113" => 1024, "\113\x42" => 1024, "\x4d" => 1048576, "\115\x42" => 1048576, "\107" => 1073741824, "\x47\102" => 1073741824, "\124" => 1099511627776, "\124\x42" => 1099511627776); if (preg_match("\x2f\136\50\133\134\x64\x2e\135\x2b\51\x5c\x73\x2a\x28\133\x41\55\x5a\x5d\x2a\x29\x24\x2f", $size, $matches)) { $value = floatval($matches[1]); $unit = $matches[2] ?: "\102"; return (int) ($value * ($units[$unit] ?? 1)); } return 0; } goto agJLa; daEiM: function dockern8n_GetResourceStats($params) { try { $hostname = $params["\163\x65\x72\166\x65\x72\x68\x6f\163\164\156\x61\155\x65"] ? $params["\163\x65\x72\166\x65\162\150\x6f\x73\x74\x6e\x61\x6d\x65"] : $params["\x73\x65\x72\166\145\162\x69\160"]; $username = $params["\163\x65\162\166\145\x72\x75\x73\145\162\156\141\x6d\145"]; $password = $params["\163\x65\x72\x76\145\162\160\x61\x73\163\167\x6f\162\144"]; $serviceId = $params["\163\145\162\x76\x69\143\145\x69\144"]; $domain = $params["\x64\x6f\155\x61\151\x6e"]; $containerName = "\163\x65\162\166\x69\143\x65\x2d{$serviceId}\x2d\x6e\x38\156"; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); if ($puqInfo["\151\163\137\160\165\161"]) { $containerName = $puqInfo["\143\157\156\164\141\151\x6e\145\x72\137\156\141\155\145"]; } $cmd = "\144\x6f\143\x6b\x65\x72\40\163\164\x61\164\163\x20{$containerName}\x20\55\55\x6e\x6f\x2d\163\x74\x72\x65\141\x6d\x20\x2d\55\x66\x6f\162\x6d\x61\164\x20\x27\173\173\x2e\x43\x50\125\120\145\162\x63\175\175\174\x7b\x7b\56\x4d\145\x6d\125\163\141\147\x65\175\175\x7c\173\x7b\x2e\116\145\164\111\117\x7d\x7d\x7c\173\x7b\56\102\x6c\157\x63\x6b\x49\117\175\175\47"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); if (empty($output)) { return array("\x73\165\x63\x63\x65\x73\163" => false, "\155\145\163\163\x61\147\145" => "\x43\157\x6e\164\x61\x69\156\145\162\x20\156\x6f\164\x20\x72\165\x6e\x6e\151\x6e\x67"); } $parts = explode("\x7c", trim($output)); $diskUsage = dockern8n_GetDiskUsage($params); return array("\163\165\x63\143\x65\163\163" => true, "\143\x70\165" => $parts[0] ?? "\x30\x25", "\x6d\145\x6d\157\162\x79" => $parts[1] ?? "\60\x42\x20\x2f\40\x30\x42", "\156\145\x74\x77\157\x72\153" => $parts[2] ?? "\x30\102\x20\57\x20\60\102", "\x64\151\163\x6b" => $parts[3] ?? "\x30\102\x20\57\x20\60\x42", "\x73\x74\157\162\141\147\145" => $diskUsage); } catch (Exception $e) { return array("\163\165\143\143\145\x73\163" => false, "\x6d\145\163\x73\141\x67\x65" => $e->getMessage()); } } goto XrbTP; u0O4j: function dockern8n_stop($params) { try { $hostname = $params["\163\x65\x72\x76\x65\x72\150\157\163\164\x6e\141\155\145"] ?: $params["\x73\x65\162\166\x65\x72\x69\x70"]; $username = $params["\x73\145\x72\x76\145\162\165\x73\145\162\x6e\x61\155\x65"]; $password = $params["\x73\x65\162\x76\145\162\x70\x61\x73\x73\167\x6f\x72\x64"]; $info = dockern8n_GetContainerInfo($params); $serviceDir = $info["\163\x65\162\x76\151\143\x65\x5f\144\x69\x72"]; $projectName = $info["\x70\x72\157\x6a\145\x63\x74\137\x6e\x61\155\x65"]; $containerName = $info["\x6e\70\x6e\137\x63\157\156\164\141\x69\156\x65\x72"]; $cmd = "\143\144\40{$serviceDir}\x20\46\46\x20\x28\x64\x6f\x63\x6b\145\x72\40\143\x6f\x6d\x70\x6f\163\145\x20\x2d\x70\40{$projectName}\40\x73\164\157\160\40\x7c\174\x20\144\157\x63\153\145\162\55\x63\x6f\155\160\157\163\145\40\x2d\160\x20{$projectName}\x20\163\164\x6f\160\40\174\174\40\x64\x6f\x63\153\x65\x72\x20\163\x74\157\160\40{$containerName}\51\x20\62\76\x26\61"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd, 60); logActivity("\104\x6f\143\153\145\162\x4e\70\x4e\x20\123\164\157\x70\x20\55\40\x53\x65\x72\166\x69\x63\145\x20\x49\104\72\40" . $params["\163\x65\162\x76\x69\x63\145\151\x64"] . "\40\x52\145\x73\x75\154\164\72\40" . trim($output)); dockern8n_LogActivity($params, "\x73\145\162\x76\x69\143\145\x5f\x73\x74\157\160\160\145\144", "\116\70\x4e\x20\x73\145\162\x76\x69\x63\x65\x20\163\164\141\143\x6b\x20\163\x74\x6f\160\x70\145\144"); return "\x73\165\143\x63\x65\163\x73"; } catch (Exception $e) { return "\x45\x72\162\157\162\x3a\40" . $e->getMessage(); } } goto VMhow; hrnsH: function dockern8n_GetLogs($params, $lines = 100) { try { $hostname = $params["\163\145\162\x76\x65\x72\x68\157\163\164\x6e\141\155\x65"] ? $params["\x73\x65\x72\166\x65\162\x68\157\163\x74\x6e\x61\155\x65"] : $params["\163\x65\x72\x76\x65\x72\151\x70"]; $username = $params["\163\x65\x72\x76\x65\x72\x75\163\x65\x72\156\x61\x6d\x65"]; $password = $params["\163\145\x72\x76\145\x72\x70\141\x73\x73\167\157\x72\144"]; $serviceId = $params["\163\145\162\x76\151\x63\x65\151\144"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $containerName = $puqInfo["\x69\x73\x5f\x70\x75\x71"] ? $puqInfo["\143\157\156\x74\141\151\x6e\x65\x72\137\156\141\x6d\x65"] : "\x73\x65\x72\x76\151\143\x65\x2d{$serviceId}\x2d\156\x38\x6e"; $cmd = "\x64\x6f\143\x6b\145\x72\x20\154\157\x67\163\40{$containerName}\x20\55\55\x74\x61\x69\x6c\40{$lines}\40\62\76\x26\x31"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); return array("\x73\165\x63\143\x65\x73\163" => true, "\154\157\x67\x73" => $output); } catch (Exception $e) { return array("\x73\x75\143\x63\x65\163\x73" => false, "\x6d\x65\x73\x73\x61\147\145" => $e->getMessage()); } } goto l_nBp; IxyYF: function dockern8n_TerminateAccount(array $params) { $serviceId = $params["\163\145\162\166\x69\x63\145\151\x64"]; try { if (!class_exists("\104\x6f\x63\x6b\145\162\116\x38\x4e\137\x4c\151\x63\x65\156\x73\x65")) { require_once __DIR__ . "\57\x6c\x69\143\145\156\x73\145\56\160\150\160"; } $licenseCheck = DockerN8N_License::validate(); if (!$licenseCheck["\x76\x61\x6c\x69\144"]) { return "\114\151\x63\145\156\163\145\40\x45\x72\162\157\162\72\40\x49\156\166\141\x6c\x69\144\40\154\x69\143\145\156\163\145\56\x20\120\154\145\x61\163\x65\40\141\143\164\x69\x76\x61\x74\145\x20\x61\x20\x76\x61\x6c\151\x64\x20\x6c\151\143\145\x6e\163\145\x2e"; } $hostname = $params["\163\x65\162\x76\145\x72\150\x6f\163\x74\x6e\x61\x6d\145"] ?: $params["\x73\x65\x72\x76\x65\x72\x69\x70"]; $username = $params["\163\x65\162\166\145\x72\165\x73\145\x72\156\141\x6d\145"]; $password = $params["\x73\145\162\x76\145\162\x70\x61\163\163\x77\157\162\x64"]; if (empty($hostname) || empty($username) || empty($password)) { $product = Capsule::table("\164\x62\154\160\x72\157\x64\165\143\x74\x73")->where("\x69\x64", $params["\160\x61\143\153\x61\147\145\x69\x64"])->first(); if ($product && !empty($product->servergroup)) { $server = Capsule::table("\164\x62\154\163\x65\x72\166\145\162\163")->where("\141\x63\x74\151\166\x65", 1)->where("\163\x65\162\166\x65\162\147\x72\157\x75\x70\x69\x64", $product->servergroup)->first(); if ($server) { $hostname = $server->hostname ?: $server->ipaddress; $username = $server->username; $password = decrypt($server->password); } } } $domain = $params["\x64\157\x6d\141\151\x6e"] ?: ''; $hostname = $params["\x73\145\x72\166\x65\x72\x68\157\163\164\156\141\x6d\x65"] ?: $params["\x73\145\162\166\x65\x72\x69\160"]; $sshUsername = $params["\x73\145\x72\x76\x65\162\165\163\145\162\x6e\x61\155\x65"]; $sshPassword = $params["\163\145\162\x76\x65\162\x70\x61\163\x73\x77\157\x72\x64"]; $domain = $params["\144\157\x6d\141\151\156"]; $serviceId = $params["\163\x65\162\x76\x69\x63\x65\x69\144"]; $clientsDir = "\x2f\157\x70\164\57\x64\x6f\143\153\145\162\57\143\x6c\x69\x65\156\164\163"; $serviceDir = "{$clientsDir}\57{$domain}"; $mountDir = "\57\x6d\x6e\x74\57{$domain}"; $imgFile = "{$serviceDir}\x2f\x64\141\164\x61\56\151\155\x67"; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $puqContainer = $puqInfo["\143\157\156\x74\x61\x69\x6e\145\x72\x5f\x6e\141\x6d\145"] ?: $domain; $puqProject = $puqInfo["\x70\162\157\152\145\x63\164\x5f\x6e\x61\x6d\145"] ?: str_replace(array("\56", "\x2d"), '', $domain); $stopCmd = "\143\x64\40{$serviceDir}\x20\x26\46\40\x28\144\x6f\143\x6b\x65\x72\40\x63\x6f\x6d\x70\x6f\163\145\40\x2d\160\40{$puqProject}\x20\x64\x6f\167\x6e\40\55\x76\x20\174\x7c\40\144\157\143\x6b\145\x72\55\143\157\x6d\160\157\163\145\x20\55\x70\x20{$puqProject}\40\x64\x6f\167\156\40\55\166\x20\x7c\174\40\144\x6f\x63\153\x65\162\x20\163\x74\x6f\x70\40{$puqContainer}\51\x20\x32\76\x2f\144\145\x76\57\156\165\x6c\x6c\x20\x7c\x7c\40\164\x72\165\x65"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $stopCmd); $cleanupScript = "\xa\x20\x20\40\40\40\x20\40\40\x73\x75\144\x6f\x20\165\x6d\x6f\165\x6e\x74\x20\x2d\x6c\40{$mountDir}\40\x32\76\x2f\144\x65\166\57\156\165\x6c\x6c\40\174\x7c\x20\x74\x72\x75\x65\12\40\40\40\x20\x20\40\40\x20\163\x75\x64\157\40\163\x65\x64\x20\55\151\40\47\x5c\174{$imgFile}\x20{$mountDir}\174\144\47\x20\57\145\x74\x63\x2f\146\x73\x74\141\142\xa\40\x20\40\x20\x20\40\40\40\x73\165\144\x6f\40\162\x6d\x20\x2d\x72\x66\x20{$serviceDir}\12\x20\40\40\x20\x20\40\x20\40\163\165\x64\x6f\x20\162\155\x20\x2d\x72\146\40{$mountDir}\xa\x20\x20\40\x20\40\x20\x20\x20"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $cleanupScript); $customField = Capsule::table("\164\142\154\143\165\x73\x74\x6f\155\146\x69\x65\154\144\163")->where("\162\x65\154\151\x64", $params["\x70\141\x63\153\x61\147\145\151\144"])->where("\146\151\x65\154\144\156\141\155\145", "\123\x65\x72\166\151\x63\145\x20\104\145\164\x61\151\154\163")->first(); if ($customField) { Capsule::table("\x74\x62\x6c\143\x75\163\164\157\x6d\146\151\x65\154\x64\163\166\141\x6c\165\145\163")->where("\146\151\145\x6c\x64\x69\144", $customField->id)->where("\x72\x65\154\151\144", $serviceId)->delete(); } dockern8n_LogActivity($params, "\x73\145\x72\166\x69\x63\x65\137\x74\x65\162\155\151\x6e\141\164\x65\144", "\x4e\70\x4e\40\x54\x65\162\x6d\x69\x6e\141\x74\x65\x64\40\141\156\x64\40\143\154\145\141\x6e\x65\144\40\165\x70\40\x28\120\125\x51\x2d\123\164\171\154\x65\51"); return "\163\x75\143\143\x65\x73\x73"; } catch (Exception $e) { return "\124\145\162\155\x69\156\141\x74\x69\157\156\x20\106\x61\151\x6c\145\144\x3a\x20" . $e->getMessage(); } } goto xOLiq; H9Nyl: function dockern8n_ParseContainerState($stateOutput) { $state = trim($stateOutput, "\40\x9\xd\12\x0\xb\47\42"); $state = strtolower($state); if (empty($state) || $state === "\x65\x72\162\x6f\162" || strpos($state, "\145\162\162\x6f\x72") !== false || strpos($state, "\x6e\x6f\x20\x73\x75\143\150") !== false) { return "\x64\x65\154\145\x74\x65\144"; } if ($state === "\162\x75\x6e\x6e\151\x6e\147" || $state === "\x72\x65\163\164\141\162\164\x69\156\x67") { return "\x72\x75\x6e\156\x69\156\147"; } if (in_array($state, array("\x65\x78\151\x74\x65\144", "\163\164\x6f\160\x70\145\144", "\143\162\145\x61\164\145\144", "\x64\x65\x61\144", "\160\141\165\x73\x65\x64", "\162\x65\155\157\166\x69\156\x67"))) { return "\163\164\x6f\160\160\145\144"; } if (strpos($state, "\x72\165\156") !== false || strpos($state, "\165\x70") !== false) { return "\x72\165\156\x6e\x69\x6e\x67"; } if (strpos($state, "\x65\x78\151\164") !== false || strpos($state, "\163\x74\x6f\x70") !== false) { return "\x73\164\157\x70\x70\x65\144"; } return "\x75\x6e\x6b\x6e\157\167\156"; } goto fsFyn; agJLa: function dockern8n_formatBytes($bytes, $precision = 2) { $units = array("\102", "\113\x42", "\115\x42", "\107\x42", "\124\102"); $bytes = max($bytes, 0); $pow = floor(($bytes ? log($bytes) : 0) / log(1024)); $pow = min($pow, count($units) - 1); $bytes /= pow(1024, $pow); return round($bytes, $precision) . "\40" . $units[$pow]; } goto hrnsH; L2hEd: function dockern8n_ClientAreaCustomButtonArray() { return array("\123\x74\x61\x72\x74" => "\163\164\141\162\164", "\x53\x74\x6f\x70" => "\x73\x74\157\160"); } goto ZxzTw; dRn3F: function dockern8n_ResetPassword($params) { $newPassword = dockern8n_GeneratePassword(); $params["\160\141\x73\x73\167\157\162\144"] = $newPassword; $result = dockern8n_ChangePassword($params); if ($result === "\x73\x75\x63\x63\x65\x73\163") { Capsule::table("\164\142\154\x68\157\163\x74\x69\156\x67")->where("\x69\144", $params["\163\145\x72\x76\151\x63\145\x69\x64"])->update(array("\160\x61\x73\163\167\x6f\162\144" => encrypt($newPassword))); return array("\x73\x75\143\143\x65\163\x73" => true, "\x70\141\x73\163\167\157\162\144" => $newPassword); } else { return array("\x73\165\x63\x63\x65\x73\163" => false, "\155\145\163\x73\141\x67\x65" => $result); } } goto s32iR; VMhow: function dockern8n_deleteresources($params) { try { $hostname = $params["\x73\145\x72\x76\x65\162\x68\x6f\163\x74\x6e\141\x6d\x65"] ? $params["\x73\145\x72\x76\145\162\x68\x6f\163\x74\156\141\x6d\145"] : $params["\x73\145\x72\166\145\x72\151\160"]; $username = $params["\163\145\162\x76\145\x72\165\x73\145\x72\x6e\141\155\x65"]; $password = $params["\163\145\x72\166\x65\162\x70\141\163\x73\167\157\x72\x64"]; $serviceId = $params["\x73\x65\x72\x76\x69\143\145\x69\144"]; $serviceDir = "\x2f\x76\141\x72\x2f\167\x77\167\57\144\157\x63\153\x65\x72\156\x38\156\x2f\x73\x65\x72\x76\x69\143\x65\55{$serviceId}"; $cmd = "\143\144\x20{$serviceDir}\x20\46\46\40\144\x6f\x63\x6b\145\x72\40\x63\157\x6d\x70\157\x73\x65\x20\x64\x6f\167\x6e\x20\x2d\x76\x20\x26\x26\x20\x63\144\40\56\56\40\x26\46\x20\162\x6d\x20\55\x72\146\x20{$serviceDir}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $customField = Capsule::table("\x74\142\154\x63\x75\163\x74\157\x6d\146\151\145\x6c\144\x73")->where("\162\145\x6c\x69\144", $params["\x70\x61\143\153\141\147\145\151\144"])->where("\146\x69\x65\154\144\156\x61\155\145", "\123\x65\162\166\x69\143\x65\40\104\x65\x74\x61\151\x6c\163")->where("\164\171\160\x65", "\160\x72\x6f\x64\x75\x63\x74")->first(); if ($customField) { Capsule::table("\x74\142\x6c\143\165\x73\x74\x6f\155\146\151\x65\154\x64\163\x76\141\x6c\x75\145\x73")->where("\146\x69\x65\x6c\x64\x69\144", $customField->id)->where("\162\x65\x6c\x69\144", $serviceId)->delete(); } return "\x73\165\143\143\145\x73\163"; } catch (Exception $e) { return "\105\x72\162\x6f\x72\72\x20" . $e->getMessage(); } } goto HEGD4; Uggxt: function dockern8n_GetContainerInfo($params) { $serviceId = $params["\x73\x65\162\166\x69\143\145\151\x64"]; $hostname = $params["\x73\145\162\x76\x65\162\150\x6f\x73\164\x6e\x61\155\x65"] ?: $params["\x73\145\162\x76\145\162\x69\x70"]; $username = $params["\163\145\162\x76\x65\x72\x75\163\x65\x72\156\x61\x6d\145"]; $password = $params["\x73\145\x72\x76\x65\162\160\x61\x73\163\x77\157\162\144"]; $domain = $params["\x64\x6f\155\x61\x69\156"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $userId = $params["\165\163\x65\162\x69\144"]; $mainDomain = $params["\x63\157\156\146\151\147\x6f\x70\x74\151\x6f\x6e\x36"] ?? ''; if (empty($mainDomain)) { $parts = explode("\x2e", $domain, 2); $mainDomain = $parts[1] ?? $domain; } $mainDomain = preg_replace("\x23\x5e\150\164\x74\x70\x73\77\72\x2f\57\43", '', $mainDomain); $mainDomain = rtrim($mainDomain, "\57"); $prefix = "{$userId}\x2d{$serviceId}"; $cleanDomain = $mainDomain; $fullFQDN = "{$prefix}\x2e{$cleanDomain}"; $puqProject = $prefix . str_replace("\56", '', $cleanDomain); $info = array("\151\163\137\160\x75\x71" => $puqInfo["\x69\x73\137\x70\x75\161"], "\x73\145\x72\166\x69\x63\145\x5f\144\x69\x72" => $puqInfo["\x69\163\x5f\160\165\x71"] ? $puqInfo["\x73\145\x72\166\x69\143\x65\x5f\144\151\162"] : "\57\157\x70\164\57\144\x6f\143\x6b\145\162\57\x63\x6c\151\x65\x6e\x74\163\57{$fullFQDN}", "\x6e\x38\x6e\x5f\143\157\156\x74\x61\x69\156\x65\162" => $puqInfo["\151\x73\x5f\160\x75\x71"] ? $puqInfo["\143\157\156\x74\x61\151\156\145\162\x5f\156\141\x6d\145"] : $fullFQDN, "\x70\x6f\163\164\147\x72\145\163\137\143\x6f\156\164\141\151\156\145\x72" => "{$fullFQDN}\55\160\157\x73\x74\x67\162\145\163", "\x63\x6f\155\x70\157\163\x65\x5f\x66\151\x6c\x65" => ($puqInfo["\x73\x65\x72\166\151\x63\145\x5f\144\151\x72"] ?? "\x2f\x6f\160\x74\57\x64\x6f\x63\153\x65\x72\x2f\143\x6c\151\145\x6e\164\x73\x2f{$fullFQDN}") . "\x2f\x64\157\x63\x6b\x65\x72\55\x63\x6f\155\160\x6f\x73\x65\56\x79\x6d\x6c", "\x70\x72\x6f\152\x65\x63\x74\x5f\156\141\x6d\145" => $puqInfo["\x69\163\x5f\x70\x75\x71"] ? $puqInfo["\x70\x72\157\152\x65\143\x74\x5f\156\x61\x6d\x65"] ?? $puqProject : $puqProject, "\x6d\x6f\165\156\x74\x5f\144\x69\162" => $puqInfo["\151\163\x5f\x70\165\161"] ? $puqInfo["\x6d\157\165\156\x74\137\x64\x69\x72"] : "\x2f\155\x6e\164\57{$fullFQDN}", "\x66\157\x75\x6e\144" => $puqInfo["\x69\x73\137\160\165\161"]); if ($info["\151\163\137\x70\165\x71"]) { return $info; } $containerNames = array($fullFQDN, "\x73\x65\162\166\x69\143\145\55{$serviceId}\x2d\x6e\70\x6e", $cleanDomain); foreach ($containerNames as $cName) { $inspectCmd = "\x64\157\x63\x6b\145\162\40\151\156\x73\160\x65\143\164\40{$cName}\x20\55\55\x66\x6f\x72\x6d\141\164\40\47\x7b\173\40\151\x6e\144\145\170\40\56\103\x6f\156\x66\x69\x67\56\x4c\141\142\145\154\163\x20\x22\143\157\x6d\56\144\157\143\153\145\162\56\143\x6f\x6d\x70\157\163\145\56\x70\x72\157\152\145\x63\x74\56\167\157\x72\153\x69\x6e\x67\137\144\x69\x72\x22\x20\175\x7d\x7c\173\173\40\x69\x6e\144\145\170\40\x2e\x43\x6f\156\x66\x69\x67\56\114\141\142\145\x6c\163\x20\42\143\157\x6d\56\x64\x6f\x63\x6b\145\162\56\x63\157\x6d\x70\x6f\163\145\56\160\x72\157\x6a\x65\143\x74\x22\x20\x7d\x7d\x27\40\x32\76\57\144\x65\x76\57\156\165\154\154"; $metadata = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $inspectCmd)); if (!empty($metadata) && strpos($metadata, "\x7c") !== false && strpos($metadata, "\105\x72\162\157\162\x3a\x20\116\157\40\x73\x75\143\x68\40\157\142\x6a\x65\x63\164") === false) { list($workDir, $project) = explode("\174", $metadata); if ($workDir && $workDir != "\74\156\x6f\40\166\x61\154\x75\x65\76") { $info["\163\x65\x72\166\151\x63\x65\137\144\151\x72"] = rtrim($workDir, "\57"); $info["\x63\157\x6d\x70\157\163\x65\x5f\x66\151\154\145"] = $info["\163\x65\162\166\x69\143\x65\137\144\151\x72"] . "\x2f\x64\x6f\x63\x6b\145\x72\x2d\x63\157\x6d\160\157\x73\145\x2e\x79\x6d\154"; $info["\x70\x72\157\x6a\x65\x63\164\x5f\156\x61\155\145"] = $project && $project != "\x3c\156\157\40\x76\141\154\165\145\76" ? $project : $puqProject; $info["\x6e\x38\156\x5f\143\x6f\156\164\x61\151\156\145\162"] = $cName; $info["\146\157\165\156\x64"] = true; return $info; } } } $customField = Capsule::table("\x74\x62\154\143\x75\163\x74\x6f\155\146\151\145\154\x64\x73")->where("\162\x65\154\151\x64", $params["\x70\x61\x63\x6b\141\147\x65\151\144"])->where("\146\151\x65\154\x64\x6e\141\x6d\x65", "\123\x65\x72\x76\x69\x63\x65\40\104\x65\164\x61\151\x6c\163")->where("\x74\171\160\x65", "\160\x72\157\x64\x75\143\164")->first(); if ($customField) { $value = Capsule::table("\x74\142\x6c\143\x75\x73\164\x6f\x6d\146\x69\145\154\x64\x73\x76\141\x6c\165\x65\x73")->where("\146\151\x65\154\144\x69\144", $customField->id)->where("\x72\145\154\151\144", $serviceId)->value("\166\x61\154\165\145"); if ($value) { $details = json_decode(html_entity_decode($value), true); if (!empty($details["\163\x65\x72\x76\151\x63\x65\x5f\144\151\x72"])) { $info["\x73\145\x72\166\151\143\145\137\144\x69\162"] = rtrim($details["\x73\145\x72\166\151\143\145\137\x64\151\x72"], "\57"); $info["\x63\x6f\x6d\x70\157\163\x65\137\146\x69\x6c\x65"] = $info["\x73\x65\x72\x76\151\x63\x65\137\144\x69\162"] . "\x2f\144\157\143\x6b\x65\162\x2d\143\x6f\x6d\160\x6f\x73\145\x2e\171\155\154"; } } } return $info; } goto kd1ON; XrbTP: function dockern8n_GetDiskUsage($params) { try { $hostname = $params["\163\145\162\x76\x65\162\150\157\x73\164\x6e\141\x6d\x65"] ? $params["\163\145\162\166\x65\162\x68\157\x73\x74\x6e\x61\155\x65"] : $params["\x73\x65\162\x76\145\x72\x69\x70"]; $username = $params["\163\145\162\166\145\162\x75\163\145\162\x6e\x61\155\145"]; $password = $params["\163\x65\x72\166\x65\162\160\x61\x73\163\167\157\x72\144"]; $serviceId = $params["\163\x65\162\166\x69\x63\145\x69\x64"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); if ($puqInfo["\x69\163\137\160\165\x71"]) { $mountDir = $puqInfo["\x6d\157\x75\x6e\x74\137\144\x69\162"]; $cmdDu = "\144\165\40\55\163\150\40{$mountDir}\x20\62\x3e\57\x64\x65\166\57\156\165\x6c\154\x20\x7c\x20\143\165\164\40\55\x66\x31"; $diskUsed = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdDu)); $diskLimit = isset($params["\143\157\x6e\146\x69\x67\157\160\164\151\157\156\x35"]) ? $params["\x63\x6f\x6e\x66\x69\147\157\160\x74\x69\157\156\65"] : "\65\x47"; $totalBytes = dockern8n_parseDiskSize($diskUsed ?: "\60"); $limitBytes = dockern8n_parseDiskSize($diskLimit); $percentUsed = $limitBytes > 0 ? round($totalBytes / $limitBytes * 100, 1) : 0; return array("\165\x73\145\144" => $diskUsed ?: "\x30\x42", "\x6c\151\x6d\151\x74" => $diskLimit, "\160\x65\x72\x63\x65\x6e\164" => $percentUsed, "\x6e\x38\156\x5f\x64\x61\164\141" => $diskUsed ?: "\60\102", "\x70\x6f\x73\164\x67\x72\145\163\137\x64\141\164\x61" => "\60\102"); } $volumePrefix = "\x73\x65\162\166\x69\x63\x65\55{$serviceId}"; $cmdN8n = "\x64\157\x63\153\145\x72\40\163\171\x73\x74\145\x6d\x20\144\x66\x20\x2d\x76\x20\x32\76\x2f\144\x65\166\x2f\x6e\x75\154\154\x20\x7c\x20\147\x72\x65\160\40\47{$volumePrefix}\x5f\156\x38\x6e\137\x64\x61\164\141\x27\40\174\40\x61\x77\153\x20\x27\x7b\x70\x72\x69\156\164\40\x24\x33\175\x27"; $n8nSize = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdN8n)); $cmdPg = "\x64\x6f\x63\x6b\145\162\40\x73\x79\x73\164\x65\x6d\x20\144\146\40\x2d\x76\x20\62\x3e\x2f\144\x65\x76\x2f\x6e\165\x6c\154\40\x7c\40\x67\162\x65\x70\40\47{$volumePrefix}\137\x70\157\x73\164\147\x72\145\x73\x5f\x64\141\164\x61\47\40\174\x20\x61\x77\x6b\x20\47\173\160\162\151\156\164\40\44\63\x7d\47"; $pgSize = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdPg)); if (empty($n8nSize)) { $cmdDir = "\144\165\x20\55\163\x68\40\x2f\166\x61\162\57\x6c\151\x62\x2f\144\x6f\x63\153\x65\x72\x2f\166\x6f\154\x75\155\x65\x73\x2f{$volumePrefix}\137\156\70\x6e\x5f\144\x61\x74\x61\57\137\144\x61\x74\141\40\62\76\x2f\144\145\x76\x2f\x6e\x75\154\x6c\x20\x7c\x20\143\x75\164\40\x2d\146\61"; $n8nSize = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdDir)); } if (empty($pgSize)) { $cmdDir = "\144\x75\40\x2d\x73\150\x20\57\166\141\162\x2f\154\x69\x62\57\144\x6f\x63\153\x65\x72\57\x76\157\154\165\x6d\145\x73\57{$volumePrefix}\137\x70\x6f\x73\164\147\162\x65\163\x5f\x64\141\164\x61\x2f\x5f\144\141\164\x61\x20\x32\x3e\57\144\x65\166\x2f\x6e\165\154\154\40\x7c\40\143\x75\x74\40\55\146\x31"; $pgSize = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdDir)); } $diskLimit = "\65\x47"; if (isset($params["\x63\157\156\146\x69\147\157\160\164\151\157\x6e\x35"]) && !empty($params["\x63\x6f\x6e\x66\x69\147\157\x70\164\x69\157\156\65"])) { $diskLimit = $params["\x63\x6f\156\146\151\147\157\x70\x74\151\x6f\x6e\x35"]; } $totalBytes = dockern8n_parseDiskSize($n8nSize ?: "\x30") + dockern8n_parseDiskSize($pgSize ?: "\60"); $limitBytes = dockern8n_parseDiskSize($diskLimit); $usedFormatted = dockern8n_formatBytes($totalBytes); $percentUsed = $limitBytes > 0 ? round($totalBytes / $limitBytes * 100, 1) : 0; return array("\165\x73\x65\144" => $usedFormatted, "\x6c\151\x6d\151\164" => $diskLimit, "\160\145\x72\x63\145\156\164" => $percentUsed, "\x6e\70\156\x5f\144\x61\164\141" => $n8nSize ?: "\x30\x42", "\160\157\x73\x74\x67\162\145\x73\137\144\141\x74\x61" => $pgSize ?: "\60\x42"); } catch (Exception $e) { return array("\165\163\145\144" => "\60\x42", "\154\x69\x6d\x69\164" => "\x55\x6e\153\x6e\157\167\156", "\160\x65\x72\143\145\156\x74" => 0, "\145\x72\162\157\x72" => $e->getMessage()); } } goto RHTVm; eeqE8: function dockern8n_log($module, $action, $request, $response, $processed = '') { if (defined("\104\117\103\113\x45\122\116\70\x4e\x5f\104\105\x42\x55\107\x5f\114\x4f\x47\107\111\116\x47") && DOCKERN8N_DEBUG_LOGGING === true) { } } goto RcVrm; ndKH3: function dockern8n_SoftReset($params) { try { $serviceId = $params["\163\x65\162\166\151\x63\x65\151\x64"]; $hostname = $params["\163\x65\x72\166\145\162\x68\157\163\x74\x6e\x61\155\145"] ?: $params["\x73\x65\162\166\x65\x72\151\x70"]; $username = $params["\x73\145\x72\166\145\162\x75\x73\145\x72\x6e\x61\x6d\x65"]; $password = $params["\163\145\x72\166\x65\162\160\x61\x73\163\x77\x6f\x72\144"]; $info = dockern8n_GetContainerInfo($params); $n8nContainer = $info["\156\x38\x6e\137\x63\x6f\x6e\164\141\151\x6e\145\162"]; $dbPath = ''; if ($info["\151\x73\137\160\x75\161"]) { $dbPath = ($info["\155\x6f\x75\156\x74\137\144\151\x72"] ?: "\x2f\x6d\x6e\x74\x2f" . $params["\144\x6f\155\x61\x69\156"]) . "\x2f\x64\141\x74\141\142\x61\x73\145\x2e\163\161\x6c\x69\x74\x65"; } else { $dbPath = $info["\163\x65\162\x76\x69\143\x65\137\x64\151\x72"] . "\x2f\x6e\x38\156\55\144\141\x74\x61\57\144\141\164\141\142\141\163\x65\56\x73\x71\x6c\x69\x74\x65"; } $sql = "\x44\x45\x4c\105\x54\105\40\x46\122\x4f\x4d\40\x70\162\x6f\152\x65\143\164\137\155\x65\x6d\x62\x65\x72\163\150\x69\160\x3b\40\x44\x45\114\x45\x54\105\40\x46\x52\117\115\40\165\163\x65\x72\x5f\162\x6f\x6c\x65\163\73\x20\104\x45\114\105\124\x45\40\106\x52\x4f\x4d\40\141\x75\x74\150\137\x69\x64\x65\x6e\164\x69\164\171\x3b\x20\104\105\114\105\x54\x45\40\106\122\117\115\x20\42\165\x73\x65\x72\x22\x3b\x20\x44\x45\114\105\124\105\x20\106\122\117\x4d\40\x72\157\154\x65\x3b"; $cmdReset = "\144\157\143\153\145\x72\x20\x65\170\x65\143\x20\55\x75\x20\x6e\157\x64\145\40{$n8nContainer}\x20\156\x38\x6e\x20\165\x73\x65\162\55\x6d\141\156\x61\x67\145\155\145\x6e\164\x3a\x72\x65\163\x65\x74\40\x2d\x2d\171\145\163\40\62\x3e\46\x31"; $resReset = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdReset, 120); if (stripos($resReset, "\105\162\162\x6f\x72") !== false || stripos($resReset, "\x66\141\151\154\145\144") !== false || stripos($resReset, "\156\x6f\164\40\146\x6f\165\x6e\x64") !== false) { $resetSqlCmd = "\x28\x5b\x20\55\x66\x20{$dbPath}\x20\x5d\x20\46\x26\x20\x28\163\165\x64\157\x20\163\x71\154\x69\x74\145\63\40{$dbPath}\40\47{$sql}\x27\40\x7c\174\x20\163\161\154\x69\164\145\x33\40{$dbPath}\40\47{$sql}\x27\x29\51\40\62\76\46\x31"; $resSql = dockern8n_ssh_RunCommand($hostname, $username, $password, $resetSqlCmd, 60); if (stripos($resSql, "\105\162\162\157\x72") !== false) { $sidecar = "\x64\x6f\x63\x6b\x65\162\40\162\165\156\40\x2d\x2d\x72\x6d\40\x2d\x76\x20" . ($info["\151\163\x5f\160\x75\x71"] ? $info["\x6d\157\x75\x6e\164\x5f\144\151\162"] ?: "\x2f\155\156\x74\x2f" . $params["\x64\x6f\155\x61\151\x6e"] : "{$info["\160\x72\x6f\152\145\x63\x74\x5f\156\x61\155\x65"]}\x5f\156\x38\156\x2d\144\141\164\141") . "\72\57\x64\141\x74\x61\x20\141\154\160\x69\x6e\x65\x20\163\x68\x20\x2d\143\40\42\141\x70\x6b\40\x61\144\144\40\55\x2d\x6e\157\x2d\143\141\x63\x68\145\x20\x73\x71\154\151\x74\x65\40\x26\x26\40\x73\x71\154\x69\164\x65\x33\x20\x2f\x64\141\164\x61\x2f\x64\141\164\141\x62\141\x73\x65\56\163\161\154\151\164\x65\x20\47{$sql}\x27\42\x20\x32\76\x26\61"; dockern8n_ssh_RunCommand($hostname, $username, $password, $sidecar, 120); } } dockern8n_ssh_RunCommand($hostname, $username, $password, "\x64\157\143\153\145\162\40\x72\145\x73\x74\x61\162\164\x20{$n8nContainer}\x20\62\x3e\46\61"); dockern8n_LogActivity($params, "\x73\x6f\146\x74\x5f\162\x65\163\145\x74", "\x4e\x38\x4e\x20\x73\x6f\x66\x74\x20\162\x65\x73\145\164\x20\145\170\145\143\x75\x74\x65\144\x2e\40\x55\x73\145\x72\163\40\x63\154\145\141\x72\145\144\56"); unset($GLOBALS["\x64\x6f\x63\153\x65\x72\x6e\x38\x6e\137\163\164\x61\164\165\x73\x5f\143\x61\x63\150\145"]["\x73\x74\x61\164\165\163\137" . $serviceId]); return array("\x73\x75\x63\x63\145\x73\x73" => true, "\x6d\145\163\x73\x61\147\x65" => "\x53\157\146\164\x20\162\145\163\x65\164\40\x73\165\143\x63\x65\x73\163\41\40\x55\x73\x65\x72\x73\x20\x61\x6e\x64\40\x72\x6f\154\x65\x73\40\150\141\166\145\x20\x62\x65\x65\x6e\40\x63\154\x65\x61\162\145\x64\x2e\x20\x59\157\x75\40\x63\x61\x6e\x20\156\157\x77\x20\x73\145\x74\165\160\40\x61\x20\x6e\x65\167\x20\x6f\167\156\x65\162\x20\x61\143\143\x6f\165\156\x74\x2e"); } catch (Exception $e) { return array("\163\x75\143\143\x65\x73\163" => false, "\155\x65\163\163\141\x67\x65" => $e->getMessage()); } } goto H09a_; gPycU: function dockern8n_ImportWorkflows($params, $workflowData, $defaultName = "\111\155\x70\x6f\x72\x74\145\x64\40\x57\x6f\162\x6b\146\x6c\x6f\167") { try { $hostname = $params["\163\x65\162\x76\145\162\x68\x6f\x73\164\156\141\x6d\145"] ?: $params["\x73\x65\x72\x76\145\162\151\160"]; $username = $params["\163\145\x72\166\145\162\165\163\145\x72\156\141\155\x65"]; $password = $params["\x73\x65\x72\166\145\x72\160\141\x73\x73\167\x6f\x72\x64"]; $serviceId = $params["\163\145\x72\x76\151\143\145\151\144"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $containerName = $puqInfo["\x69\163\137\x70\x75\161"] ? $puqInfo["\x63\x6f\x6e\164\141\x69\156\x65\x72\x5f\156\141\x6d\x65"] : "\163\145\162\166\151\143\x65\55{$serviceId}\55\x6e\x38\156"; if (empty($workflowData)) { return array("\163\165\x63\x63\145\x73\163" => false, "\155\145\x73\163\141\x67\145" => "\116\157\40\x77\x6f\162\153\x66\154\157\x77\40\144\141\x74\x61\40\x70\162\157\x76\x69\144\145\144"); } $jsonData = json_decode($workflowData, true); if ($jsonData === null) { return array("\x73\x75\x63\x63\145\x73\x73" => false, "\x6d\145\x73\x73\141\147\x65" => "\x49\x6e\x76\141\154\x69\144\x20\x4a\x53\x4f\x4e\40\x66\x69\154\x65"); } $sanitizeWorkflow = function ($workflow) use($defaultName) { if (is_array($workflow)) { if (!isset($workflow["\x61\143\164\x69\x76\x65"])) { $workflow["\x61\x63\164\x69\x76\145"] = false; } if (empty($workflow["\156\141\x6d\145"])) { $workflow["\156\141\155\x65"] = $defaultName . "\40" . date("\x59\x2d\x6d\55\144\x20\x48\x3a\151"); } if (!isset($workflow["\x76\145\162\x73\151\x6f\x6e\x49\144"])) { $workflow["\x76\145\162\163\151\x6f\156\x49\144"] = sprintf("\x25\60\x34\170\x25\x30\x34\170\55\x25\x30\x34\x78\x2d\45\x30\64\170\55\45\x30\x34\x78\55\x25\x30\64\x78\45\60\x34\170\45\x30\64\x78", mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 4095) | 16384, mt_rand(0, 16383) | 32768, mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535)); } if (!isset($workflow["\x6e\x6f\144\145\x73"])) { $workflow["\x6e\157\x64\145\x73"] = array(); } if (!isset($workflow["\143\157\156\x6e\x65\143\x74\151\x6f\156\x73"])) { $workflow["\143\157\156\x6e\x65\x63\x74\x69\157\156\163"] = array(); } } return $workflow; }; $importResults = array(); $hasCredentials = false; if (isset($jsonData["\167\157\x72\x6b\x66\x6c\157\167\x73"]) && is_array($jsonData["\x77\157\x72\x6b\x66\x6c\157\167\163"])) { foreach ($jsonData["\x77\157\162\x6b\146\154\157\x77\163"] as $k => $wf) { $jsonData["\167\x6f\x72\153\x66\x6c\157\167\x73"][$k] = $sanitizeWorkflow($wf); } $workflowsJson = json_encode($jsonData["\x77\x6f\162\153\x66\154\157\x77\163"]); $hasCredentials = isset($jsonData["\x63\x72\145\x64\145\156\164\151\141\x6c\x73"]) && !empty($jsonData["\x63\x72\x65\x64\x65\x6e\x74\x69\141\154\x73"]); $b64Workflows = base64_encode($workflowsJson); $cmdSaveWorkflows = "\145\x63\150\157\40\x27{$b64Workflows}\x27\40\x7c\40\142\141\x73\145\x36\64\40\x2d\144\40\x3e\40\57\164\x6d\x70\57\x77\157\x72\x6b\146\x6c\157\x77\x73\137\151\x6d\x70\x6f\162\x74\x2e\152\163\157\156"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdSaveWorkflows); $cmdCopyWorkflows = "\x64\157\143\153\x65\x72\40\x63\x70\x20\57\164\155\x70\x2f\x77\x6f\162\153\146\154\157\x77\163\x5f\151\155\160\157\162\x74\56\x6a\163\x6f\x6e\40{$containerName}\72\x2f\164\155\160\57\x77\157\162\x6b\146\154\157\x77\x73\56\152\163\157\156\40\x32\76\46\61"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCopyWorkflows); $cmdImportWorkflows = "\x64\x6f\x63\153\145\x72\x20\145\170\x65\x63\x20{$containerName}\x20\x6e\70\x6e\x20\151\155\160\157\x72\x74\72\167\157\x72\x6b\x66\x6c\x6f\x77\x20\x2d\x2d\x69\x6e\160\x75\x74\x3d\57\x74\x6d\160\x2f\x77\x6f\x72\153\146\154\157\x77\163\x2e\152\163\157\x6e\x20\x32\76\x26\61"; $workflowOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdImportWorkflows); $importResults[] = "\x57\157\162\153\146\154\157\x77\x73\x3a\x20" . trim($workflowOutput); if ($hasCredentials) { $credentialsJson = json_encode($jsonData["\x63\162\145\144\145\156\x74\x69\x61\154\x73"]); $b64Creds = base64_encode($credentialsJson); $cmdSaveCreds = "\145\143\150\x6f\x20\47{$b64Creds}\x27\40\174\40\x62\141\163\145\x36\64\x20\x2d\144\x20\x3e\40\x2f\164\x6d\x70\x2f\143\x72\145\144\x65\156\164\x69\141\154\163\x5f\151\155\160\x6f\x72\164\x2e\152\x73\157\x6e"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdSaveCreds); $cmdCopyCreds = "\x64\x6f\x63\153\145\162\40\x63\160\x20\57\164\155\x70\x2f\143\162\145\x64\x65\156\164\x69\141\154\x73\137\151\x6d\160\157\162\164\x2e\x6a\x73\157\x6e\x20{$containerName}\72\57\x74\155\160\x2f\x63\x72\x65\x64\x65\156\x74\151\141\x6c\x73\x2e\x6a\x73\x6f\x6e\x20\x32\76\46\x31"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCopyCreds); $cmdImportCreds = "\144\157\x63\153\x65\x72\x20\145\x78\x65\143\x20{$containerName}\x20\156\70\x6e\x20\151\x6d\x70\157\162\x74\x3a\143\162\x65\144\145\x6e\x74\151\x61\x6c\x73\40\x2d\55\x69\x6e\160\165\164\75\57\x74\x6d\x70\57\143\x72\145\144\145\x6e\164\x69\141\x6c\x73\56\x6a\163\157\x6e\40\62\x3e\x26\61"; $credsOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdImportCreds); $importResults[] = "\x43\162\x65\x64\x65\x6e\164\x69\x61\x6c\x73\x3a\x20" . trim($credsOutput); dockern8n_ssh_RunCommand($hostname, $username, $password, "\x72\155\x20\x2d\146\40\57\164\155\160\57\143\x72\x65\144\x65\156\x74\151\141\154\163\137\151\x6d\160\x6f\x72\x74\x2e\152\163\x6f\156"); dockern8n_ssh_RunCommand($hostname, $username, $password, "\x64\157\143\x6b\145\x72\40\145\x78\x65\143\x20{$containerName}\x20\162\155\40\x2d\x66\40\x2f\x74\x6d\160\57\143\x72\145\x64\x65\156\x74\151\141\154\163\56\x6a\x73\157\156\40\62\x3e\x2f\x64\x65\x76\x2f\156\x75\x6c\154"); } dockern8n_ssh_RunCommand($hostname, $username, $password, "\x72\x6d\40\55\146\x20\x2f\x74\x6d\x70\57\167\157\x72\153\x66\154\x6f\x77\x73\x5f\151\155\160\157\x72\164\x2e\x6a\163\x6f\x6e"); dockern8n_ssh_RunCommand($hostname, $username, $password, "\144\x6f\143\153\145\162\40\x65\x78\x65\x63\x20{$containerName}\x20\x72\155\40\55\146\x20\x2f\164\x6d\160\57\167\157\x72\153\146\154\x6f\167\163\56\x6a\163\157\x6e\x20\62\x3e\x2f\144\145\166\57\x6e\165\x6c\154"); } else { if (isset($jsonData["\x6e\x6f\x64\x65\x73"]) && isset($jsonData["\143\x6f\x6e\x6e\x65\x63\x74\151\x6f\156\163"])) { $jsonData = array($sanitizeWorkflow($jsonData)); } elseif (is_array($jsonData)) { foreach ($jsonData as $k => $wf) { $jsonData[$k] = $sanitizeWorkflow($wf); } } $workflowData = json_encode($jsonData); $b64Data = base64_encode($workflowData); $cmdUpload = "\145\143\150\157\x20\47{$b64Data}\47\40\x7c\40\142\141\163\145\66\64\x20\55\x64\x20\76\x20\57\x74\x6d\x70\57\167\x6f\x72\153\146\154\157\x77\137\151\x6d\x70\157\x72\x74\x2e\152\163\157\x6e"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdUpload); $cmdCopy = "\144\157\x63\x6b\x65\x72\40\x63\160\x20\57\164\x6d\160\57\x77\157\x72\x6b\146\154\157\167\x5f\x69\x6d\x70\157\x72\164\x2e\152\x73\x6f\x6e\40{$containerName}\x3a\57\164\155\160\57\151\x6d\160\x6f\x72\x74\x2e\x6a\x73\157\x6e\x20\x32\x3e\46\x31"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCopy); $cmdImport = "\x64\x6f\143\153\x65\x72\x20\x65\170\145\x63\x20{$containerName}\x20\156\x38\156\x20\151\x6d\160\157\x72\164\72\x77\157\162\x6b\x66\x6c\157\x77\40\55\x2d\x69\156\x70\165\x74\75\x2f\x74\x6d\x70\57\x69\x6d\160\157\162\164\56\x6a\163\157\x6e\40\62\x3e\x26\x31"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdImport); $importResults[] = trim($output); dockern8n_ssh_RunCommand($hostname, $username, $password, "\x72\155\40\55\x66\40\57\164\x6d\x70\57\167\x6f\162\153\x66\154\x6f\167\x5f\151\x6d\x70\x6f\162\x74\x2e\152\x73\x6f\x6e"); dockern8n_ssh_RunCommand($hostname, $username, $password, "\144\157\143\153\x65\x72\40\x65\170\145\x63\x20{$containerName}\40\x72\x6d\40\x2d\146\x20\57\164\x6d\x70\57\151\155\x70\x6f\162\x74\56\x6a\163\x6f\156\x20\x32\76\x2f\144\x65\x76\57\156\x75\154\x6c"); } $resultText = implode("\12", $importResults); if (stripos($resultText, "\x65\x72\162\x6f\x72") !== false && stripos($resultText, "\x73\165\143\x63\x65\x73\x73\146\165\x6c\x6c\x79") === false && stripos($resultText, "\151\x6d\x70\x6f\162\164\x65\144") === false) { return array("\163\165\143\143\x65\163\163" => false, "\155\x65\x73\163\x61\x67\x65" => "\x49\155\x70\x6f\x72\164\40\146\141\x69\x6c\145\x64\72\x20" . $resultText); } $message = "\127\157\162\153\146\154\x6f\167\163\40\151\155\x70\x6f\162\x74\145\x64\40\163\165\143\x63\145\163\163\146\x75\154\x6c\x79\x21\40\131\157\x75\40\155\141\x79\x20\x6e\x65\x65\144\40\x74\157\40\x61\x63\x74\151\166\141\x74\145\40\x74\150\x65\155\x20\151\x6e\40\x4e\70\116\x2e"; if ($hasCredentials) { $message = "\127\157\x72\153\x66\154\157\x77\x73\x20\141\x6e\144\x20\x63\x72\x65\144\x65\156\x74\x69\x61\x6c\x73\40\151\155\x70\x6f\162\164\x65\144\40\x73\165\143\143\x65\163\x73\x66\165\x6c\154\171\x21"; } return array("\163\165\143\143\x65\x73\163" => true, "\155\x65\163\163\x61\147\x65" => $message, "\144\145\x74\141\x69\154\163" => $resultText); } catch (Exception $e) { return array("\x73\165\x63\x63\145\x73\x73" => false, "\x6d\145\x73\x73\141\x67\x65" => $e->getMessage()); } } goto J4hYN; wzZ6o: function dockern8n_GeneratePassword($length = 16) { return bin2hex(random_bytes($length / 2)); } goto E3W1q; VQofT: function dockern8n_ssh_RunAsync($hostname, $username, $password, $command, $logFile = "\57\144\x65\x76\57\156\x75\154\x6c") { try { $escapedCmd = str_replace("\x27", "\47\134\47\47", $command); $asyncCmd = "\x6e\x6f\150\x75\160\40\142\141\163\x68\40\x2d\143\40\x27{$escapedCmd}\x27\40\x3e\40{$logFile}\x20\x32\76\46\61\x20\46\12\145\x78\x69\164\xa"; $ssh = dockern8n_ssh_GetConnection($hostname, $username, $password); $ssh->setTimeout(1); $ssh->write($asyncCmd); usleep(100000); return true; } catch (Exception $e) { return false; } } goto FL29g; v4dvM: function dockern8n_UpdateIPWhitelist($params, $enabled, $ips) { try { $serviceId = $params["\163\145\162\x76\x69\143\145\151\x64"]; $hostname = $params["\x73\x65\x72\x76\145\x72\150\157\163\164\156\141\x6d\x65"] ?: $params["\163\x65\x72\x76\145\x72\151\x70"]; $username = $params["\x73\145\x72\166\145\x72\x75\163\x65\x72\x6e\141\155\x65"]; $password = $params["\163\x65\x72\166\145\162\x70\x61\x73\163\x77\x6f\x72\x64"]; $domain = preg_replace("\43\136\x68\164\x74\x70\x73\77\72\x2f\x2f\x23", '', $params["\x64\157\x6d\141\x69\x6e"] ?? ''); $domain = rtrim($domain, "\57"); $validIps = array(); if (is_array($ips)) { foreach ($ips as $ip) { $ip = trim($ip); if (!empty($ip) && (filter_var($ip, FILTER_VALIDATE_IP) || preg_match("\x2f\x5e\133\x5c\x64\x5c\x2e\x5d\x2b\x5c\57\134\144\53\x24\57", $ip))) { $validIps[] = $ip; } } } $whitelist = array("\x65\x6e\141\x62\154\145\144" => (bool) $enabled, "\151\160\163" => $validIps, "\x75\x70\x64\141\x74\145\144\137\141\164" => date("\x59\55\155\x2d\x64\x20\x48\72\151\72\163")); $customField = Capsule::table("\164\142\x6c\143\x75\163\164\x6f\155\146\x69\145\x6c\x64\163")->where("\162\x65\154\x69\144", $params["\x70\141\x63\153\141\x67\145\x69\144"])->where("\x66\151\x65\x6c\x64\x6e\x61\155\x65", "\x53\145\x72\166\x69\143\x65\40\x44\145\164\x61\x69\154\x73")->where("\164\171\160\x65", "\160\162\x6f\x64\165\143\x74")->first(); if ($customField) { $value = Capsule::table("\164\x62\154\x63\x75\x73\x74\x6f\x6d\146\151\145\x6c\x64\163\x76\x61\154\x75\145\163")->where("\146\x69\x65\x6c\x64\151\x64", $customField->id)->where("\x72\145\x6c\x69\144", $serviceId)->value("\x76\141\154\165\145"); $details = $value ? json_decode(html_entity_decode($value), true) : array(); $details["\x69\160\x5f\x77\x68\151\x74\x65\154\151\x73\164"] = $whitelist; Capsule::table("\164\x62\x6c\x63\165\x73\x74\157\x6d\146\151\x65\154\x64\163\166\141\x6c\165\x65\163")->where("\146\151\x65\154\144\x69\x64", $customField->id)->where("\162\145\x6c\x69\144", $serviceId)->update(array("\x76\141\x6c\165\x65" => json_encode($details))); } $status = $enabled && !empty($validIps) ? "\x65\156\x61\142\154\145\144" : "\x64\x69\x73\x61\142\x6c\145\144"; $cfIps = array("\x31\x37\x33\56\x32\x34\x35\x2e\64\70\56\60\x2f\x32\x30", "\61\60\63\x2e\62\x31\56\62\x34\x34\x2e\60\57\62\x32", "\x31\60\63\56\x32\x32\x2e\62\x30\60\56\x30\57\x32\x32", "\61\x30\63\x2e\x33\61\56\x34\56\x30\57\62\62", "\x31\x34\61\56\x31\x30\x31\x2e\66\64\56\60\x2f\61\70", "\x31\60\70\x2e\61\66\x32\x2e\61\71\62\x2e\60\x2f\61\x38", "\61\x39\x30\x2e\x39\63\56\62\x34\60\x2e\x30\57\x32\x30", "\x31\x38\70\x2e\x31\61\x34\x2e\71\66\56\x30\x2f\x32\60", "\x31\x39\67\x2e\62\63\x34\x2e\62\64\60\56\60\x2f\x32\x32", "\x31\71\x38\x2e\64\61\x2e\x31\x32\x38\56\x30\x2f\61\x37", "\61\66\62\x2e\x31\x35\x38\56\60\x2e\x30\57\61\x35", "\61\60\64\56\61\x36\56\60\56\x30\57\x31\x33", "\x31\60\64\x2e\62\x34\56\x30\x2e\60\57\61\x34", "\61\67\62\x2e\66\x34\56\x30\56\x30\x2f\61\63", "\61\x33\x31\x2e\60\x2e\67\x32\56\60\x2f\x32\62"); $vhostPaths = array("\57\157\x70\164\x2f\x64\x6f\x63\153\x65\162\x2f\156\x67\x69\156\170\55\x70\x72\x6f\x78\171\x2f\156\147\151\156\170\x2f\166\150\x6f\x73\x74\56\144", "\x2f\145\164\x63\57\x6e\x67\x69\156\170\x2f\166\x68\x6f\x73\x74\x2e\144", "\x2f\x6f\x70\x74\x2f\x64\157\143\153\x65\x72\x2f\156\147\151\x6e\x78\x2f\x76\150\157\163\x74\x2e\144", "\57\166\141\162\x2f\x77\x77\167\x2f\x64\157\143\x6b\x65\162\156\70\x6e\57\x6e\147\x69\x6e\x78\x2f\x76\150\x6f\x73\x74\x2e\144", "\x2f\x6f\x70\164\57\x70\x72\157\x78\x79\x2f\x6e\x67\151\x6e\170\57\166\150\x6f\x73\x74\56\x64", "\x2f\x6f\x70\164\x2f\x64\157\x63\153\x65\x72\57\x6e\x67\x69\156\x78\x2d\x70\162\157\170\x79\57\166\150\157\x73\164\56\144"); if ($enabled && !empty($validIps)) { $nginxConf = "\x23\x20\111\x50\x20\x57\150\x69\x74\145\x6c\x69\163\x74\40\x66\x6f\162\40{$domain}\40\55\40\103\162\145\141\x74\x65\144\x20\x62\171\x20\104\157\143\x6b\x65\x72\116\x38\x4e\xa"; $nginxConf .= "\x72\145\x61\x6c\137\x69\x70\x5f\150\145\x61\144\x65\x72\40\130\55\106\x6f\x72\x77\x61\x72\x64\x65\144\x2d\x46\x6f\x72\x3b\12"; $nginxConf .= "\x72\145\141\154\137\151\160\x5f\162\x65\143\165\162\x73\x69\x76\x65\40\157\x6e\73\xa"; $nginxConf .= "\163\x65\164\137\x72\x65\x61\x6c\137\151\160\x5f\x66\x72\157\155\40\61\x32\67\56\60\x2e\x30\56\x31\73\xa"; $nginxConf .= "\x73\x65\x74\137\162\x65\x61\x6c\137\151\160\x5f\x66\162\x6f\x6d\x20\61\60\x2e\x30\56\x30\56\60\x2f\x38\x3b\12"; $nginxConf .= "\x73\x65\164\137\162\x65\141\x6c\137\151\x70\x5f\x66\x72\x6f\155\x20\61\67\x32\x2e\x31\66\x2e\60\x2e\x30\x2f\x31\62\73\12"; $nginxConf .= "\x73\x65\x74\137\162\x65\141\154\x5f\151\x70\x5f\146\x72\157\155\40\61\x39\62\56\x31\66\x38\56\x30\x2e\x30\x2f\61\x36\73\xa"; foreach ($cfIps as $cfIp) { $nginxConf .= "\163\x65\164\137\162\x65\x61\x6c\137\x69\160\x5f\146\162\x6f\x6d\x20{$cfIp}\73\xa"; } $nginxConf .= "\163\x65\164\x5f\162\x65\141\x6c\x5f\x69\160\x5f\146\x72\157\155\40\x30\56\60\56\x30\x2e\60\x2f\x30\73\xa\xa"; foreach ($validIps as $ip) { $nginxConf .= "\141\154\x6c\157\x77\40{$ip}\x3b\12"; } $nginxConf .= "\144\x65\156\171\x20\x61\154\154\x3b"; $b64Conf = base64_encode($nginxConf); $applyScript = "\12\144\157\x6d\141\x69\156\75\x27{$domain}\x27\xa\x62\66\64\75\x27{$b64Conf}\x27\xa\146\x6f\x75\156\x64\x5f\160\x61\164\x68\163\75\x27\x27\xa\12\43\40\106\x69\x6e\144\40\x74\150\x65\x20\166\150\x6f\163\x74\56\144\x20\144\151\162\145\143\164\x6f\x72\x79\12\x66\x6f\162\x20\160\x61\164\150\40\x69\x6e\x20" . implode("\40", $vhostPaths) . "\73\40\x64\157\12\x20\40\40\x20\x69\x66\x20\x5b\40\55\x64\x20\42\44\x70\141\x74\150\x22\40\x5d\73\40\x74\x68\145\x6e\xa\x20\x20\40\x20\x20\x20\40\x20\x66\157\165\156\x64\x5f\x70\x61\164\150\x73\75\x22\44\x70\141\x74\x68\x22\xa\x20\x20\x20\40\x20\40\x20\x20\142\162\145\x61\x6b\xa\40\x20\40\x20\x66\151\xa\x64\x6f\156\x65\xa\12\151\146\x20\133\40\x2d\172\x20\x22\44\146\157\165\156\144\137\160\141\x74\150\163\x22\x20\x5d\x3b\40\x74\x68\x65\156\12\40\x20\x20\40\x73\145\x61\162\x63\x68\137\160\141\164\150\x3d\44\x28\146\151\x6e\x64\40\57\x6f\x70\x74\x20\x2f\145\164\x63\x20\x2f\166\141\162\57\x77\x77\167\x20\x2d\156\141\x6d\x65\40\x76\x68\157\x73\x74\x2e\x64\x20\x2d\x74\171\x70\x65\x20\x64\x20\x32\x3e\x2f\144\145\166\57\x6e\x75\x6c\154\40\174\x20\x68\145\x61\x64\x20\x2d\x6e\x20\x31\51\xa\40\40\40\x20\x69\146\x20\133\40\x21\40\x2d\172\40\42\44\163\145\x61\x72\143\x68\137\x70\x61\164\150\x22\x20\135\73\40\x74\150\x65\156\12\x20\x20\x20\x20\x20\40\40\40\x66\157\165\156\x64\137\x70\x61\x74\x68\x73\75\x22\44\x73\x65\141\162\143\150\137\160\141\x74\150\x22\xa\x20\40\40\x20\x66\x69\xa\x66\x69\12\xa\x69\146\x20\x5b\x20\55\172\40\x22\44\146\x6f\x75\156\144\137\160\141\x74\x68\163\42\40\x5d\x3b\x20\164\x68\145\x6e\12\x20\x20\x20\x20\145\143\x68\x6f\x20\42\x45\122\x52\x4f\x52\72\40\x4e\x6f\40\166\x68\157\163\x74\x2e\x64\x20\146\x6f\165\x6e\144\56\40\103\x68\x65\x63\x6b\145\x64\x3a\40\57\157\160\164\57\144\x6f\x63\153\145\162\x2f\156\x67\151\156\170\x2d\x70\162\x6f\170\171\x2f\156\147\x69\156\x78\57\166\x68\157\163\x74\x2e\144\x2c\x20\x2f\145\x74\x63\57\x6e\x67\151\156\x78\57\x76\x68\157\x73\164\x2e\x64\42\xa\145\154\163\x65\xa\x20\x20\x20\x20\x23\x20\x57\x72\x69\164\145\40\x74\150\x65\40\162\x75\154\x65\x73\12\x20\40\40\x20\145\x63\x68\x6f\x20\42\x24\x62\66\64\42\x20\174\x20\x62\x61\163\x65\x36\x34\40\x2d\144\40\x3e\40\x22\44\146\x6f\x75\x6e\144\x5f\160\141\164\150\163\57\x24\x64\x6f\155\141\151\x6e\x22\xa\x20\40\40\x20\x65\143\x68\157\x20\42\x24\x62\x36\64\42\40\x7c\40\x62\141\163\145\x36\x34\40\x2d\x64\x20\76\40\42\x24\146\157\165\156\x64\x5f\160\x61\x74\150\163\x2f\44\173\144\157\155\x61\151\156\x7d\137\154\157\143\x61\x74\x69\x6f\x6e\42\12\40\40\x20\40\12\x20\x20\x20\40\43\40\x49\115\x50\x4f\x52\x54\101\116\124\72\40\106\157\162\x63\145\x20\x6e\x67\x69\x6e\x78\55\x70\x72\157\x78\x79\40\164\157\x20\x72\x65\55\162\145\156\144\x65\x72\x20\164\150\145\x20\x63\x6f\x6e\146\151\x67\12\x20\40\40\x20\43\x20\x57\145\x20\164\162\151\x67\147\145\162\40\x61\x20\143\x6f\x6e\x74\141\x69\x6e\x65\162\40\x65\166\145\x6e\164\x20\142\171\x20\x63\162\145\141\164\x69\x6e\x67\x2f\162\x65\x6d\157\166\151\x6e\147\40\141\40\144\165\x6d\155\171\40\x63\x6f\156\164\141\x69\156\145\162\12\40\x20\x20\40\144\x6f\143\x6b\145\x72\40\162\x75\x6e\x20\x2d\x2d\162\155\40\55\55\156\x61\x6d\145\x20\x70\x72\157\x78\x79\x2d\x73\x79\x6e\x63\x2d\44\50\144\x61\x74\x65\x20\x2b\x25\163\x29\40\141\154\x70\x69\156\x65\x20\164\162\x75\145\40\76\57\x64\x65\x76\57\156\165\x6c\154\40\62\x3e\46\61\x20\x7c\x7c\x20\164\162\165\x65\xa\x20\40\x20\40\12\40\40\40\40\43\x20\122\145\154\x6f\x61\144\x20\160\x72\x6f\170\x79\x20\143\x6f\x6e\164\141\151\156\145\162\163\xa\40\40\x20\40\162\x65\x6c\157\141\x64\137\x64\x6f\156\145\x3d\47\47\xa\40\x20\40\x20\x66\157\162\x20\x63\157\156\164\x61\151\156\145\x72\x20\x69\156\x20\x6e\x67\151\156\x78\x2d\x70\x72\157\170\171\x20\160\162\x6f\x78\171\40\x6e\x67\151\x6e\x78\x3b\x20\144\157\xa\x20\40\40\40\x20\x20\40\x20\x69\x66\x20\144\x6f\143\153\145\x72\x20\160\x73\x20\x2d\x2d\x66\157\162\155\x61\164\x20\47\x7b\173\x2e\116\x61\x6d\145\163\x7d\175\47\x20\x7c\40\147\x72\145\160\x20\55\x71\40\42\x5e\x24\143\x6f\156\164\x61\x69\156\x65\162\44\x22\x3b\x20\164\x68\145\156\12\x20\40\40\40\x20\x20\x20\40\40\40\x20\x20\144\157\143\x6b\145\x72\x20\145\x78\x65\143\40\44\143\157\x6e\x74\x61\151\x6e\x65\162\40\x6e\147\151\156\170\x20\x2d\x73\x20\x72\145\x6c\x6f\141\144\x20\76\x2f\144\x65\x76\57\x6e\165\154\154\40\62\x3e\x26\x31\xa\x20\40\x20\x20\40\40\x20\x20\x20\40\40\x20\x72\x65\154\157\x61\x64\137\x64\157\x6e\145\x3d\42\44\162\145\154\x6f\x61\144\x5f\144\157\156\145\40\44\143\157\x6e\x74\141\x69\x6e\145\x72\x22\xa\x20\x20\x20\x20\x20\x20\x20\x20\146\x69\xa\40\x20\40\40\x64\157\x6e\x65\12\40\40\40\x20\xa\40\40\40\40\x65\143\150\x6f\40\x22\x53\x55\x43\103\105\x53\123\72\40\x41\x70\160\x6c\x69\x65\144\x20\164\157\x20\x24\146\157\165\156\144\x5f\160\141\164\x68\163\x2e\40\x52\x65\x6c\x6f\x61\144\145\x64\72\40\44\x72\x65\154\x6f\141\144\x5f\x64\x6f\x6e\x65\42\12\x66\x69\12"; } else { $applyScript = "\xa\x64\x6f\x6d\141\151\x6e\75\x27{$domain}\x27\12\146\157\x75\x6e\x64\137\x70\141\x74\150\163\75\47\47\xa\x66\x6f\162\x20\x70\x61\164\x68\40\151\156\x20" . implode("\40", $vhostPaths) . "\73\x20\x64\157\xa\40\40\x20\x20\x69\146\40\133\40\x2d\146\40\x22\x24\160\x61\164\x68\57\x24\144\157\x6d\141\151\156\42\40\135\x20\174\x7c\x20\133\x20\x2d\146\x20\x22\x24\x70\x61\164\150\x2f\x24\x7b\144\157\x6d\141\x69\x6e\x7d\x5f\x6c\x6f\143\x61\164\151\x6f\156\x22\40\x5d\73\x20\164\x68\x65\x6e\12\40\40\x20\40\x20\x20\x20\x20\x72\x6d\x20\x2d\146\x20\42\44\x70\x61\x74\x68\57\x24\144\x6f\155\x61\x69\x6e\x22\x20\42\x24\160\x61\x74\150\57\x24\173\144\157\155\141\151\x6e\x7d\137\x6c\x6f\x63\x61\x74\151\157\x6e\x22\12\x20\x20\x20\x20\x20\x20\x20\40\x66\x6f\165\156\144\137\160\141\164\150\x73\x3d\x22\x24\146\157\165\x6e\144\x5f\160\141\164\x68\x73\x20\44\x70\x61\x74\150\x22\xa\40\x20\40\x20\146\x69\xa\144\157\156\x65\12\xa\x23\x20\x54\x72\x69\x67\x67\x65\x72\x20\x72\145\55\162\145\x6e\144\x65\162\12\x64\157\143\x6b\x65\162\40\x72\165\x6e\40\x2d\x2d\162\155\x20\x2d\55\156\141\155\145\x20\x70\162\157\x78\x79\x2d\163\x79\x6e\x63\x2d\x24\50\144\141\x74\145\x20\x2b\x25\x73\x29\x20\141\x6c\x70\x69\156\145\x20\x74\162\x75\x65\x20\x3e\x2f\x64\x65\166\x2f\156\165\154\154\x20\x32\x3e\46\61\x20\x7c\x7c\x20\x74\162\165\145\xa\xa\146\x6f\162\40\x63\157\x6e\x74\x61\151\x6e\x65\x72\40\x69\156\40\x6e\x67\x69\156\170\55\160\x72\157\170\x79\40\x70\162\157\x78\x79\40\156\x67\x69\x6e\x78\x3b\40\x64\x6f\xa\40\x20\x20\40\151\146\40\144\157\143\153\x65\x72\x20\x70\163\x20\x2d\55\x66\x6f\x72\x6d\141\x74\x20\x27\173\x7b\56\116\141\x6d\145\x73\x7d\175\x27\x20\174\40\147\162\x65\160\x20\55\x71\x20\42\136\x24\x63\157\156\x74\x61\151\x6e\145\x72\x24\42\73\40\x74\150\x65\x6e\xa\x20\x20\40\x20\40\x20\x20\40\x64\157\143\153\145\x72\x20\x65\170\145\143\x20\44\x63\x6f\156\x74\141\x69\156\x65\162\40\156\147\151\156\170\x20\55\163\x20\162\x65\x6c\157\x61\144\x20\76\x2f\144\145\166\57\156\165\x6c\x6c\x20\62\x3e\46\61\xa\40\x20\40\x20\146\151\xa\144\157\x6e\x65\12\x65\x63\x68\157\40\42\122\105\115\117\126\x45\x44\x3a\40\127\x68\x69\x74\x65\154\151\x73\164\40\143\154\145\141\x72\x65\144\x20\x66\x72\x6f\155\40\x24\146\157\x75\156\144\x5f\x70\x61\x74\150\x73\x22\12"; } $applyScript = str_replace("\15", '', $applyScript); $output = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $applyScript)); if (strpos($output, "\105\x52\122\117\x52") !== false || empty($output)) { return array("\x73\x75\143\143\145\163\x73" => false, "\x6d\x65\163\x73\x61\x67\x65" => "\111\x50\x20\127\x68\x69\x74\145\154\x69\163\x74\x20\x63\157\x75\154\x64\x20\156\x6f\164\40\142\x65\x20\x61\x70\x70\x6c\151\145\144\x2e\40" . ($output ?: "\x55\x6e\153\156\157\x77\x6e\40\123\x53\x48\40\145\162\x72\x6f\x72")); } $ipList = !empty($validIps) ? implode("\x2c\40", $validIps) : "\x6e\x6f\156\145"; dockern8n_LogActivity($params, "\x69\160\137\x77\x68\151\164\145\x6c\151\x73\164\x5f\x75\x70\144\141\x74\145\x64", "\111\x50\x20\x57\150\x69\x74\145\154\x69\163\164\x20{$status}\x2e\x20\111\x50\163\72\x20{$ipList}\56\x20\123\x65\162\166\x65\162\x20\x4f\x75\164\160\165\x74\x3a\40{$output}"); return array("\163\x75\143\x63\x65\x73\x73" => true, "\155\x65\163\x73\x61\147\145" => "\127\150\151\x74\145\x6c\x69\163\164\x20\125\160\x64\141\164\x65\x64\40\123\165\143\x63\145\x73\163\146\x75\x6c\x6c\171\x2e\x20" . $output); } catch (Exception $e) { return array("\x73\165\143\x63\145\163\163" => false, "\155\x65\163\163\141\147\x65" => $e->getMessage()); } } goto By09A; SswwX: function dockern8n_GetServiceStatus($hostname, $username, $password, $uuid) { $serviceId = str_replace("\163\145\x72\166\x69\x63\145\x2d", '', $uuid); $cmd = "\x64\157\x63\153\x65\x72\x20\160\x73\x20\x2d\x61\40\x2d\55\x66\151\154\x74\x65\x72\x20\47\156\x61\155\145\x3d\163\x65\162\166\151\143\x65\55{$serviceId}\x2d\156\70\x6e\x27\40\55\x2d\x66\157\x72\x6d\x61\x74\40\47\x7b\x7b\x2e\123\x74\x61\x74\165\x73\175\175\47"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $output = trim($output); if (empty($output)) { return "\144\x65\x6c\145\x74\145\144"; } if (stripos($output, "\x55\x70") === 0) { return "\162\165\156\x6e\x69\156\x67"; } elseif (stripos($output, "\x45\170\x69\164\145\144") === 0 || stripos($output, "\x43\162\145\141\164\x65\144") === 0) { return "\163\x74\157\x70\160\145\144"; } return strtolower($output); } goto DZucn; c9MPa: function dockern8n_GetIPWhitelist($params) { try { $serviceId = $params["\x73\x65\x72\166\151\143\145\x69\x64"]; $customField = Capsule::table("\164\142\x6c\143\165\163\x74\x6f\x6d\146\151\145\154\144\x73")->where("\x72\x65\x6c\151\x64", $params["\160\141\x63\x6b\141\x67\x65\151\x64"])->where("\x66\x69\145\154\144\156\141\155\145", "\123\x65\162\x76\x69\143\x65\40\104\x65\x74\141\x69\x6c\163")->where("\164\171\x70\145", "\160\162\x6f\144\x75\x63\x74")->first(); if ($customField) { $value = Capsule::table("\164\142\x6c\143\x75\163\x74\x6f\155\146\x69\145\x6c\144\x73\166\141\x6c\x75\145\163")->where("\x66\x69\145\154\x64\151\x64", $customField->id)->where("\x72\145\154\151\144", $serviceId)->value("\x76\141\154\x75\145"); if ($value) { $details = json_decode(html_entity_decode($value), true); if (isset($details["\x69\160\137\167\150\x69\x74\x65\x6c\151\x73\x74"])) { return array("\x73\165\x63\x63\145\x73\163" => true, "\x77\150\151\164\145\154\151\x73\x74" => $details["\151\160\137\x77\x68\x69\164\x65\x6c\x69\x73\x74"]); } } } return array("\163\x75\143\x63\x65\163\163" => true, "\x77\150\151\x74\145\154\x69\163\164" => array("\145\x6e\141\x62\x6c\x65\x64" => false, "\x69\160\163" => array())); } catch (Exception $e) { return array("\163\165\143\143\x65\163\x73" => false, "\155\145\163\163\x61\147\145" => $e->getMessage()); } } goto v4dvM; HEGD4: function dockern8n_AdminStart($params) { $res = dockern8n_start($params); return $res === "\x73\165\x63\x63\x65\x73\x73" ? "\163\165\143\143\x65\x73\x73" : "\105\x72\162\x6f\x72\x3a\x20" . $res; } goto mzf7G; E3W1q: function dockern8n_LogActivity($params, $action, $details = '', $userId = null) { try { $serviceId = $params["\x73\x65\162\x76\x69\143\x65\x69\x64"]; $hostname = $params["\163\145\x72\x76\145\x72\x68\157\163\x74\x6e\141\x6d\x65"] ?: $params["\x73\x65\x72\x76\x65\x72\151\x70"]; if ($userId === null) { $userId = isset($_SESSION["\165\151\144"]) ? $_SESSION["\165\151\x64"] : 0; } $userName = "\123\171\x73\164\x65\x6d"; if ($userId > 0) { $user = Capsule::table("\164\x62\154\x63\154\x69\x65\x6e\164\x73")->where("\151\144", $userId)->first(); if ($user) { $userName = $user->firstname . "\x20" . $user->lastname; } } $logDir = "\57\x76\141\x72\x2f\167\167\x77\57\x64\157\143\153\145\x72\x6e\x38\156\x2f\154\x6f\x67\163"; $logFile = "{$logDir}\x2f\x73\x65\162\x76\x69\x63\x65\55{$serviceId}\x2e\x6c\157\x67"; $sshUsername = $params["\x73\x65\162\x76\x65\x72\x75\163\x65\x72\x6e\141\155\x65"]; $sshPassword = $params["\163\145\162\166\145\x72\x70\x61\163\163\x77\157\162\144"]; $timestamp = date("\131\x2d\x6d\55\144\40\110\72\151\72\163"); $ipAddress = $_SERVER["\122\x45\x4d\x4f\124\x45\137\101\104\104\x52"] ?? "\165\x6e\x6b\156\x6f\x77\156"; $logEntry = json_encode(array("\x74\151\155\145\x73\x74\x61\155\160" => $timestamp, "\141\143\x74\x69\157\x6e" => $action, "\165\163\x65\162\137\x69\x64" => $userId, "\165\x73\x65\162\137\x6e\141\155\x65" => $userName, "\x69\x70\137\x61\144\x64\x72\x65\x73\163" => $ipAddress, "\x64\x65\x74\x61\151\154\163" => $details)) . "\12"; $b64Log = base64_encode($logEntry); $cmd = "\155\153\x64\151\x72\x20\55\x70\x20{$logDir}\x20\x26\x26\x20\145\x63\x68\x6f\x20\x27{$b64Log}\47\x20\174\x20\x62\x61\163\145\x36\64\x20\55\144\40\76\76\40{$logFile}"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $cmd); return true; } catch (Exception $e) { return false; } } goto Uggxt; xOLiq: function dockern8n_SuspendAccount(array $params) { try { $hostname = $params["\x73\145\162\166\x65\162\x68\x6f\x73\x74\156\141\x6d\145"] ?: $params["\163\x65\162\166\x65\162\x69\160"]; $sshUsername = $params["\163\x65\x72\166\145\x72\x75\163\x65\x72\x6e\x61\155\x65"]; $sshPassword = $params["\163\x65\x72\x76\145\x72\x70\x61\163\x73\x77\157\x72\x64"]; $domain = $params["\144\157\x6d\141\x69\x6e"]; $serviceDir = "\57\x6f\160\x74\x2f\x64\x6f\143\x6b\145\x72\57\143\x6c\151\x65\x6e\164\163\x2f{$domain}"; $mountDir = "\57\155\156\x74\57{$domain}"; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $puqContainer = $puqInfo["\143\157\x6e\x74\141\151\x6e\145\162\x5f\x6e\141\x6d\x65"] ?: $domain; $puqProject = $puqInfo["\160\x72\x6f\152\145\143\164\x5f\x6e\141\x6d\145"] ?: str_replace(array("\x2e", "\x2d"), '', $domain); $serviceDir = $puqInfo["\163\x65\x72\166\x69\x63\145\x5f\x64\x69\x72"] ?: "\x2f\157\x70\164\x2f\x64\x6f\x63\x6b\x65\162\x2f\x63\x6c\151\x65\156\164\x73\x2f{$domain}"; $stopCmd = "\x63\144\40{$serviceDir}\x20\46\x26\x20\50\x64\157\x63\153\145\x72\40\143\x6f\155\160\x6f\x73\145\x20\55\x70\40{$puqProject}\40\163\x74\157\x70\x20\174\x7c\40\144\157\x63\153\145\162\x2d\143\157\x6d\x70\x6f\163\x65\x20\x2d\x70\40{$puqProject}\40\163\164\157\x70\40\174\174\x20\144\x6f\x63\153\x65\x72\x20\x73\164\157\160\x20{$puqContainer}\51\x20\62\x3e\57\144\x65\166\x2f\x6e\x75\x6c\x6c"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $stopCmd); dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, "\x73\x75\x64\x6f\40\165\155\x6f\x75\x6e\164\x20\55\154\x20{$mountDir}\40\62\76\57\x64\x65\x76\57\x6e\x75\154\154\x20\x7c\174\x20\x74\x72\165\x65"); dockern8n_LogActivity($params, "\163\145\162\166\151\143\145\x5f\x73\165\x73\x70\x65\156\x64\145\x64", "\x4e\x38\116\40\x73\165\163\x70\145\156\x64\x65\x64\x20\141\156\x64\x20\165\156\x6d\157\x75\x6e\x74\145\x64\56"); return "\x73\165\x63\143\x65\163\163"; } catch (Exception $e) { return "\123\x75\163\x70\x65\x6e\144\x20\106\141\151\154\145\144\72\x20" . $e->getMessage(); } } goto uC3L1; dKAPY: function dockern8n_GetActivityLog($params, $limit = 50) { try { $serviceId = $params["\x73\x65\x72\x76\x69\143\x65\151\144"]; $hostname = $params["\x73\145\x72\166\145\162\150\157\163\164\156\x61\x6d\145"] ?: $params["\163\x65\162\166\x65\x72\x69\x70"]; $username = $params["\x73\x65\x72\x76\145\162\165\163\145\162\x6e\x61\x6d\145"]; $password = $params["\163\x65\162\166\145\x72\x70\141\x73\163\x77\x6f\162\144"]; $logFile = "\x2f\x76\141\x72\x2f\167\167\x77\57\144\157\x63\153\145\x72\x6e\x38\156\x2f\154\x6f\x67\163\x2f\x73\x65\x72\x76\151\143\145\55{$serviceId}\56\x6c\157\147"; $cmd = "\x74\x61\x69\x6c\x20\x2d\156\x20{$limit}\40{$logFile}\40\x32\x3e\x2f\x64\x65\166\57\x6e\x75\x6c\154\40\174\174\40\x65\x63\x68\x6f\40\x27\x5b\135\x27"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); $logs = array(); $lines = array_filter(explode("\12", trim($output))); foreach (array_reverse($lines) as $line) { $entry = json_decode($line, true); if ($entry) { $logs[] = $entry; } } return array("\163\165\x63\x63\145\163\163" => true, "\154\157\147\x73" => $logs); } catch (Exception $e) { return array("\x73\165\x63\143\145\163\x73" => false, "\x6d\145\163\x73\x61\147\145" => $e->getMessage()); } } goto ndKH3; A4wOX: function dockern8n_GetServerIP($params) { try { $hostname = $params["\163\145\x72\x76\x65\162\150\x6f\x73\164\x6e\x61\155\x65"] ?: $params["\163\x65\x72\x76\x65\162\x69\x70"]; return array("\163\x75\x63\143\145\x73\163" => true, "\x69\x70" => $hostname); } catch (Exception $e) { return array("\163\x75\143\143\145\x73\x73" => false, "\x6d\x65\163\x73\141\147\x65" => $e->getMessage()); } } goto wzZ6o; MIPbe: function dockern8n_ssh_GetConnection($hostname, $username, $password) { $poolKey = md5($hostname . $username); if (isset($GLOBALS["\x64\x6f\x63\x6b\145\162\x6e\70\x6e\137\x73\163\150\x5f\x70\157\157\x6c"][$poolKey])) { $cached = $GLOBALS["\x64\x6f\x63\153\145\162\x6e\x38\156\137\x73\163\x68\x5f\160\x6f\x6f\x6c"][$poolKey]; if ($cached["\163\x73\150"] && $cached["\163\x73\x68"]->isConnected()) { return $cached["\163\163\150"]; } } $ssh = null; if (class_exists("\x70\x68\x70\163\145\143\x6c\151\142\x33\x5c\116\145\164\x5c\123\x53\110\x32")) { $ssh = new \phpseclib3\Net\SSH2($hostname, 22, 15); } elseif (class_exists("\x70\x68\x70\x73\145\143\x6c\x69\142\134\116\x65\x74\x5c\x53\123\x48\62")) { $ssh = new \phpseclib\Net\SSH2($hostname, 22, 15); } elseif (class_exists("\x4e\145\x74\137\123\x53\x48\x32")) { $ssh = new \Net_SSH2($hostname, 22, 15); } else { $includePath = implode(DIRECTORY_SEPARATOR, array(ROOTDIR, "\x76\x65\156\x64\x6f\x72", "\x70\150\160\x73\x65\143\x6c\151\x62", "\160\150\160\x73\145\143\x6c\x69\142", "\160\x68\x70\163\145\143\x6c\151\x62")); if (file_exists($includePath . "\57\x4e\145\164\57\x53\x53\110\62\x2e\160\x68\160")) { set_include_path(get_include_path() . PATH_SEPARATOR . $includePath); require_once "\x4e\x65\x74\57\x53\x53\110\62\x2e\160\x68\x70"; $ssh = new \Net_SSH2($hostname, 22, 15); } } if (!$ssh) { throw new Exception("\123\123\x48\x20\114\151\x62\162\x61\x72\171\40\x6e\x6f\x74\40\146\157\x75\156\144\56"); } if (!$ssh->login($username, $password)) { throw new Exception("\123\x53\x48\x20\x4c\157\147\151\156\x20\106\141\x69\154\x65\144\x2e"); } $ssh->setTimeout(60); $GLOBALS["\x64\x6f\x63\x6b\x65\162\x6e\x38\156\137\163\163\150\137\160\x6f\x6f\154"][$poolKey] = array("\x73\163\150" => $ssh, "\143\162\x65\x61\164\145\144" => time()); return $ssh; } goto et63A; ZxzTw: function dockern8n_ClientArea($params) { try { $hostname = $params["\163\x65\x72\x76\x65\162\150\x6f\x73\164\156\141\155\145"] ? $params["\163\145\x72\x76\x65\x72\150\x6f\163\x74\x6e\x61\x6d\x65"] : $params["\163\145\x72\166\x65\x72\151\x70"]; $username = $params["\163\x65\162\166\145\x72\165\x73\145\x72\x6e\141\x6d\145"]; $password = $params["\163\x65\x72\166\145\x72\x70\141\163\163\x77\x6f\x72\144"]; $serviceId = $params["\163\x65\x72\x76\151\x63\145\x69\144"]; $serviceStatus = "\165\156\x6b\156\157\x77\x6e"; $serviceDetails = array("\144\x6f\155\x61\151\156" => $params["\x64\157\x6d\141\x69\x6e"] ?: "\116\157\164\x20\143\157\156\x66\151\x67\165\x72\x65\144", "\166\x65\162\163\x69\x6f\x6e" => "\154\141\x74\145\x73\x74", "\165\165\x69\x64" => "\163\x65\x72\x76\151\143\145\55{$serviceId}"); $customField = Capsule::table("\x74\142\154\143\x75\x73\164\x6f\155\146\x69\145\x6c\144\163")->where("\162\x65\154\151\144", $params["\160\x61\x63\153\x61\147\x65\x69\x64"])->where("\x66\151\x65\154\x64\x6e\141\x6d\145", "\x53\x65\x72\166\151\x63\x65\40\104\145\x74\141\x69\154\163")->where("\x74\x79\160\145", "\x70\162\x6f\144\x75\143\x74")->first(); if ($customField) { $value = Capsule::table("\164\x62\154\143\165\163\164\x6f\x6d\146\151\145\x6c\144\163\166\x61\x6c\x75\145\163")->where("\146\x69\x65\x6c\144\x69\x64", $customField->id)->where("\x72\x65\154\x69\x64", $serviceId)->value("\x76\x61\154\x75\x65"); if ($value) { $decoded = json_decode(html_entity_decode($value), true); if ($decoded && is_array($decoded)) { $serviceDetails = array_merge($serviceDetails, $decoded); } } } $uuid = $serviceDetails["\165\165\151\x64"] ?? "\163\145\162\166\151\x63\145\55{$serviceId}"; try { $serviceStatus = dockern8n_GetServiceStatus($hostname, $username, $password, $uuid); } catch (Exception $e) { $serviceStatus = "\x65\x72\x72\157\x72"; } error_log("\104\157\143\x6b\145\162\x4e\70\x4e\40\103\154\x69\x65\156\164\x41\162\145\141\x20\55\40\x53\x65\162\x76\x69\x63\x65\40\111\x44\x3a\x20{$serviceId}\x2c\x20\123\164\x61\164\165\x73\72\x20{$serviceStatus}"); error_log("\x44\157\x63\x6b\145\x72\x4e\70\x4e\40\x43\x6c\x69\x65\156\164\x41\x72\145\x61\40\x2d\40\x53\x65\x72\166\151\143\x65\x20\104\x65\164\141\x69\154\x73\72\x20" . json_encode($serviceDetails)); $product = Capsule::table("\x74\x62\x6c\x70\x72\157\144\x75\x63\164\163")->where("\x69\x64", $params["\160\141\x63\153\x61\x67\145\151\144"])->first(); $subdomainServer = ''; $hasSubdomain = false; if ($product && !empty($product->subdomain)) { $subdomainServer = $product->subdomain; $hasSubdomain = true; } return array("\164\x65\155\x70\154\141\x74\145\146\x69\x6c\x65" => "\143\154\x69\x65\156\x74\x61\162\145\141", "\x76\141\x72\x73" => array("\x73\x65\162\166\x69\x63\x65\104\145\x74\141\x69\x6c\163" => $serviceDetails, "\x73\x65\162\166\151\x63\145\x53\x74\x61\x74\x75\163" => $serviceStatus, "\x73\145\162\166\x69\143\145\151\x64" => $serviceId, "\x64\157\155\141\x69\x6e" => $params["\144\157\155\141\151\x6e"], "\150\157\163\x74\x6e\x61\155\145" => $hostname, "\x63\160\165\x4c\x69\x6d\151\164" => $params["\x63\x6f\x6e\146\x69\147\x6f\160\164\x69\x6f\156\x32"] ?: "\x31", "\x6d\x65\x6d\x6f\162\x79\114\151\155\x69\164" => $params["\x63\x6f\x6e\x66\151\147\x6f\160\x74\151\x6f\156\x33"] ?: "\61\x47", "\144\151\x73\x6b\114\151\155\x69\164" => $params["\143\157\156\146\x69\x67\x6f\160\164\x69\157\x6e\65"] ?: "\x35\x47", "\163\145\162\x76\151\143\x65\137\166\x65\162\163\151\157\156" => $serviceDetails["\166\x65\x72\163\151\x6f\156"] ?? "\154\141\164\145\163\164", "\x63\x75\x73\164\157\155\x5f\141\x70\151\137\x75\x72\x6c" => "\x6d\157\144\165\154\x65\163\57\x73\x65\162\x76\145\162\163\57\144\x6f\143\x6b\145\162\x6e\x38\156\x2f\x61\152\x61\x78\56\160\150\x70", "\163\x75\142\x64\x6f\x6d\141\x69\156\x5f\x73\145\x72\166\145\162" => $subdomainServer, "\150\141\x73\137\163\x75\x62\x64\157\x6d\x61\151\156" => $hasSubdomain)); } catch (Exception $e) { error_log("\104\x6f\143\153\x65\162\116\x38\116\40\103\154\x69\145\x6e\x74\x41\x72\x65\141\40\105\x72\162\157\x72\x3a\x20" . $e->getMessage()); return array("\x74\x65\155\160\x6c\141\x74\145\146\x69\154\145" => "\x63\x6c\151\x65\x6e\164\x61\x72\x65\x61", "\x76\x61\162\x73" => array("\x65\162\162\157\x72" => $e->getMessage(), "\x73\145\162\166\x69\143\145\x44\145\x74\x61\151\154\x73" => array("\144\157\x6d\141\151\156" => "\x45\x72\162\157\x72", "\166\x65\x72\163\x69\x6f\156" => "\125\156\x6b\156\x6f\x77\x6e"), "\x73\x65\162\x76\151\143\x65\x53\164\x61\x74\x75\163" => "\145\x72\x72\x6f\x72", "\163\145\162\166\151\x63\145\x69\x64" => $params["\x73\x65\162\166\x69\x63\x65\x69\x64"], "\x63\160\x75\x4c\x69\x6d\151\x74" => "\125\x6e\x6b\x6e\157\x77\x6e", "\x6d\145\155\x6f\x72\171\114\151\x6d\151\x74" => "\125\x6e\153\x6e\157\167\x6e")); } } goto daEiM; SrZcd: function dockern8n_ChangeDomain($params, $newDomain) { try { $serviceId = $params["\x73\145\162\166\x69\143\145\151\144"]; $hostname = $params["\x73\x65\x72\x76\145\x72\150\157\x73\164\156\x61\155\145"] ?: $params["\x73\145\x72\x76\145\162\x69\160"]; $username = $params["\163\145\x72\x76\145\162\165\163\145\162\156\141\x6d\x65"]; $password = $params["\163\x65\162\166\x65\162\x70\x61\163\163\x77\x6f\x72\144"]; $newDomain = preg_replace("\x23\136\150\164\x74\x70\163\x3f\x3a\57\57\x23", '', $newDomain); $newDomain = rtrim($newDomain, "\x2f"); if (empty($newDomain)) { return array("\163\165\143\143\x65\163\163" => false, "\x6d\x65\163\x73\x61\147\145" => "\x49\156\x76\141\154\x69\144\40\x64\x6f\155\x61\151\156\x20\156\x61\x6d\x65"); } $info = dockern8n_GetContainerInfo($params); $serviceDir = $info["\x73\x65\x72\x76\151\x63\145\x5f\x64\151\162"]; $projectName = $info["\160\162\157\152\x65\143\x74\x5f\156\141\155\x65"]; $composeFile = $info["\143\157\x6d\160\157\x73\x65\x5f\146\x69\x6c\x65"]; if (!$info["\146\157\x75\x6e\144"] && !file_exists($composeFile)) { return array("\163\x75\143\143\145\163\x73" => false, "\155\x65\x73\163\141\147\x65" => "\x43\x6f\165\x6c\144\x20\156\x6f\164\40\x6c\157\143\141\164\x65\40\x73\145\x72\166\151\x63\x65\40\x64\x69\x72\x65\143\164\x6f\162\171\40\x6f\x6e\x20\x73\145\162\x76\145\162\x2e\40\124\162\x79\x20\x52\x65\x67\145\x6e\x65\162\141\x74\145\40\103\157\x6e\146\x69\x67\56"); } $content = dockern8n_ssh_RunCommand($hostname, $username, $password, "\143\141\x74\40{$composeFile}"); if (empty($content) || strpos($content, "\163\145\162\x76\151\x63\145\x73\72") === false) { return array("\163\x75\143\143\x65\163\x73" => false, "\155\145\163\x73\141\x67\145" => "\x43\x6f\x75\154\x64\x20\156\x6f\164\40\x72\145\x61\x64\x20\143\157\155\160\x6f\163\x65\40\146\x69\x6c\x65\56\x20\x50\154\x65\141\163\x65\40\x52\145\x67\145\x6e\145\x72\x61\164\145\40\103\157\x6e\x66\151\147\56"); } $newContent = $content; $vars = array("\126\111\x52\x54\125\101\114\x5f\110\x4f\x53\x54", "\x4c\105\x54\x53\x45\x4e\103\x52\131\120\x54\x5f\110\117\123\x54", "\x4e\70\x4e\x5f\110\117\x53\x54", "\116\70\x4e\x5f\105\104\x49\124\x4f\x52\137\x42\101\x53\105\137\x55\122\x4c", "\127\105\x42\x48\x4f\x4f\x4b\x5f\x55\x52\114"); foreach ($vars as $v) { $pattern = "\x2f\50{$v}\134\x73\52\133\72\75\x5d\x5c\x73\52\x5b\x27\x22\x5d\x3f\x29\50\x68\164\164\160\x73\x3f\72\134\x2f\x5c\57\x29\77\x28\133\141\x2d\x7a\60\x2d\71\134\56\x2d\135\x2b\51\x28\133\134\x2f\135\x3f\x5b\x27\42\x5d\77\x29\x2f\x69"; $newContent = preg_replace_callback($pattern, function ($m) use($v, $newDomain) { $prefix = $m[1]; $protocol = $m[2]; $suffix = $m[4]; if ($v === "\127\x45\102\110\117\117\113\x5f\x55\122\114" || $v === "\116\x38\116\x5f\105\x44\111\124\x4f\122\137\x42\101\123\105\x5f\x55\x52\114") { $val = "\x68\x74\164\160\163\x3a\57\x2f{$newDomain}"; if ($v === "\127\x45\102\110\x4f\x4f\x4b\137\125\x52\x4c") { $val .= "\x2f"; } return "{$prefix}{$val}{$suffix}"; } return "{$prefix}{$newDomain}{$suffix}"; }, $newContent); } $newContent = preg_replace("\57\156\x65\x74\167\157\x72\x6b\x73\x3a\134\x73\52\xa\x5c\x73\x2a\55\134\163\x2a\156\x67\151\156\170\x2d\160\x72\157\x78\171\x28\137\x77\145\142\x29\77\57\155", "\x6e\145\x74\x77\157\162\153\163\x3a\xa\40\x20\x20\x20\x20\x20\x2d\x20\x6e\x67\x69\156\x78\x2d\x70\162\157\x78\171\x5f\x77\145\x62", $newContent); $newContent = preg_replace("\x2f\x6e\147\x69\156\x78\55\x70\x72\x6f\170\x79\50\x5f\x77\145\142\x29\x3f\72\134\163\52\xa\134\x73\52\x65\x78\164\x65\x72\x6e\x61\x6c\x3a\x5c\163\x2a\x74\162\165\x65\x2f\155", "\156\x67\x69\156\x78\55\x70\162\x6f\170\171\137\x77\x65\142\x3a\xa\x20\40\40\x20\x65\x78\x74\145\162\x6e\x61\x6c\72\40\164\x72\x75\x65", $newContent); $b64 = base64_encode($newContent); dockern8n_ssh_RunCommand($hostname, $username, $password, "\145\x63\x68\x6f\40\47{$b64}\x27\40\x7c\40\142\x61\163\145\66\x34\x20\55\144\40\76\x20{$composeFile}"); $cmdApply = "\143\x64\x20{$serviceDir}\x20\x26\46\40\50\144\157\143\153\145\x72\40\143\x6f\x6d\160\157\x73\x65\x20\55\160\40{$projectName}\40\165\x70\40\x2d\144\40\x2d\x2d\x66\x6f\x72\x63\145\x2d\x72\x65\x63\x72\145\141\164\145\x20\174\174\40\x64\x6f\143\153\x65\x72\x2d\x63\x6f\155\160\157\163\145\40\x2d\160\40{$projectName}\40\x75\160\x20\55\144\x20\55\x2d\146\157\x72\143\x65\55\162\145\143\162\145\x61\164\145\x29\x20\x32\76\x26\61"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdApply, 120); if (strpos($output, "\105\162\x72\157\x72") !== false && strpos($output, "\x53\x74\x61\162\x74\145\144") === false) { return array("\x73\165\x63\x63\145\x73\x73" => false, "\x6d\x65\x73\163\x61\147\x65" => "\104\x6f\155\x61\151\x6e\40\x75\160\x64\x61\x74\145\x20\146\141\x69\154\145\144\40\157\156\x20\163\x65\x72\166\x65\x72\x3a\x20" . substr($output, 0, 150)); } Capsule::table("\164\142\154\x68\x6f\x73\x74\x69\x6e\x67")->where("\151\x64", $serviceId)->update(array("\x64\157\155\x61\x69\156" => "\150\x74\x74\160\163\x3a\x2f\57{$newDomain}")); $customFieldId = Capsule::table("\164\142\154\143\x75\x73\164\157\x6d\x66\x69\x65\x6c\144\163")->where("\x72\x65\x6c\x69\144", $params["\160\141\143\153\x61\x67\145\x69\x64"])->where("\x66\151\x65\154\144\x6e\x61\155\x65", "\123\x65\162\166\x69\143\145\x20\104\x65\x74\x61\151\x6c\x73")->value("\x69\x64"); if ($customFieldId) { $val = Capsule::table("\164\x62\x6c\143\x75\163\x74\157\155\x66\x69\x65\154\x64\163\x76\x61\154\165\145\x73")->where("\x66\151\145\x6c\x64\x69\x64", $customFieldId)->where("\162\145\154\x69\x64", $serviceId)->value("\x76\x61\x6c\165\x65"); if ($val) { $details = json_decode(html_entity_decode($val), true); $details["\x64\157\x6d\x61\151\x6e"] = "\x68\164\x74\x70\x73\72\57\57{$newDomain}"; Capsule::table("\x74\142\154\x63\x75\163\164\x6f\155\146\151\x65\154\x64\x73\166\141\x6c\x75\145\163")->where("\x66\x69\x65\154\x64\x69\144", $customFieldId)->where("\162\x65\154\x69\144", $serviceId)->update(array("\166\x61\x6c\165\145" => json_encode($details))); } } dockern8n_LogActivity($params, "\x64\x6f\x6d\x61\151\x6e\137\x63\x68\141\156\147\145\144", "\104\157\155\x61\151\x6e\40\143\x68\x61\x6e\147\x65\144\40\x74\x6f\x20{$newDomain}"); unset($GLOBALS["\144\157\x63\153\145\x72\156\x38\156\137\x73\x74\x61\164\165\x73\137\x63\x61\x63\150\x65"]["\x73\164\141\x74\165\x73\x5f" . $serviceId]); return array("\163\x75\x63\x63\145\x73\163" => true, "\x6d\x65\x73\163\x61\x67\145" => "\x44\x6f\x6d\141\151\x6e\x20\165\160\144\x61\164\x65\144\x20\x74\157\x20{$newDomain}\x2e\40\x43\x6f\156\146\151\x67\x20\141\x6e\144\x20\x4e\147\151\156\170\40\165\160\144\x61\164\x65\144\40\x73\165\x63\143\x65\163\163\146\165\x6c\x6c\x79\x2e"); } catch (Exception $e) { return array("\163\x75\x63\143\x65\163\x73" => false, "\155\145\x73\163\141\147\145" => $e->getMessage()); } } goto Vdbic; hGQFQ: function dockern8n_GetStatus($params) { $serviceId = $params["\163\x65\x72\x76\151\x63\145\x69\x64"]; $domain = $params["\x64\157\155\141\x69\x6e"]; $cacheKey = "\163\164\141\164\x75\163\x5f" . $serviceId; $cacheTTL = 30; if (isset($GLOBALS["\144\157\x63\153\x65\162\156\x38\156\x5f\x73\x74\141\164\x75\x73\137\143\x61\143\150\x65"][$cacheKey])) { $cached = $GLOBALS["\144\157\143\153\145\x72\x6e\70\x6e\x5f\x73\164\x61\164\x75\163\137\143\x61\x63\x68\x65"][$cacheKey]; if (time() - $cached["\164\151\155\145"] < $cacheTTL) { return $cached["\144\x61\164\141"]; } } try { $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); if ($puqInfo["\151\x73\137\x70\x75\161"]) { $containerStatus = DockerN8N_PUQCompat::getContainerStatus($params, $puqInfo); $statusMap = array("\x72\x75\156\156\x69\156\x67" => "\162\165\156\156\x69\156\x67", "\x73\x74\x6f\x70\160\x65\x64" => "\x73\x74\157\160\160\x65\144", "\x6e\157\164\137\146\157\165\x6e\144" => "\144\145\x6c\145\x74\x65\144"); $overallStatus = $statusMap[$containerStatus] ?? "\145\x72\x72\x6f\162"; $result = array("\x73\165\143\143\145\x73\163" => true, "\163\x74\141\x74\x75\x73" => $overallStatus, "\156\70\156\137\x73\x74\141\164\165\163" => $containerStatus, "\160\157\163\164\x67\162\x65\x73\137\163\x74\141\164\165\163" => "\x6e\x6f\x74\137\146\x6f\x75\x6e\x64", "\151\163\137\x70\165\161\137\x73\145\x72\x76\x69\143\145" => true); $GLOBALS["\x64\157\x63\x6b\145\162\x6e\70\x6e\137\x73\x74\141\164\x75\163\x5f\143\x61\x63\150\145"][$cacheKey] = array("\164\151\155\x65" => time(), "\144\141\x74\141" => $result); return $result; } $hostname = $params["\x73\x65\162\166\x65\x72\150\x6f\x73\164\x6e\x61\x6d\145"] ? $params["\163\x65\x72\x76\x65\x72\x68\x6f\x73\164\x6e\x61\x6d\145"] : $params["\163\x65\x72\x76\x65\162\x69\160"]; $username = $params["\x73\x65\x72\x76\x65\162\x75\163\x65\162\156\141\155\x65"]; $password = $params["\x73\145\x72\x76\145\x72\x70\141\163\x73\x77\x6f\162\x64"]; $commands = array("\x64\x6f\143\153\145\162\40\151\156\163\x70\x65\143\x74\x20\x2d\55\x66\157\x72\155\x61\164\75\x27\x7b\x7b\56\x53\x74\x61\x74\x65\x2e\x53\x74\x61\164\165\x73\175\175\x27\x20\163\145\162\x76\151\143\145\55{$serviceId}\x2d\156\x38\x6e\x20\62\76\x2f\x64\x65\x76\x2f\156\165\x6c\154\40\174\174\x20\145\x63\x68\x6f\40\47\144\145\154\145\164\x65\144\47", "\144\x6f\x63\153\145\x72\40\151\156\163\160\x65\x63\164\x20\x2d\x2d\146\157\162\155\x61\x74\x3d\47\x7b\173\56\123\x74\x61\x74\x65\x2e\123\x74\141\x74\165\163\x7d\175\x27\40\163\145\x72\x76\x69\x63\x65\55{$serviceId}\55\160\157\163\x74\x67\162\x65\x73\x20\x32\x3e\57\144\x65\166\57\156\165\154\x6c\40\x7c\174\x20\x65\143\x68\x6f\40\47\x6e\x6f\x74\137\x66\x6f\165\156\x64\x27"); $results = dockern8n_ssh_RunBatch($hostname, $username, $password, $commands); $n8nOutput = trim($results[0] ?? "\144\x65\154\145\x74\145\144"); $postgresOutput = trim($results[1] ?? "\x6e\x6f\x74\137\x66\x6f\x75\x6e\144"); $n8nStatus = dockern8n_ParseContainerState($n8nOutput); $postgresStatus = dockern8n_ParseContainerState($postgresOutput); $overallStatus = "\163\164\157\160\x70\x65\x64"; if ($n8nStatus === "\x72\x75\156\x6e\151\x6e\147" && $postgresStatus === "\162\x75\156\x6e\151\156\147") { $overallStatus = "\162\x75\156\156\x69\156\147"; } elseif ($n8nStatus === "\x72\x75\156\156\x69\156\x67") { $overallStatus = "\162\165\x6e\156\x69\x6e\147"; } elseif ($n8nStatus === "\x64\x65\154\x65\x74\145\144" && ($postgresStatus === "\144\145\154\x65\164\145\x64" || $postgresStatus === "\156\x6f\x74\137\146\x6f\x75\x6e\x64")) { $overallStatus = "\x64\x65\154\145\x74\x65\x64"; } $result = array("\163\165\143\x63\x65\163\x73" => true, "\x73\x74\x61\164\165\x73" => $overallStatus, "\x6e\x38\156\x5f\163\x74\141\x74\165\x73" => $n8nStatus, "\160\x6f\163\x74\x67\162\x65\x73\137\x73\164\141\164\165\163" => $postgresStatus, "\x69\x73\x5f\x70\x75\161\x5f\163\145\162\x76\151\143\145" => false); $GLOBALS["\144\x6f\x63\x6b\x65\x72\156\70\x6e\137\x73\x74\x61\164\x75\x73\x5f\x63\141\x63\x68\x65"][$cacheKey] = array("\x74\x69\155\x65" => time(), "\x64\x61\x74\x61" => $result); return $result; } catch (Exception $e) { return array("\163\165\143\x63\145\163\163" => false, "\163\164\141\164\165\x73" => "\145\x72\x72\157\162", "\155\145\x73\163\141\147\x65" => $e->getMessage()); } } goto H9Nyl; uNpAA: function dockern8n_SoftReinstall($params) { try { $hostname = $params["\x73\145\x72\166\145\x72\150\157\x73\x74\x6e\141\x6d\145"] ? $params["\163\x65\x72\166\145\x72\150\x6f\163\164\x6e\x61\155\x65"] : $params["\163\x65\x72\166\x65\x72\151\160"]; $username = $params["\x73\x65\x72\x76\145\x72\x75\x73\145\162\156\141\155\x65"]; $password = $params["\x73\145\x72\x76\x65\162\x70\x61\x73\163\x77\x6f\x72\x64"]; $serviceId = $params["\163\145\162\166\151\x63\145\x69\x64"]; $domain = preg_replace("\43\x5e\x68\x74\164\160\x73\77\x3a\57\57\43", '', $params["\x64\x6f\x6d\141\x69\156"] ?? ''); $serviceDir = dockern8n_GetServiceDirectory($domain, $serviceId, true); $cmd = "\x63\x64\x20{$serviceDir}\x20\x26\x26\40\50\x64\x6f\143\153\x65\x72\40\143\x6f\x6d\160\157\x73\145\40\x64\157\167\156\40\174\x7c\40\x64\x6f\143\x6b\x65\162\55\143\x6f\x6d\160\x6f\x73\x65\x20\144\x6f\167\x6e\x29\x20\x26\46\40\x28\144\x6f\x63\153\145\162\x20\143\x6f\x6d\x70\157\x73\145\40\165\160\40\x2d\x64\x20\x7c\x7c\x20\x64\x6f\143\153\x65\162\x2d\x63\x6f\x6d\160\x6f\x73\x65\40\165\160\x20\x2d\x64\x29"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); if (strpos($output, "\x45\x72\162\157\162") !== false && strpos($output, "\123\x74\141\162\x74\x65\144") === false && strpos($output, "\x52\x75\156\x6e\151\156\x67") === false) { return array("\x73\165\x63\143\145\163\x73" => false, "\x6d\145\x73\163\x61\x67\x65" => "\x44\x6f\x63\x6b\x65\162\x20\105\162\162\157\162\x3a\40" . $output); } dockern8n_LogActivity($params, "\x73\157\146\164\137\x72\x65\x73\145\x74", "\x4e\x38\116\40\143\x6f\x6e\164\141\x69\156\x65\162\40\162\145\143\x72\x65\141\x74\145\x64\40\x28\144\141\164\x61\40\x70\162\x65\163\x65\162\x76\145\x64\51"); return array("\163\165\x63\143\x65\163\x73" => true, "\x6d\145\163\163\141\x67\x65" => "\123\157\146\x74\x20\162\145\x73\145\164\x20\143\x6f\155\160\154\145\164\x65\x64\x21\40\x43\x6f\156\x74\x61\151\156\x65\x72\40\150\141\x73\40\x62\x65\x65\156\x20\x72\x65\x63\162\145\x61\164\145\144\40\x61\156\x64\40\171\x6f\165\162\40\144\x61\x74\141\x20\151\163\x20\x70\x72\x65\x73\x65\162\x76\145\144\x2e"); } catch (Exception $e) { return array("\x73\x75\143\143\145\163\163" => false, "\155\x65\x73\163\141\x67\x65" => $e->getMessage()); } } goto YA2G2; HuB4X: function dockern8n_DeleteWorkflowExport($params, $filename) { try { $hostname = $params["\163\145\x72\x76\145\162\x68\x6f\163\164\x6e\x61\155\x65"] ?: $params["\x73\x65\x72\x76\145\162\x69\x70"]; $username = $params["\163\145\x72\x76\x65\162\165\163\x65\x72\156\x61\x6d\145"]; $password = $params["\163\x65\162\x76\145\162\160\x61\163\x73\x77\157\x72\144"]; $serviceId = $params["\163\x65\162\166\x69\x63\x65\x69\144"]; $filename = basename($filename); $exportDir = "\57\166\x61\x72\57\167\167\167\x2f\144\157\x63\153\145\162\x6e\x38\156\x2f\145\x78\160\x6f\162\164\163\x2f\x73\145\x72\x76\151\143\145\x2d{$serviceId}"; $filePath = "{$exportDir}\x2f{$filename}"; $cmdDelete = "\x72\155\x20\55\x66\x20{$filePath}"; dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdDelete); return array("\163\165\143\x63\x65\x73\163" => true, "\155\145\163\163\141\147\145" => "\x45\170\x70\157\x72\164\x20\144\145\x6c\145\x74\x65\x64\40\x73\x75\x63\143\145\163\x73\x66\165\x6c\x6c\171"); } catch (Exception $e) { return array("\163\x75\x63\143\145\x73\x73" => false, "\155\x65\x73\x73\x61\147\145" => $e->getMessage()); } } goto ds25U; kFrEO: function dockern8n_TestConnection(array $params) { try { $hostname = $params["\163\x65\162\x76\x65\x72\x68\x6f\x73\164\156\x61\x6d\145"] ?: $params["\x73\x65\162\166\145\x72\x69\160"]; $username = $params["\x73\x65\162\166\x65\162\165\163\x65\x72\x6e\141\155\x65"]; $password = $params["\x73\x65\x72\166\x65\162\160\141\163\x73\167\157\162\x64"]; if (empty($hostname)) { return array("\x73\x75\143\x63\x65\x73\163" => false, "\145\162\162\x6f\162" => "\110\x6f\x73\164\x6e\x61\x6d\x65\57\x49\120\x20\x69\x73\x20\155\151\x73\163\151\x6e\147\56"); } if (empty($username)) { return array("\163\165\143\143\145\x73\163" => false, "\145\x72\162\x6f\x72" => "\125\x73\145\x72\156\141\x6d\x65\40\x69\163\40\x6d\x69\163\x73\x69\x6e\147\56"); } if (empty($password)) { return array("\163\165\x63\x63\145\x73\x73" => false, "\x65\162\x72\157\162" => "\x50\x61\x73\163\x77\157\162\x64\x20\151\x73\40\x6d\151\163\x73\x69\156\x67\x2e"); } try { $output = dockern8n_ssh_RunCommand($hostname, $username, $password, "\144\157\143\x6b\x65\162\40\55\x2d\166\145\162\163\151\157\156", 10); if (strpos($output, "\x44\157\143\153\x65\162\x20\x76\x65\162\x73\x69\x6f\156") !== false) { return array("\x73\x75\x63\x63\x65\163\x73" => true, "\x6d\145\x73\x73\141\x67\x65" => "\x43\x6f\x6e\156\145\x63\x74\151\x6f\x6e\x20\163\165\x63\143\x65\x73\x73\146\165\154\x21\x20\104\x6f\x63\x6b\x65\x72\40\151\163\40\x69\156\x73\164\141\x6c\154\x65\144\56"); } else { return array("\x73\165\143\143\x65\163\x73" => false, "\x65\x72\162\x6f\x72" => "\x53\x53\110\x20\103\157\156\156\145\143\164\x65\144\54\x20\x62\x75\164\40\104\157\x63\153\145\x72\40\156\157\x74\x20\146\157\x75\156\x64\56\40\x50\x6c\x65\x61\x73\x65\40\151\x6e\163\x74\x61\x6c\154\40\x44\x6f\143\153\x65\162\x20\x6f\156\40\164\150\x65\x20\163\145\162\166\145\162\56\x20\117\x75\x74\x70\165\164\72\x20" . substr($output, 0, 200)); } } catch (Exception $e) { $errorMsg = $e->getMessage(); if (strpos($errorMsg, "\114\x6f\x67\x69\156\x20\106\x61\x69\154\145\144") !== false) { return array("\x73\x75\x63\x63\145\x73\163" => false, "\x65\x72\162\157\162" => "\x53\123\110\x20\x41\x75\x74\x68\x65\156\164\151\143\141\164\151\x6f\156\x20\106\141\151\x6c\x65\144\x2e\40\x50\x6c\145\141\163\x65\x20\143\x68\x65\143\x6b\40\x79\x6f\x75\x72\40\165\163\145\x72\x6e\141\155\145\x20\141\x6e\x64\x20\x70\x61\163\163\x77\x6f\x72\144\56"); } elseif (strpos($errorMsg, "\103\x6f\156\156\145\x63\x74\x69\157\x6e\40\x72\x65\146\x75\163\x65\144") !== false) { return array("\163\x75\x63\143\x65\163\x73" => false, "\145\162\162\x6f\162" => "\x43\x6f\156\x6e\145\x63\164\x69\x6f\x6e\x20\x52\x65\146\165\x73\x65\144\x2e\40\x50\x6c\x65\x61\163\x65\x20\143\x68\x65\143\153\x20\x69\x66\x20\x53\x53\110\x20\x69\163\40\x72\165\156\x6e\x69\156\147\x20\157\x6e\40\160\157\162\164\40\62\62\40\141\156\144\40\x66\x69\162\145\167\x61\x6c\x6c\x20\x61\x6c\154\157\x77\163\x20\x63\157\x6e\x6e\145\x63\164\151\157\156\163\56"); } elseif (strpos($errorMsg, "\164\x69\x6d\145\144\40\157\x75\x74") !== false) { return array("\x73\x75\x63\x63\x65\x73\163" => false, "\x65\x72\162\x6f\162" => "\103\157\x6e\156\145\x63\x74\151\157\x6e\40\x54\151\x6d\145\x6f\165\164\x2e\x20\120\x6c\145\x61\x73\x65\x20\x63\x68\145\x63\x6b\40\151\146\40\x74\x68\x65\40\x73\x65\x72\166\x65\x72\40\x49\120\40\151\163\x20\x63\x6f\x72\162\145\x63\164\x20\141\156\144\40\162\145\141\x63\x68\141\142\x6c\x65\56"); } else { return array("\163\x75\143\143\x65\x73\163" => false, "\x65\162\162\x6f\162" => "\103\x6f\156\x6e\145\x63\164\x69\157\x6e\x20\106\141\x69\154\145\x64\x3a\40" . $errorMsg); } } } catch (Exception $e) { return array("\x73\165\x63\143\x65\163\163" => false, "\x65\162\x72\x6f\162" => $e->getMessage()); } } goto Bl4ea; ds25U: function dockern8n_RestoreWorkflowExport($params, $filename) { try { $hostname = $params["\163\145\162\166\x65\162\150\x6f\x73\x74\156\141\155\145"] ?: $params["\x73\x65\162\166\x65\162\x69\x70"]; $username = $params["\x73\x65\x72\166\145\x72\x75\x73\145\x72\x6e\x61\x6d\145"]; $password = $params["\163\145\x72\x76\x65\162\160\x61\x73\x73\x77\157\162\144"]; $serviceId = $params["\x73\x65\x72\x76\x69\x63\145\151\144"]; $filename = basename($filename); $info = dockern8n_GetContainerInfo($params); $containerName = $info["\156\70\156\x5f\x63\x6f\156\164\x61\151\156\145\x72"]; $exportDir = "\x2f\166\141\162\57\x77\167\167\57\x64\x6f\x63\x6b\145\162\x6e\70\x6e\x2f\145\170\x70\157\x72\x74\163\x2f\x73\x65\162\x76\x69\143\145\x2d{$serviceId}"; $cmdFind = "\x66\x69\156\144\x20\57\166\141\x72\57\167\x77\x77\x2f\x64\157\143\x6b\x65\x72\x6e\x38\x6e\x2f\145\170\x70\x6f\162\x74\163\x20\55\x6e\141\x6d\145\40\47{$filename}\47\x20\62\76\x2f\x64\145\166\57\156\165\x6c\154\40\x7c\40\x68\145\141\x64\x20\55\61"; $findPath = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdFind)); $filePath = !empty($findPath) ? $findPath : "{$exportDir}\57{$filename}"; $cmdCheck = "\164\x65\x73\164\x20\x2d\146\40\x22{$filePath}\42\40\x26\46\40\x65\143\x68\x6f\x20\x27\x65\170\x69\x73\164\163\x27\x20\x7c\x7c\40\x65\x63\150\x6f\40\x27\x6d\x69\x73\x73\x69\x6e\147\47"; $checkResult = trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCheck)); if ($checkResult !== "\145\x78\151\x73\x74\163") { return array("\x73\x75\143\143\x65\x73\163" => false, "\155\145\163\163\141\x67\x65" => "\105\x78\x70\157\162\x74\x20\x66\151\154\x65\40\156\x6f\164\40\x66\x6f\165\156\144\x3a\40{$filename}"); } $cmdReadFile = "\x63\x61\164\x20\42{$filePath}\x22"; $fileContent = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdReadFile); $jsonData = json_decode($fileContent, true); if (isset($jsonData["\167\157\x72\153\146\154\x6f\167\x73"]) && is_array($jsonData["\x77\x6f\162\153\146\154\157\167\163"])) { $workflowsJson = json_encode($jsonData["\167\157\162\x6b\x66\x6c\157\167\x73"]); $b64Workflows = base64_encode($workflowsJson); $cmdBatch = "\x65\x63\150\x6f\40\x27{$b64Workflows}\x27\40\174\40\142\x61\163\x65\x36\x34\40\55\x64\40\x3e\x20\57\164\x6d\x70\x2f\167\137\x72\x73\164\137{$serviceId}\56\152\163\157\x6e\40\x26\46\x20" . "\x64\x6f\x63\x6b\145\162\40\143\160\40\57\164\x6d\160\57\x77\137\162\x73\164\x5f{$serviceId}\x2e\x6a\163\157\156\x20{$containerName}\x3a\57\x74\x6d\x70\57\x77\157\162\153\146\154\157\167\163\x2e\152\163\x6f\x6e\40\46\x26\40" . "\x64\x6f\143\153\145\x72\40\x65\x78\145\x63\40{$containerName}\x20\x6e\x38\156\40\151\155\160\x6f\x72\x74\72\167\157\x72\x6b\x66\x6c\157\167\40\x2d\55\x69\156\x70\x75\x74\x3d\x2f\164\155\160\x2f\167\x6f\x72\153\x66\x6c\157\167\x73\x2e\152\163\157\156\x20\46\46\40" . "\162\155\40\55\x66\40\57\164\155\x70\x2f\167\137\162\x73\164\x5f{$serviceId}\56\x6a\163\x6f\x6e"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdBatch, 120); $importResults[] = "\127\x6f\x72\153\146\154\157\167\163\x3a\x20" . trim($output); if (isset($jsonData["\x63\x72\x65\144\x65\x6e\x74\x69\x61\x6c\163"]) && !empty($jsonData["\x63\x72\145\x64\145\156\x74\x69\x61\154\x73"])) { $credsJson = json_encode($jsonData["\x63\x72\x65\x64\x65\x6e\x74\151\x61\x6c\163"]); $b64Creds = base64_encode($credsJson); $cmdCredBatch = "\x65\143\x68\x6f\x20\x27{$b64Creds}\47\40\174\x20\x62\x61\163\x65\x36\x34\x20\x2d\144\x20\x3e\x20\57\164\155\160\x2f\x63\137\x72\x73\x74\x5f{$serviceId}\56\152\x73\157\156\40\x26\46\x20" . "\144\x6f\143\153\145\162\40\x63\160\x20\x2f\x74\x6d\x70\57\x63\x5f\x72\x73\x74\137{$serviceId}\56\152\x73\157\156\40{$containerName}\72\57\164\x6d\160\57\x63\162\145\144\x65\156\164\151\141\154\x73\x2e\152\163\x6f\156\x20\46\x26\40" . "\144\x6f\143\153\x65\x72\40\145\170\145\x63\40{$containerName}\x20\156\x38\x6e\40\151\155\x70\157\x72\164\x3a\x63\162\x65\x64\x65\x6e\164\x69\141\154\163\x20\x2d\55\151\x6e\x70\x75\164\x3d\57\164\x6d\x70\57\x63\162\145\x64\x65\x6e\164\x69\141\154\163\x2e\152\163\x6f\156\40\46\46\40" . "\162\x6d\x20\55\146\x20\x2f\x74\155\x70\x2f\143\137\x72\163\164\137{$serviceId}\56\152\163\x6f\x6e"; $credsOut = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdCredBatch, 120); $importResults[] = "\103\162\145\144\145\x6e\x74\x69\x61\x6c\x73\72\x20" . trim($credsOut); } } else { $cmdBatch = "\144\x6f\143\x6b\145\x72\40\x63\x70\x20\x22{$filePath}\42\x20{$containerName}\x3a\x2f\164\x6d\x70\57\x72\145\x73\164\x6f\162\145\x2e\x6a\163\157\x6e\40\46\46\x20" . "\x64\157\143\153\145\x72\x20\145\170\x65\x63\x20{$containerName}\x20\156\70\x6e\x20\x69\x6d\x70\157\162\164\72\167\x6f\162\153\146\154\x6f\x77\40\55\x2d\x69\x6e\x70\165\x74\x3d\57\x74\x6d\160\57\162\x65\163\x74\x6f\x72\145\56\152\163\x6f\156"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdBatch, 120); $importResults[] = trim($output); } dockern8n_LogActivity($params, "\167\x6f\x72\x6b\x66\154\157\167\137\x72\x65\x73\164\x6f\x72\145\x64", "\127\x6f\162\153\x66\x6c\157\x77\x73\40\162\x65\x73\164\157\x72\x65\144\x20\x66\162\157\155\72\40{$filename}"); $message = "\x57\x6f\162\x6b\146\154\157\x77\163\x20\x72\145\163\164\x6f\x72\145\144\x20\163\x75\143\x63\x65\x73\x73\x66\x75\x6c\154\x79\x20\x66\162\x6f\155\x20" . $filename; if ($hasCredentials) { $message .= "\x20\50\x69\156\143\154\165\144\151\x6e\147\x20\x63\x72\145\144\145\x6e\164\x69\141\154\163\51"; } return array("\x73\165\x63\143\145\x73\x73" => true, "\x6d\145\163\163\x61\147\145" => $message, "\x64\x65\x74\141\x69\x6c\163" => implode("\12", $importResults)); } catch (Exception $e) { return array("\163\165\x63\143\145\163\163" => false, "\155\x65\163\x73\x61\147\x65" => $e->getMessage()); } } goto A4wOX; EF0HY: function dockern8n_AdminCustomButtonArray() { return array("\103\x6f\156\164\141\151\156\145\x72\40\123\x74\141\162\164" => "\x41\144\x6d\151\x6e\x53\164\141\x72\164", "\x43\157\156\164\141\x69\156\x65\162\x20\x53\164\x6f\160" => "\x41\144\x6d\151\156\x53\164\x6f\x70", "\115\157\x75\156\x74\x20\144\x69\x73\x6b" => "\x41\144\155\151\156\115\157\165\156\164", "\x55\156\155\x6f\165\x6e\164\x20\144\151\x73\153" => "\x41\144\155\151\x6e\125\x6e\x6d\x6f\x75\156\164"); } goto lCtly; Bl4ea: function dockern8n_CreateAccount(array $params) { $serviceId = $params["\163\145\162\x76\x69\143\x65\151\144"]; $domain = $params["\144\157\x6d\x61\151\156"]; $mainDomain = $params["\143\x6f\x6e\146\x69\147\157\x70\164\151\x6f\x6e\x36"] ?? ''; $subdomainFormat = $params["\143\x6f\156\x66\x69\x67\x6f\160\164\151\x6f\x6e\67"] ?? "\x7b\x75\163\145\x72\137\151\x64\x7d\x2d\173\x73\x65\162\x76\x69\x63\x65\x5f\151\x64\x7d"; if (empty($domain) || $domain === "\x64\157\x6d\141\x69\156\56\143\x6f\x6d") { if (!function_exists("\144\157\143\153\x65\x72\x6e\70\156\137\x47\145\x6e\x65\x72\x61\x74\145\104\157\x6d\141\151\x6e")) { require_once __DIR__ . "\x2f\x44\157\x6d\141\151\156\x48\145\x6c\x70\x65\x72\x73\x2e\x70\x68\160"; } $domain = dockern8n_GenerateDomain($params, $mainDomain, $subdomainFormat); $domain = dockern8n_EnsureUniqueDomain($domain, $serviceId); Capsule::table("\x74\142\154\150\x6f\163\164\x69\x6e\x67")->where("\x69\144", $serviceId)->update(array("\144\x6f\x6d\x61\151\156" => $domain)); $params["\x64\x6f\155\x61\151\156"] = $domain; } $username = $params["\x75\163\x65\x72\156\141\x6d\145"]; $password = $params["\160\x61\163\163\x77\157\x72\144"]; if (empty($username)) { $username = "\141\x64\x6d\151\156"; Capsule::table("\164\142\154\x68\157\163\164\151\156\x67")->where("\x69\x64", $serviceId)->update(array("\x75\x73\145\162\x6e\141\155\x65" => $username)); $params["\165\x73\145\162\156\x61\x6d\145"] = $username; } if (empty($password)) { if (!function_exists("\144\157\x63\153\145\162\156\x38\156\137\x47\x65\x6e\x65\162\x61\164\145\x50\x61\163\163\x77\157\x72\144")) { require_once __DIR__ . "\x2f\104\x6f\x6d\141\151\156\110\x65\154\160\x65\x72\x73\x2e\x70\x68\x70"; } $password = dockern8n_GeneratePassword(12); Capsule::table("\x74\x62\154\x68\x6f\163\x74\151\156\147")->where("\x69\144", $serviceId)->update(array("\x70\x61\163\x73\x77\157\162\x64" => encrypt($password))); $params["\160\141\x73\163\x77\157\x72\x64"] = $password; } try { if (!class_exists("\104\x6f\143\153\x65\162\116\70\x4e\x5f\114\151\x63\145\x6e\x73\145")) { require_once __DIR__ . "\57\154\x69\143\145\156\163\x65\56\160\x68\160"; } $licenseCheck = DockerN8N_License::validate(); if (!$licenseCheck["\x76\x61\x6c\x69\144"]) { return "\114\x69\x63\145\156\163\145\x20\x45\162\x72\x6f\x72\x3a\40" . ($licenseCheck["\x6d\145\x73\x73\x61\147\x65"] ?? "\x49\156\166\x61\154\x69\x64\x20\154\151\x63\x65\156\x73\x65"); } $hostname = $params["\163\145\x72\x76\x65\x72\150\157\x73\x74\x6e\x61\x6d\145"] ?: $params["\x73\x65\162\x76\145\x72\151\160"]; $sshUsername = $params["\163\145\x72\x76\145\x72\x75\x73\145\x72\156\x61\155\x65"]; $sshPassword = $params["\x73\x65\x72\166\145\x72\160\x61\x73\x73\167\157\162\x64"]; if (empty($hostname) || empty($sshUsername) || empty($sshPassword)) { return "\x53\x65\x72\x76\x65\x72\x20\x63\157\x6e\x66\x69\x67\x75\x72\141\x74\151\157\x6e\x20\155\151\163\163\x69\x6e\x67\x2e"; } $userId = $params["\x75\163\145\162\151\x64"]; $cleanDomain = preg_replace("\x23\x5e\x68\164\164\160\163\x3f\x3a\57\x2f\43", '', $domain); $cleanDomain = rtrim($cleanDomain, "\57"); $userId = $params["\165\163\x65\x72\151\144"]; $mainDomain = $params["\x63\x6f\x6e\146\151\x67\x6f\160\x74\x69\x6f\x6e\x36"] ?? ''; if (empty($mainDomain)) { $mainDomain = "\143\171\142\145\162\x69\x74\x2e\143\x6c\x6f\x75\x64"; } $mainDomain = preg_replace("\43\x5e\x68\x74\x74\160\163\x3f\x3a\57\x2f\43", '', $mainDomain); $mainDomain = rtrim($mainDomain, "\57"); $prefix = "{$userId}\55{$serviceId}"; $cleanDomain = $mainDomain; $fullFQDN = "{$prefix}\x2e{$cleanDomain}"; if ($params["\x64\157\x6d\x61\151\x6e"] !== $fullFQDN) { Capsule::table("\x74\142\x6c\x68\157\163\x74\151\156\x67")->where("\151\x64", $serviceId)->update(array("\144\157\155\141\x69\x6e" => $fullFQDN)); $params["\144\157\x6d\x61\x69\x6e"] = $fullFQDN; } $puqContainer = $fullFQDN; $puqProject = $prefix . str_replace("\x2e", '', $cleanDomain); $clientsDir = "\x2f\157\160\164\x2f\144\157\143\153\x65\162\x2f\x63\x6c\151\x65\156\164\x73"; $serviceDir = "{$clientsDir}\57{$fullFQDN}"; $mountDir = "\57\155\156\164\x2f{$fullFQDN}"; $imgFile = "{$serviceDir}\x2f\x64\141\x74\141\x2e\x69\155\x67"; $statusFile = "{$serviceDir}\x2f\163\x74\x61\x74\x75\x73"; $ram = $params["\x63\157\x6e\x66\x69\x67\157\160\x74\x69\x6f\x6e\x33"] ?: "\61"; $cpu = $params["\143\x6f\156\146\151\x67\157\x70\164\x69\157\x6e\62"] ?: "\61"; $version = $params["\143\x6f\156\146\x69\x67\157\x70\164\x69\157\x6e\x34"] ?: "\154\141\x74\x65\163\x74"; $diskSize = $params["\143\x6f\156\x66\151\x67\x6f\x70\x74\x69\x6f\x6e\65"] ?: "\65"; $ram = preg_replace("\57\x5b\x5e\x30\x2d\71\56\x5d\57", '', $ram); $memoryWithSuffix = !empty($ram) ? $ram . "\x47" : "\61\107"; $prepCmd = "\x73\165\x64\x6f\40\x6d\153\144\x69\x72\x20\55\x70\40{$serviceDir}\40{$mountDir}\40\x26\46\40\163\x75\x64\x6f\40\x63\x68\155\157\x64\x20\x37\x37\67\40{$serviceDir}\40{$mountDir}"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $prepCmd); $diskCmd = "\151\x66\40\x5b\40\x21\x20\55\x66\x20{$imgFile}\x20\x5d\73\x20\164\x68\x65\156\x20\xa\x20\40\40\x20\40\40\x20\40\40\x20\x20\x20\50\x73\165\144\157\x20\x66\141\x6c\x6c\157\143\x61\x74\145\x20\55\154\x20{$diskSize}\107\40{$imgFile}\40\174\174\x20\x73\x75\144\x6f\40\164\x72\x75\x6e\143\x61\164\x65\x20\x2d\x73\x20{$diskSize}\107\x20{$imgFile}\51\40\x26\46\x20\xa\40\40\x20\40\40\x20\40\x20\40\x20\40\x20\163\x75\144\157\40\x6d\x6b\x66\163\x2e\145\170\164\64\x20\x2d\x46\40{$imgFile}\12\40\x20\x20\40\40\x20\x20\x20\x65\154\x73\x65\xa\40\x20\x20\40\40\x20\40\x20\40\40\x20\40\x65\143\x68\157\40\47\x44\x69\x73\153\40\x69\x6d\x61\147\x65\40\145\x78\x69\x73\x74\163\54\40\163\153\x69\x70\x70\x69\156\x67\40\x63\162\x65\x61\164\x69\x6f\156\x27\12\40\40\x20\x20\x20\40\x20\40\x66\x69"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $diskCmd, 180); $mountScript = "\xa\x20\x20\40\40\x20\x20\x20\x20\151\146\40\x21\x20\x67\162\x65\160\40\x2d\161\40\x27{$imgFile}\47\40\x2f\145\x74\x63\x2f\x66\163\164\x61\142\x3b\40\x74\150\x65\156\xa\40\x20\x20\x20\40\40\x20\x20\x20\x20\40\x20\x65\143\x68\x6f\x20\47{$imgFile}\40{$mountDir}\x20\x65\170\x74\x34\40\x6c\157\x6f\160\x20\x30\x20\x30\x27\40\174\x20\163\x75\x64\x6f\x20\164\145\145\40\x2d\x61\x20\x2f\145\x74\143\x2f\146\x73\164\x61\142\12\x20\40\40\x20\x20\40\x20\x20\x66\151\xa\x20\x20\x20\40\40\40\40\40\x73\x75\144\x6f\40\155\x6f\165\156\x74\40\55\x61\x20\x32\x3e\57\144\145\166\57\156\x75\x6c\154\40\174\x7c\40\x6d\157\165\156\x74\40\55\x6f\x20\154\157\157\160\x20{$imgFile}\40{$mountDir}\12\x20\x20\x20\x20\40\40\40\x20\x73\165\144\x6f\x20\x6d\153\144\151\x72\40\x2d\x70\40{$mountDir}\57\156\x38\156\x20{$mountDir}\57\x70\x6f\x73\x74\147\162\x65\x73\xa\x20\x20\40\x20\40\40\x20\x20\163\x75\144\x6f\x20\x63\x68\x6d\x6f\x64\40\x2d\122\40\x37\67\67\40{$mountDir}\12\40\40\40\x20\x20\x20\40\x20"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $mountScript); $templateType = $params["\x63\x6f\x6e\x66\x69\x67\157\x70\x74\x69\x6f\x6e\61"] ?: "\x6e\70\156\55\160\x67\163\x71\154"; $letsencryptEmail = $params["\143\157\156\x66\x69\x67\157\x70\x74\x69\x6f\x6e\x39"] ?: ''; $templateData = dockern8n_GetNginxTemplate($templateType, $fullFQDN, $serviceId, $cpu, $memoryWithSuffix, $version, $username, $password, $letsencryptEmail, "\x41\163\x69\x61\x2f\104\150\x61\153\x61", array(), $userId); $dockerCompose = $templateData["\144\x6f\143\x6b\145\162\137\x63\157\x6d\x70\x6f\163\x65"]; $credentials = $templateData["\x63\162\145\144\x65\x6e\164\151\141\154\163"]; $b64Compose = base64_encode($dockerCompose); $writeCmd = "\x65\143\150\x6f\x20\47{$b64Compose}\47\40\x7c\40\142\141\163\145\x36\64\40\55\x64\x20\76\40{$serviceDir}\x2f\x64\157\x63\153\145\162\x2d\x63\x6f\155\160\x6f\x73\145\x2e\x79\155\x6c"; dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $writeCmd); $upCmd = "\143\x64\x20{$serviceDir}\40\x26\x26\x20\x28\144\x6f\143\x6b\145\x72\40\143\157\155\160\x6f\163\145\40\55\160\40{$puqProject}\40\165\160\40\55\x64\x20\x32\x3e\46\x31\40\x7c\174\40\144\157\x63\153\x65\162\x2d\x63\157\155\160\x6f\163\145\x20\55\x70\x20{$puqProject}\40\x75\x70\40\55\x64\40\x32\x3e\x26\61\51"; $output = dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, $upCmd, 300); if (strpos($output, "\x45\x72\162\157\162") !== false || strpos($output, "\146\141\151\154\145\x64") !== false || strpos($output, "\151\x6e\166\x61\154\x69\144") !== false || strpos($output, "\x63\157\155\155\x61\156\144\40\x6e\x6f\x74\40\146\x6f\x75\x6e\144") !== false && strpos($output, "\165\160\40\x2d\144") === false) { return "\104\x65\x70\x6c\x6f\171\155\x65\x6e\164\x20\x66\x61\x69\154\x65\x64\x3a\40" . substr(strip_tags($output), 0, 300); } dockern8n_ssh_RunCommand($hostname, $sshUsername, $sshPassword, "\145\143\150\157\x20\x27\x61\x63\164\x69\166\x65\x27\40\x7c\x20\163\165\144\157\x20\x74\145\145\40{$statusFile}"); $details = array_merge($credentials, array("\x74\171\160\x65" => "\x70\165\161\137\x73\164\141\156\144\x61\x72\x64", "\x73\x65\162\166\x69\x63\145\x5f\x64\x69\x72" => $serviceDir, "\x6d\157\x75\156\164\x5f\x64\151\162" => $mountDir, "\143\157\156\164\141\151\x6e\x65\x72\137\156\x61\155\x65" => $puqContainer, "\x70\162\x6f\152\145\x63\x74\x5f\156\141\x6d\x65" => $puqProject, "\x64\157\x6d\141\x69\x6e" => $cleanDomain, "\x63\x72\145\x61\164\x65\x64\137\141\164" => date("\x59\55\155\55\x64\40\110\72\x69\72\163"))); $customField = Capsule::table("\164\x62\154\x63\x75\163\164\157\155\146\x69\x65\154\144\x73")->where("\162\145\x6c\151\144", $params["\x70\141\x63\153\x61\x67\145\151\144"])->where("\146\x69\145\154\144\156\141\155\x65", "\x53\145\162\166\x69\143\145\40\104\145\x74\141\151\154\163")->first(); if ($customField) { Capsule::table("\164\x62\154\x63\165\x73\164\x6f\x6d\146\151\x65\x6c\x64\x73\x76\x61\x6c\x75\145\x73")->updateOrInsert(array("\146\151\x65\154\144\x69\x64" => $customField->id, "\162\x65\154\x69\x64" => $serviceId), array("\x76\x61\x6c\165\x65" => json_encode($details))); } dockern8n_LogActivity($params, "\163\x65\162\x76\x69\x63\x65\x5f\x63\x72\145\x61\x74\145\144", "\x4e\70\x4e\x20\120\x55\x51\55\103\x6c\x6f\x6e\145\x20\163\x65\162\166\151\143\145\40\160\x72\157\166\x69\163\151\157\156\145\x64\40\141\x74\40{$cleanDomain}"); return "\x73\165\x63\143\145\x73\x73"; } catch (Exception $e) { return "\x50\x72\x6f\166\151\163\151\x6f\156\151\x6e\147\x20\x46\x61\x69\x6c\x65\x64\x3a\x20" . $e->getMessage(); } } goto IxyYF; reEfV: function dockern8n_RestoreBackup($params, $backupFilename) { try { $hostname = $params["\x73\x65\x72\x76\145\x72\150\x6f\163\164\x6e\x61\155\x65"] ? $params["\163\x65\162\166\x65\x72\150\157\163\164\156\141\155\x65"] : $params["\163\145\162\x76\x65\162\151\x70"]; $username = $params["\163\145\x72\166\x65\162\165\x73\x65\x72\156\x61\155\x65"]; $password = $params["\163\x65\162\166\x65\x72\x70\141\163\163\167\157\x72\144"]; $serviceId = $params["\x73\145\x72\166\151\x63\145\151\x64"]; if (empty($backupFilename)) { return array("\163\x75\143\143\145\x73\163" => false, "\155\x65\163\x73\141\147\145" => "\x42\x61\143\153\165\160\x20\146\151\x6c\145\x6e\141\x6d\x65\x20\151\x73\40\162\x65\161\165\151\x72\x65\144"); } $backupFilename = basename($backupFilename); if (!preg_match("\x2f\x5e\x62\x61\143\x6b\165\160\137\56\x2a\x5c\x2e\164\141\162\134\x2e\147\x7a\44\x2f\x69", $backupFilename)) { return array("\163\x75\143\x63\x65\163\x73" => false, "\x6d\x65\x73\163\x61\147\x65" => "\111\156\166\141\154\151\144\40\x62\141\x63\x6b\165\x70\40\146\151\154\x65\156\141\x6d\145"); } $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $backupDir = "\57\166\141\x72\x2f\167\x77\x77\57\144\157\143\153\x65\x72\156\70\x6e\x2f\142\141\143\153\x75\160\163\57\x73\x65\x72\x76\151\143\145\55{$serviceId}"; $backupPath = "{$backupDir}\x2f{$backupFilename}"; $logFile = "\x2f\166\x61\x72\57\167\167\167\57\x64\x6f\x63\x6b\x65\162\156\70\x6e\57\x6c\x6f\x67\163\x2f\x72\x65\x73\164\157\x72\145\55{$serviceId}\x2e\x6c\157\x67"; if ($puqInfo["\x69\x73\137\x70\x75\x71"]) { $serviceDir = $puqInfo["\x73\145\x72\166\151\143\x65\x5f\144\151\162"]; $dataPath = $puqInfo["\155\x6f\x75\156\x74\137\x64\151\162"]; $asyncCmd = "\151\146\x20\x5b\40\41\x20\x2d\x66\40{$backupPath}\40\135\73\x20\x74\150\x65\156\40\x65\143\x68\157\40\47\105\122\122\x4f\122\72\40\102\x61\x63\153\165\x70\x20\146\151\x6c\x65\x20\156\x6f\x74\x20\146\157\x75\x6e\x64\x27\40\46\x26\x20\x65\170\x69\x74\40\x31\73\40\146\151\x20\46\46\40" . "\143\x64\x20{$serviceDir}\x20\46\46\x20\144\x6f\x63\x6b\145\162\55\x63\157\x6d\160\x6f\163\145\x20\x73\164\x6f\160\x20\x26\46\40\162\155\x20\55\162\x66\40{$dataPath}\57\x2a\40\62\x3e\57\144\145\x76\57\156\165\x6c\x6c\73\40" . "\x74\141\162\x20\x2d\x78\172\146\x20{$backupPath}\x20\x2d\x43\x20{$dataPath}\x20\46\x26\x20\x64\x6f\143\153\145\x72\x2d\x63\157\155\x70\157\163\145\x20\x75\x70\x20\55\144"; } else { $serviceDir = "\x2f\x76\x61\x72\57\x77\x77\x77\x2f\x64\x6f\x63\x6b\145\162\x6e\70\x6e\x2f\163\x65\162\166\151\x63\145\55{$serviceId}"; $volumeName = "\x73\x65\162\x76\151\143\x65\55{$serviceId}\137\156\x38\156\55\144\141\164\x61"; $volumePath = "\x2f\x76\141\162\x2f\154\x69\x62\x2f\144\157\143\x6b\x65\162\x2f\166\157\154\165\155\x65\x73\57{$volumeName}\57\x5f\144\141\164\141"; $asyncCmd = "\151\x66\x20\x5b\x20\x21\40\55\x66\x20{$backupPath}\x20\x5d\73\x20\164\150\x65\x6e\x20\145\x63\x68\157\x20\47\x45\122\x52\117\122\x3a\x20\x42\141\x63\153\x75\x70\x20\x66\x69\154\x65\x20\x6e\x6f\164\40\x66\157\x75\x6e\x64\47\40\46\x26\x20\145\170\151\x74\x20\61\73\x20\x66\x69\40\46\x26\x20" . "\x63\x64\40{$serviceDir}\x20\46\x26\40\x64\157\143\153\x65\x72\x20\x63\157\x6d\x70\x6f\x73\145\40\x73\x74\157\x70\40\x26\x26\x20\x72\155\x20\55\162\x66\40{$volumePath}\57\x2a\40\62\x3e\x2f\x64\x65\x76\57\x6e\x75\154\x6c\x3b\40" . "\x74\x61\x72\x20\x2d\x78\x7a\x66\40{$backupPath}\40\55\x43\40{$volumePath}\x20\46\46\40\144\157\143\x6b\x65\x72\40\143\157\x6d\x70\157\163\x65\40\165\160\40\55\144"; } $restoreOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $asyncCmd); if (strpos($restoreOutput, "\105\122\x52\117\x52\72") !== false) { return array("\163\x75\x63\x63\145\x73\x73" => false, "\x6d\145\x73\163\141\x67\x65" => "\122\x65\x73\x74\x6f\162\145\40\x66\141\x69\154\145\144\72\x20" . $restoreOutput); } dockern8n_LogActivity($params, "\x62\141\143\153\165\x70\x5f\x72\x65\x73\164\x6f\162\145\x64", "\x42\x61\143\x6b\x75\160\x20\162\x65\163\x74\x6f\162\145\144\x3a\40{$backupFilename}"); unset($GLOBALS["\144\x6f\143\x6b\x65\x72\156\70\x6e\137\163\164\x61\x74\x75\x73\x5f\143\x61\x63\x68\x65"]["\163\164\x61\x74\165\x73\x5f" . $serviceId]); return array("\x73\165\x63\x63\x65\x73\x73" => true, "\155\x65\163\163\141\x67\145" => "\x42\141\x63\x6b\x75\x70\x20\162\x65\163\x74\x6f\162\x65\144\40\x73\165\x63\x63\x65\163\163\x66\x75\x6c\154\171\x21"); } catch (Exception $e) { return array("\163\165\x63\143\145\163\x73" => false, "\x6d\x65\163\x73\141\147\x65" => $e->getMessage()); } } goto tzq6J; ylZ3g: function dockern8n_ReinstallService($params, $wipeData = false) { try { $hostname = $params["\163\x65\162\166\145\162\x68\x6f\163\x74\156\x61\x6d\145"] ? $params["\163\145\x72\166\x65\162\x68\x6f\x73\164\156\141\155\x65"] : $params["\163\x65\162\166\145\162\151\160"]; $username = $params["\x73\x65\162\x76\145\162\165\163\145\x72\156\141\155\x65"]; $password = $params["\x73\x65\x72\166\x65\162\160\x61\x73\163\x77\157\162\x64"]; $domain = preg_replace("\x23\136\x68\x74\164\160\163\x3f\x3a\x2f\57\x23", '', $params["\144\157\155\x61\151\x6e"] ?? ''); $serviceDir = dockern8n_GetServiceDirectory($domain, $serviceId, true); if ($wipeData) { $cmd = "\143\x64\40{$serviceDir}\x20\46\46\x20\x28\144\x6f\143\153\145\x72\x20\x63\157\x6d\160\157\x73\x65\40\x64\x6f\x77\x6e\40\x2d\x76\x20\174\174\x20\144\157\x63\x6b\145\162\55\x63\x6f\x6d\160\x6f\x73\x65\40\x64\x6f\x77\x6e\40\x2d\x76\x29\x20\46\x26\x20\x28\144\x6f\x63\153\x65\162\40\143\157\155\160\x6f\163\145\40\x75\x70\40\55\x64\40\174\x7c\40\x64\x6f\143\153\x65\162\x2d\143\x6f\155\x70\x6f\163\x65\x20\165\160\x20\x2d\x64\x29"; $msg = "\123\x65\x72\x76\x69\143\x65\40\x77\151\160\145\144\x20\141\156\144\x20\x72\x65\55\160\162\x6f\x76\151\163\x69\x6f\x6e\x65\144\56"; } else { $cmd = "\x63\144\40{$serviceDir}\x20\x26\46\x20\50\144\157\x63\x6b\x65\x72\40\143\x6f\x6d\x70\x6f\163\145\x20\x75\160\x20\x2d\x64\40\55\55\146\157\x72\143\145\x2d\x72\145\143\x72\145\141\x74\145\40\174\174\x20\x64\157\143\153\145\x72\55\x63\x6f\155\160\x6f\x73\145\x20\165\x70\40\x2d\x64\40\55\x2d\146\157\x72\x63\x65\55\162\145\x63\162\x65\x61\164\x65\x29"; $msg = "\123\145\x72\x76\151\143\145\x20\x72\x65\x69\156\x73\164\x61\154\154\145\144\x20\50\x44\x61\x74\x61\40\120\x72\145\x73\145\162\x76\145\144\x29\56"; } $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd); if (strpos($output, "\105\162\x72\157\x72") !== false && strpos($output, "\x53\x74\141\x72\x74\x65\144") === false && strpos($output, "\122\165\x6e\156\x69\156\x67") === false && strpos($output, "\122\145\143\162\x65\x61\x74\145\144") === false) { return array("\163\165\143\143\x65\163\x73" => false, "\x6d\x65\x73\163\141\x67\x65" => "\x44\157\x63\153\145\x72\40\105\162\162\157\x72\72\x20" . $output); } return array("\x73\x75\143\x63\x65\163\163" => true, "\x6d\x65\163\163\141\x67\145" => $msg); } catch (Exception $e) { return array("\163\x75\x63\143\x65\163\x73" => false, "\x6d\145\163\x73\141\147\145" => $e->getMessage()); } } goto uNpAA; EW6q0: function dockern8n_ExportWorkflows($params, $includeCredentials = false) { try { $hostname = $params["\163\x65\x72\166\145\x72\x68\x6f\x73\x74\156\141\x6d\145"] ?: $params["\x73\x65\162\x76\x65\162\151\x70"]; $username = $params["\x73\x65\x72\x76\x65\162\x75\163\145\162\x6e\141\x6d\x65"]; $password = $params["\163\145\x72\x76\145\x72\x70\141\163\x73\167\157\x72\x64"]; $serviceId = $params["\163\145\x72\166\x69\143\x65\x69\x64"]; $puqInfo = DockerN8N_PUQCompat::detectPUQService($params); $containerName = $puqInfo["\151\163\x5f\160\x75\161"] ? $puqInfo["\143\x6f\156\164\x61\151\156\x65\162\137\x6e\x61\155\145"] : "\163\145\162\x76\151\x63\x65\x2d{$serviceId}\x2d\156\x38\156"; $exportDir = "\57\x76\x61\x72\57\167\x77\x77\57\x64\157\143\x6b\145\162\156\x38\x6e\x2f\145\x78\x70\157\x72\164\163\x2f\163\145\x72\x76\151\x63\x65\x2d{$serviceId}"; $logFile = "\57\166\141\x72\x2f\167\167\167\57\144\x6f\x63\x6b\145\162\156\70\156\x2f\x6c\x6f\x67\163\x2f\x65\170\160\x6f\162\x74\55{$serviceId}\x2e\154\157\x67"; $timestamp = date("\x59\x2d\155\x2d\x64\x5f\110\x2d\x69\55\x73"); $credSuffix = $includeCredentials ? "\x5f\x77\x69\x74\x68\x5f\143\x72\145\144\x73" : ''; $exportFile = "\x77\x6f\x72\x6b\x66\154\x6f\167\163\x5f{$timestamp}{$credSuffix}\x2e\152\163\157\x6e"; $exportPath = "{$exportDir}\x2f{$exportFile}"; if ($includeCredentials) { $asyncCmd = "\x6d\x6b\144\x69\162\x20\x2d\x70\x20{$exportDir}\40\x26\46\x20" . "\144\x6f\x63\x6b\x65\x72\40\x65\x78\145\x63\x20{$containerName}\x20\156\x38\156\x20\x65\x78\160\157\x72\x74\x3a\x77\157\x72\x6b\x66\x6c\x6f\x77\x20\55\x2d\x61\x6c\154\x20\x2d\55\x6f\x75\x74\x70\165\x74\x3d\57\x74\155\x70\57\167\x6f\x72\x6b\x66\x6c\157\x77\163\137\145\x78\160\x2e\152\163\157\156\x20\x3e\x2f\x64\145\166\x2f\156\165\x6c\154\x20\x32\76\46\x31\40\46\46\x20" . "\144\157\143\153\x65\162\x20\x65\x78\x65\x63\x20{$containerName}\x20\156\70\x6e\x20\x65\170\x70\157\162\164\72\x63\162\x65\144\145\156\x74\151\x61\154\x73\x20\x2d\55\141\x6c\154\x20\x2d\55\157\165\x74\x70\x75\164\75\57\164\155\160\57\x63\162\x65\x64\145\156\x74\x69\141\154\x73\x5f\x65\x78\x70\x2e\x6a\163\x6f\156\40\76\57\144\x65\x76\x2f\x6e\x75\154\x6c\40\62\x3e\x26\61\x20\46\46\x20" . "\144\157\143\153\145\x72\40\145\x78\x65\143\x20{$containerName}\40\x73\150\x20\55\x63\x20\47" . "\145\143\150\157\40\x2d\156\x20\x22\173\x5c\x22\167\x6f\x72\153\146\x6c\157\x77\x73\134\42\72\42\x3b\x20" . "\x5b\40\x2d\146\40\57\x74\155\160\x2f\167\157\x72\153\146\154\x6f\x77\x73\137\145\x78\160\x2e\152\x73\x6f\x6e\40\x5d\x20\46\x26\40\143\x61\164\40\x2f\164\x6d\160\x2f\x77\157\162\153\146\154\x6f\x77\x73\x5f\145\x78\x70\56\x6a\163\x6f\156\40\x7c\174\40\x65\143\x68\157\40\x2d\156\x20\42\133\135\x22\73\x20" . "\x65\143\x68\x6f\x20\55\156\x20\x22\x2c\134\x22\x63\162\x65\144\145\156\164\x69\141\x6c\163\x5c\x22\72\x22\x3b\x20" . "\133\x20\x2d\x66\40\57\x74\155\x70\57\x63\x72\x65\144\x65\156\x74\151\x61\154\x73\137\x65\170\160\56\152\x73\157\156\40\135\x20\46\46\x20\143\x61\x74\40\57\x74\x6d\x70\57\x63\162\145\x64\145\156\x74\151\x61\154\x73\137\145\x78\x70\x2e\152\x73\157\156\x20\x7c\174\x20\145\x63\150\157\40\x2d\x6e\x20\x22\x5b\135\x22\73\40" . "\145\x63\x68\x6f\40\55\156\40\x22\175\x22\47\x20\x3e\40{$exportPath}\x20\46\46\40" . "\x64\157\143\153\x65\162\40\145\170\x65\x63\40{$containerName}\40\162\155\40\55\x66\40\x2f\164\155\x70\57\167\157\162\x6b\x66\x6c\x6f\167\163\x5f\x65\170\160\56\x6a\163\x6f\156\x20\x2f\x74\155\x70\x2f\x63\162\x65\x64\145\x6e\164\151\x61\x6c\163\137\145\170\160\56\x6a\163\x6f\x6e"; } else { $asyncCmd = "\155\x6b\144\151\162\40\x2d\x70\x20{$exportDir}\40\x26\46\x20" . "\144\157\143\153\x65\162\x20\x65\170\x65\x63\40{$containerName}\40\x6e\x38\156\40\x65\170\160\157\162\x74\x3a\167\157\162\x6b\x66\154\x6f\x77\40\x2d\x2d\x61\x6c\x6c\40\x2d\x2d\x6f\x75\164\x70\165\164\x3d\x2f\164\155\x70\57\167\157\162\153\146\154\x6f\167\x73\x5f\x65\170\x70\x2e\x6a\163\x6f\156\x20\x3e\57\144\145\166\x2f\x6e\x75\154\154\x20\62\x3e\x26\x31\40\46\x26\40" . "\x64\157\x63\153\145\x72\x20\x63\x70\x20{$containerName}\72\x2f\164\155\160\57\x77\x6f\x72\x6b\146\154\x6f\x77\x73\137\x65\x78\x70\x2e\152\x73\157\x6e\40{$exportPath}\40\x26\46\x20" . "\x64\157\x63\153\145\x72\40\145\170\x65\143\x20{$containerName}\x20\x72\155\x20\x2d\x66\40\57\164\x6d\x70\57\167\157\162\x6b\146\x6c\157\167\x73\137\145\170\160\x2e\x6a\x73\157\156"; } $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $asyncCmd); $verifyCmd = "\133\40\x2d\146\40{$exportPath}\40\135\40\46\x26\x20\163\x74\x61\x74\40\55\143\x25\163\40{$exportPath}\x20\x7c\174\x20\x65\143\150\x6f\x20\47\x30\x27"; $fileSize = (int) trim(dockern8n_ssh_RunCommand($hostname, $username, $password, $verifyCmd)); if ($fileSize < 10) { $errorMsg = "\105\x78\x70\x6f\x72\164\x20\x66\141\151\x6c\145\x64\x3a\40\106\151\154\x65\40\156\x6f\164\40\x63\x72\145\141\x74\x65\x64\40\x6f\x72\x20\145\155\x70\x74\171\x2e"; if (!empty($output)) { $errorMsg .= "\x20\103\x6f\x6d\155\x61\156\x64\40\157\x75\x74\x70\x75\164\x3a\40" . substr($output, 0, 150); } return array("\163\165\x63\143\x65\163\163" => false, "\155\x65\x73\163\141\x67\x65" => $errorMsg); } dockern8n_LogActivity($params, "\x77\157\x72\153\146\154\157\x77\137\x62\x61\x63\x6b\165\160", "\x57\x6f\162\x6b\146\x6c\x6f\167\40\142\141\x63\153\x75\160\x20\x63\x72\x65\141\x74\145\144\72\x20{$exportFile}" . ($includeCredentials ? "\x20\50\x77\x69\164\x68\x20\143\x72\x65\x64\145\x6e\164\x69\x61\x6c\163\x29" : '')); return array("\163\165\x63\x63\x65\x73\x73" => true, "\x6d\x65\x73\163\141\147\145" => "\x45\170\160\157\x72\x74\x20\x63\157\x6d\x70\x6c\x65\x74\145\144\40\x73\165\143\x63\145\163\163\146\x75\x6c\x6c\171\41", "\146\151\154\x65\x6e\x61\x6d\x65" => $exportFile, "\151\156\x63\154\x75\144\x65\163\103\162\x65\x64\x65\156\164\151\141\x6c\163" => $includeCredentials, "\x73\x69\172\145" => $fileSize); } catch (Exception $e) { return array("\x73\x75\143\143\145\x73\x73" => false, "\x6d\x65\163\x73\141\147\145" => $e->getMessage()); } } goto gPycU; pEiK_: function dockern8n_start($params) { try { $hostname = $params["\x73\x65\x72\166\x65\x72\150\x6f\163\x74\x6e\x61\155\145"] ?: $params["\x73\x65\x72\x76\x65\x72\x69\x70"]; $username = $params["\163\x65\162\x76\145\x72\x75\163\145\162\x6e\x61\x6d\145"]; $password = $params["\x73\x65\x72\166\145\162\160\141\x73\x73\167\x6f\x72\x64"]; $info = dockern8n_GetContainerInfo($params); $serviceDir = $info["\163\x65\162\x76\151\x63\145\x5f\144\151\x72"]; $projectName = $info["\x70\x72\157\x6a\x65\x63\x74\137\x6e\141\155\145"]; $containerName = $info["\x6e\x38\156\x5f\143\x6f\x6e\164\x61\x69\x6e\x65\x72"]; if ($info["\151\x73\137\x70\165\161"]) { dockern8n_ssh_RunCommand($hostname, $username, $password, "\x6d\157\165\x6e\164\x20\55\141\40\x32\x3e\x2f\x64\145\x76\x2f\156\165\x6c\x6c\x20\x26\x26\x20\x73\x6c\x65\x65\160\40\61"); } $cmd = "\x63\x64\x20{$serviceDir}\x20\x26\x26\40\x28\144\x6f\x63\x6b\145\162\x20\x63\157\155\x70\157\163\x65\40\55\160\x20{$projectName}\40\163\164\141\x72\164\40\x7c\174\40\144\x6f\143\153\x65\x72\55\143\x6f\x6d\x70\157\x73\x65\x20\x2d\160\40{$projectName}\x20\x73\164\141\x72\164\40\x7c\174\40\144\157\143\x6b\145\x72\40\163\164\141\x72\164\40{$containerName}\x29\40\x32\76\46\61"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmd, 60); if (stripos($output, "\x65\x72\x72\157\162") !== false || stripos($output, "\x66\141\x69\154\145\x64") !== false) { if (stripos($output, "\163\x74\x61\x72\x74\145\144") === false && stripos($output, "\x72\x75\x6e\156\151\x6e\147") === false && stripos($output, "\144\157\156\x65") === false) { $cmdUp = "\x63\144\x20{$serviceDir}\40\x26\46\x20\x28\144\x6f\x63\153\145\x72\x20\143\x6f\x6d\160\x6f\x73\x65\x20\x2d\160\40{$projectName}\40\x75\x70\40\55\144\x20\174\x7c\x20\x64\x6f\x63\x6b\x65\x72\55\143\157\155\x70\157\163\x65\40\55\160\x20{$projectName}\x20\165\x70\40\55\144\x29\x20\62\x3e\46\61"; $output = dockern8n_ssh_RunCommand($hostname, $username, $password, $cmdUp, 120); } } logActivity("\104\x6f\143\153\145\162\x4e\70\x4e\40\123\164\141\162\164\40\55\40\123\x65\162\x76\x69\143\x65\x20\111\x44\72\x20" . $params["\x73\145\162\x76\x69\x63\145\x69\x64"] . "\x20\x52\x65\x73\165\x6c\x74\72\x20" . trim($output)); dockern8n_LogActivity($params, "\x73\x65\162\x76\151\x63\x65\137\163\164\x61\x72\x74\145\x64", "\x4e\70\x4e\40\163\145\162\x76\151\143\x65\x20\x73\164\141\143\153\40\163\164\141\x72\164\x69\156\147\x2e\x2e\x2e"); return "\x73\165\x63\x63\145\163\163"; } catch (Exception $e) { return "\105\162\162\157\x72\x3a\40" . $e->getMessage(); } } goto u0O4j; By09A: function dockern8n_GetSSLStatus($params) { try { $hostname = $params["\x73\x65\162\166\x65\162\150\157\x73\x74\x6e\141\x6d\145"] ?: $params["\163\145\x72\166\145\162\151\160"]; $username = $params["\x73\145\162\x76\145\x72\x75\x73\145\x72\156\x61\155\145"]; $password = $params["\163\145\x72\x76\x65\162\160\141\x73\x73\167\157\162\144"]; $domain = preg_replace("\x23\x5e\150\x74\x74\x70\163\x3f\x3a\x2f\x2f\43", '', $params["\144\x6f\x6d\x61\x69\156"] ?? ''); $domain = rtrim($domain, "\57"); if (empty($domain)) { return array("\x73\x75\x63\x63\145\163\163" => false, "\155\x65\163\x73\x61\x67\145" => "\104\x6f\155\x61\x69\156\x20\x6e\x6f\164\40\143\x6f\156\x66\151\x67\165\x72\x65\144"); } $certPaths = array("\57\x6f\x70\x74\57\144\157\x63\153\145\162\57\156\147\x69\x6e\x78\x2d\x70\x72\157\x78\171\x2f\143\x65\162\x74\x73\57{$domain}\56\143\162\164", "\x2f\x6f\x70\164\x2f\x64\157\143\x6b\x65\162\x2f\156\x67\x69\156\170\57\143\x65\162\x74\163\57{$domain}\x2e\x63\162\x74", "\x2f\x65\164\x63\57\x6e\x67\x69\156\x78\57\143\145\162\x74\x73\57{$domain}\56\x63\x72\x74", "\x2f\x6f\x70\164\57\x70\x72\157\x78\171\57\143\145\162\x74\163\x2f{$domain}\56\x63\x72\164"); $checkCmd = ''; foreach ($certPaths as $cp) { $checkCmd .= "\151\146\x20\133\x20\55\146\x20\42{$cp}\42\40\135\73\40\x74\150\145\x6e\x20\x6f\160\x65\156\163\163\154\x20\x78\65\x30\x39\x20\55\151\156\40\x22{$cp}\x22\x20\x2d\x6e\x6f\x6f\165\x74\40\55\144\141\x74\x65\x73\x20\55\151\163\x73\x75\145\x72\73\40\x65\x63\x68\x6f\x20\x22\x50\101\124\110\x3a{$cp}\x22\73\40\145\x78\x69\164\40\x30\x3b\x20\x66\151\xa"; } $sshOutput = dockern8n_ssh_RunCommand($hostname, $username, $password, $checkCmd); if (!empty($sshOutput) && strpos($sshOutput, "\x6e\157\x74\101\x66\x74\145\162\75") !== false) { preg_match("\x2f\x6e\x6f\x74\102\x65\x66\157\x72\x65\75\x28\56\52\51\57", $sshOutput, $matchesFrom); preg_match("\57\x6e\x6f\164\x41\146\x74\145\162\x3d\50\56\x2a\x29\x2f", $sshOutput, $matchesTo); preg_match("\57\x69\x73\x73\165\145\162\x3d\x28\x2e\52\51\x2f", $sshOutput, $matchesIssuer); $validFromTs = isset($matchesFrom[1]) ? strtotime($matchesFrom[1]) : 0; $validToTs = isset($matchesTo[1]) ? strtotime($matchesTo[1]) : 0; $issuer = isset($matchesIssuer[1]) ? $matchesIssuer[1] : "\x55\x6e\153\x6e\x6f\x77\156"; $expiresIn = ceil(($validToTs - time()) / 86400); $status = "\x76\x61\x6c\151\x64"; if ($expiresIn < 0) { $status = "\x65\170\x70\x69\162\x65\144"; } elseif ($expiresIn < 7) { $status = "\x65\x78\x70\151\162\x69\156\147\x5f\x73\x6f\x6f\156"; } return array("\x73\165\143\x63\x65\x73\163" => true, "\163\163\x6c\x5f\x73\x74\x61\x74\x75\x73" => $status, "\144\x6f\x6d\x61\x69\x6e" => $domain, "\x69\163\x73\165\145\162" => str_replace("\x4f\40\75\x20", '', $issuer), "\166\x61\x6c\151\x64\137\x66\162\x6f\155" => date("\x59\x2d\x6d\55\144\x20\x48\x3a\x69\x3a\163", $validFromTs), "\x76\x61\154\151\x64\x5f\164\x6f" => date("\131\x2d\x6d\x2d\144\40\110\72\151\x3a\x73", $validToTs), "\145\x78\160\x69\162\145\163\x5f\x69\156\137\144\x61\171\x73" => (int) $expiresIn, "\x63\150\x65\143\153\137\x6d\145\164\x68\x6f\144" => "\154\157\x63\x61\x6c\x5f\x73\x73\150"); } $context = stream_context_create(array("\163\x73\x6c" => array("\143\141\160\164\x75\x72\x65\137\x70\x65\x65\162\137\143\145\x72\x74" => true, "\x76\x65\x72\151\146\x79\137\x70\145\x65\x72" => false, "\x76\x65\x72\x69\x66\x79\137\160\145\x65\162\137\x6e\x61\x6d\145" => false, "\x53\116\111\137\145\156\141\x62\154\145\144" => true, "\x70\x65\x65\x72\137\156\141\x6d\145" => $domain))); $client = @stream_socket_client("\x73\x73\154\72\x2f\57{$domain}\x3a\64\64\63", $errno, $errstr, 5, STREAM_CLIENT_CONNECT, $context); if (!$client) { return array("\x73\x75\x63\143\145\x73\x73" => true, "\163\163\154\x5f\x73\x74\x61\x74\165\163" => "\x70\x65\x6e\144\151\x6e\147", "\x6d\145\163\163\x61\147\145" => "\x53\x53\114\40\143\x65\x72\x74\40\156\x6f\164\x20\146\x6f\165\156\144\x20\x6c\x6f\x63\x61\154\x6c\171\x20\141\x6e\x64\40\x6e\145\164\x77\157\162\153\40\143\150\x65\x63\153\40\146\141\151\154\145\144\x2e\40\120\x6f\164\x65\156\164\x69\141\154\x6c\171\40\x44\x4e\123\x20\x70\x72\157\160\x61\x67\141\x74\x69\157\156\x20\x69\163\163\165\x65\x2e", "\144\157\155\x61\151\x6e" => $domain); } $streamParams = stream_context_get_params($client); $cert = openssl_x509_parse($streamParams["\157\160\164\x69\x6f\156\163"]["\163\x73\154"]["\x70\145\145\162\137\143\145\162\164\x69\146\151\143\141\164\x65"]); fclose($client); $validFrom = date("\131\x2d\155\55\x64\40\x48\72\x69\x3a\x73", $cert["\x76\x61\x6c\151\144\106\162\157\x6d\137\164\x69\x6d\x65\137\164"]); $validTo = date("\x59\x2d\x6d\x2d\x64\40\x48\72\x69\x3a\x73", $cert["\166\141\154\151\x64\124\x6f\x5f\x74\151\155\x65\137\x74"]); $expiresIn = ceil(($cert["\166\141\x6c\x69\144\x54\x6f\x5f\164\151\155\x65\137\x74"] - time()) / 86400); $status = "\x76\141\x6c\151\144"; if ($expiresIn < 0) { $status = "\x65\170\x70\151\162\x65\x64"; } elseif ($expiresIn < 7) { $status = "\x65\x78\x70\151\162\x69\156\x67\137\x73\157\157\156"; } return array("\x73\165\143\x63\145\x73\163" => true, "\163\163\154\137\x73\x74\x61\x74\165\x73" => $status, "\144\157\x6d\x61\x69\x6e" => $domain, "\151\x73\163\x75\145\x72" => $cert["\151\x73\x73\165\x65\x72"]["\117"] ?? $cert["\151\x73\163\165\145\x72"]["\103\x4e"] ?? "\125\x6e\x6b\x6e\157\167\156", "\166\x61\154\x69\x64\x5f\146\x72\x6f\x6d" => $validFrom, "\x76\141\154\x69\x64\137\x74\x6f" => $validTo, "\145\170\160\x69\162\x65\163\x5f\x69\156\x5f\x64\141\x79\163" => (int) $expiresIn, "\143\x68\x65\143\153\x5f\x6d\145\164\150\157\x64" => "\156\x65\164\x77\x6f\162\x6b"); } catch (Exception $e) { return array("\163\x75\x63\143\145\163\x73" => false, "\155\145\163\x73\141\x67\x65" => $e->getMessage()); } }