<?php
 goto fQInZ; ZxxRJ: if (class_exists("\x44\x6f\x63\153\x65\x72\116\x38\116\x5f\101\x50\111")) { return; } goto Xhbju; fQInZ: if (!defined("\x57\110\115\x43\x53")) { die("\124\150\x69\163\x20\146\x69\x6c\145\40\x63\x61\x6e\156\157\164\40\x62\x65\x20\141\x63\143\145\x73\x73\145\x64\40\144\151\162\x65\143\x74\x6c\171"); } goto ZxxRJ; Xhbju: class DockerN8N_API { private $baseUrl; private $useTLS = false; private $certPath = ''; private $timeout = 30; private $lastError = ''; public function connect($host, $port = 2375, $useTLS = false, $certPath = '') { try { if ($host === "\165\x6e\151\x78" || $host === "\154\157\143\x61\x6c\x68\x6f\x73\164") { $this->baseUrl = "\x75\x6e\151\x78\x3a\x2f\57\x2f\166\x61\162\x2f\x72\x75\156\57\144\157\143\153\145\162\56\163\157\x63\153"; } else { $protocol = $useTLS ? "\x68\164\164\160\x73" : "\x68\x74\164\160"; $this->baseUrl = "{$protocol}\x3a\x2f\57{$host}\72{$port}"; $this->useTLS = $useTLS; $this->certPath = $certPath; } $response = $this->request("\x47\105\124", "\x2f\137\x70\151\156\147"); return $response !== false && $response["\x73\164\141\x74\165\163"] === 200; } catch (\Exception $e) { $this->lastError = "\x43\x6f\x6e\x6e\x65\x63\x74\x69\157\156\x20\x66\141\151\x6c\145\144\72\40" . $e->getMessage(); logModuleCall("\144\157\x63\153\145\x72\x6e\70\x6e\137\141\x70\151", "\143\157\x6e\156\x65\143\x74\137\145\162\162\157\x72", compact("\x68\157\163\x74", "\160\x6f\162\x74"), $this->lastError, ''); return false; } } public function getLastError() { return $this->lastError; } public function createContainer($config) { try { $response = $this->request("\120\117\123\x54", "\x2f\143\157\156\x74\x61\x69\156\x65\x72\163\x2f\x63\162\145\x61\164\145", $config); if ($response && $response["\163\164\141\164\165\163"] === 201) { return json_decode($response["\142\157\x64\x79"], true); } $this->lastError = $response ? $response["\142\157\x64\x79"] : "\x46\141\x69\154\x65\x64\x20\x74\157\x20\x63\162\x65\141\x74\145\x20\143\157\156\164\141\151\156\x65\162"; return false; } catch (\Exception $e) { $this->lastError = "\x43\162\145\141\164\x65\40\143\x6f\156\164\141\151\156\x65\162\x20\x66\x61\x69\154\x65\x64\x3a\40" . $e->getMessage(); logModuleCall("\x64\x6f\143\153\x65\162\x6e\70\156\x5f\141\x70\151", "\x63\162\145\141\x74\145\137\145\162\162\157\162", $config, $this->lastError, ''); return false; } } public function startContainer($containerId) { try { $response = $this->request("\120\117\x53\x54", "\57\x63\x6f\x6e\164\x61\151\x6e\x65\162\163\x2f{$containerId}\57\x73\x74\141\x72\164"); return $response && ($response["\x73\164\x61\x74\165\163"] === 204 || $response["\x73\164\141\x74\165\x73"] === 304); } catch (\Exception $e) { $this->lastError = "\123\x74\141\162\164\40\x63\x6f\156\x74\x61\151\156\145\162\x20\146\141\151\154\x65\x64\72\x20" . $e->getMessage(); return false; } } public function stopContainer($containerId, $timeout = 10) { try { $response = $this->request("\120\117\x53\124", "\57\x63\x6f\156\164\x61\151\x6e\x65\162\x73\57{$containerId}\57\163\164\x6f\160\77\164\x3d{$timeout}"); return $response && ($response["\x73\x74\x61\x74\165\163"] === 204 || $response["\x73\x74\141\164\x75\x73"] === 304); } catch (\Exception $e) { $this->lastError = "\123\164\157\160\40\143\x6f\x6e\x74\141\151\156\x65\162\x20\x66\141\x69\x6c\145\x64\x3a\x20" . $e->getMessage(); return false; } } public function removeContainer($containerId, $force = false, $volumes = false) { try { $params = array(); if ($force) { $params[] = "\146\x6f\162\143\x65\75\x74\x72\x75\x65"; } if ($volumes) { $params[] = "\166\75\164\x72\165\145"; } $query = !empty($params) ? "\x3f" . implode("\46", $params) : ''; $response = $this->request("\x44\105\114\105\x54\105", "\57\x63\x6f\x6e\x74\x61\x69\x6e\x65\x72\x73\57{$containerId}{$query}"); return $response && ($response["\x73\164\141\x74\165\163"] === 204 || $response["\x73\164\x61\x74\x75\x73"] === 404); } catch (\Exception $e) { $this->lastError = "\x52\x65\155\x6f\166\x65\40\x63\157\156\164\x61\151\156\145\162\x20\146\x61\x69\154\x65\x64\72\x20" . $e->getMessage(); return false; } } public function inspectContainer($containerId) { try { $response = $this->request("\107\x45\x54", "\57\x63\157\156\x74\x61\151\156\x65\x72\163\x2f{$containerId}\57\x6a\163\x6f\156"); if ($response && $response["\163\x74\x61\164\x75\x73"] === 200) { return json_decode($response["\x62\x6f\x64\x79"], true); } return false; } catch (\Exception $e) { $this->lastError = "\x49\156\163\160\145\143\164\40\x66\141\x69\x6c\x65\x64\x3a\40" . $e->getMessage(); return false; } } public function getContainerLogs($containerId, $tail = 100) { try { $response = $this->request("\x47\105\x54", "\57\143\x6f\156\164\x61\x69\156\145\x72\163\x2f{$containerId}\57\x6c\157\x67\163\77\163\164\x64\x6f\165\164\x3d\164\162\165\145\46\x73\164\x64\x65\x72\x72\75\164\162\x75\x65\x26\x74\x61\151\154\75{$tail}"); if ($response && $response["\x73\x74\141\x74\165\x73"] === 200) { return $this->cleanDockerLogs($response["\142\157\x64\x79"]); } return false; } catch (\Exception $e) { $this->lastError = "\x47\x65\164\x20\x6c\x6f\x67\x73\40\146\141\x69\x6c\145\144\72\40" . $e->getMessage(); return false; } } public function getContainerStats($containerId) { try { $response = $this->request("\x47\x45\124", "\57\143\157\x6e\x74\141\x69\156\x65\x72\163\57{$containerId}\57\163\x74\141\x74\163\x3f\163\x74\162\145\141\x6d\75\146\x61\154\163\x65"); if ($response && $response["\163\x74\x61\164\165\x73"] === 200) { return json_decode($response["\x62\x6f\144\171"], true); } return false; } catch (\Exception $e) { $this->lastError = "\107\x65\164\40\x73\164\x61\164\163\40\x66\x61\151\154\x65\144\72\40" . $e->getMessage(); return false; } } public function listContainers($all = false, $filters = array()) { try { $params = array(); if ($all) { $params[] = "\x61\154\x6c\x3d\164\x72\165\145"; } if (!empty($filters)) { $params[] = "\146\x69\154\164\145\x72\x73\x3d" . urlencode(json_encode($filters)); } $query = !empty($params) ? "\x3f" . implode("\x26", $params) : ''; $response = $this->request("\x47\105\124", "\57\143\157\156\x74\x61\x69\156\145\162\x73\x2f\x6a\x73\157\156{$query}"); if ($response && $response["\163\x74\x61\x74\x75\x73"] === 200) { return json_decode($response["\x62\157\x64\171"], true); } return false; } catch (\Exception $e) { $this->lastError = "\x4c\151\163\164\x20\x63\x6f\x6e\x74\141\151\156\x65\x72\163\x20\146\x61\151\x6c\145\144\x3a\40" . $e->getMessage(); return false; } } public function pullImage($image) { try { $parts = explode("\x3a", $image); $repo = $parts[0]; $tag = isset($parts[1]) ? $parts[1] : "\x6c\141\164\x65\163\164"; $response = $this->request("\x50\117\123\x54", "\x2f\x69\x6d\x61\147\145\x73\57\x63\x72\145\141\164\145\77\x66\162\x6f\x6d\x49\155\141\x67\145\x3d{$repo}\46\x74\141\147\75{$tag}", null, 300); return $response && $response["\x73\x74\x61\164\165\x73"] === 200; } catch (\Exception $e) { $this->lastError = "\x50\x75\x6c\154\x20\x69\155\x61\147\145\x20\x66\141\151\154\x65\144\x3a\40" . $e->getMessage(); return false; } } public function createNetwork($name, $config = array()) { try { $data = array_merge(array("\116\x61\155\x65" => $name), $config); $response = $this->request("\120\x4f\123\124", "\57\156\145\x74\167\157\162\153\163\57\x63\162\x65\141\x74\145", $data); if ($response && $response["\x73\x74\141\164\x75\163"] === 201) { return json_decode($response["\x62\157\144\171"], true); } return false; } catch (\Exception $e) { $this->lastError = "\x43\162\x65\x61\164\145\x20\x6e\145\x74\x77\157\162\153\40\146\x61\151\154\145\144\72\x20" . $e->getMessage(); return false; } } public function execInContainer($containerId, $cmd) { try { $execConfig = array("\101\x74\x74\141\143\150\x53\164\x64\x6f\x75\164" => true, "\101\x74\x74\141\x63\150\123\x74\144\145\162\x72" => true, "\x43\x6d\144" => $cmd); $response = $this->request("\x50\117\123\x54", "\57\x63\x6f\x6e\x74\x61\x69\x6e\x65\x72\163\57{$containerId}\57\x65\170\x65\143", $execConfig); if (!$response || $response["\163\x74\141\x74\x75\163"] !== 201) { return false; } $execData = json_decode($response["\142\x6f\x64\x79"], true); $execId = $execData["\x49\144"]; $startConfig = array("\x44\x65\164\141\x63\x68" => false); $response = $this->request("\120\117\123\124", "\x2f\145\x78\145\x63\x2f{$execId}\x2f\163\164\x61\x72\164", $startConfig); if ($response && $response["\163\164\x61\164\x75\x73"] === 200) { return $this->cleanDockerLogs($response["\142\157\144\171"]); } return false; } catch (\Exception $e) { $this->lastError = "\105\x78\145\x63\x20\x66\141\151\154\x65\144\x3a\x20" . $e->getMessage(); return false; } } private function request($method, $endpoint, $data = null, $timeout = null) { try { $timeout = $timeout ?: $this->timeout; if (strpos($this->baseUrl, "\165\x6e\x69\x78\x3a\57\x2f") === 0) { return $this->requestUnixSocket($method, $endpoint, $data, $timeout); } else { return $this->requestTCP($method, $endpoint, $data, $timeout); } } catch (\Exception $e) { $this->lastError = "\x52\x65\x71\x75\145\163\164\40\x66\141\151\154\x65\144\72\x20" . $e->getMessage(); logModuleCall("\x64\157\143\153\145\162\156\70\x6e\137\x61\160\x69", "\x72\145\x71\x75\145\163\164\x5f\145\x72\x72\157\162", compact("\x6d\145\164\x68\x6f\x64", "\x65\x6e\x64\x70\x6f\151\156\x74"), $this->lastError, ''); return false; } } private function requestUnixSocket($method, $endpoint, $data, $timeout) { $socket = "\57\x76\x61\162\57\162\165\x6e\x2f\x64\157\143\153\145\x72\56\x73\157\x63\x6b"; if (!file_exists($socket)) { $this->lastError = "\104\x6f\143\153\145\x72\40\x73\x6f\143\x6b\145\x74\40\x6e\x6f\x74\x20\x66\157\165\156\144\x3a\x20{$socket}"; return false; } $headers = array("\x48\157\x73\164\72\x20\x6c\x6f\143\x61\154\x68\157\x73\164", "\x43\x6f\x6e\x74\x65\156\x74\x2d\x54\171\160\x65\x3a\x20\141\x70\x70\154\x69\143\141\x74\151\x6f\x6e\x2f\152\163\157\156"); $body = $data ? json_encode($data) : ''; $contentLength = strlen($body); if ($contentLength > 0) { $headers[] = "\x43\x6f\x6e\164\x65\x6e\x74\55\x4c\145\156\x67\x74\150\x3a\x20{$contentLength}"; } $request = "{$method}\40{$endpoint}\40\110\124\124\x50\57\x31\x2e\x31\xd\xa"; $request .= implode("\15\xa", $headers) . "\15\xa\xd\12"; $request .= $body; $fp = @fsockopen("\x75\156\151\170\72\x2f\57" . $socket, -1, $errno, $errstr, $timeout); if (!$fp) { $this->lastError = "\x46\x61\151\x6c\145\144\x20\164\157\40\x6f\x70\x65\x6e\x20\x73\x6f\143\153\x65\x74\x3a\40{$errstr}\x20\x28{$errno}\51"; return false; } fwrite($fp, $request); $response = ''; stream_set_timeout($fp, $timeout); while (!feof($fp)) { $response .= fgets($fp, 1024); } fclose($fp); return $this->parseHttpResponse($response); } private function requestTCP($method, $endpoint, $data, $timeout) { $url = $this->baseUrl . $endpoint; $ch = curl_init($url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_TIMEOUT, $timeout); curl_setopt($ch, CURLOPT_CUSTOMREQUEST, $method); if ($data !== null) { $json = json_encode($data); curl_setopt($ch, CURLOPT_POSTFIELDS, $json); curl_setopt($ch, CURLOPT_HTTPHEADER, array("\103\157\x6e\x74\145\156\164\55\x54\171\160\x65\72\40\141\x70\x70\154\151\x63\141\x74\151\157\x6e\57\152\163\x6f\156", "\x43\x6f\156\164\145\156\x74\55\x4c\x65\x6e\147\x74\x68\72\40" . strlen($json))); } if ($this->useTLS && !empty($this->certPath)) { curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($ch, CURLOPT_CAINFO, $this->certPath . "\x2f\143\x61\56\x70\145\155"); curl_setopt($ch, CURLOPT_SSLCERT, $this->certPath . "\57\x63\x65\x72\164\x2e\160\x65\x6d"); curl_setopt($ch, CURLOPT_SSLKEY, $this->certPath . "\x2f\153\145\171\56\160\x65\155"); } $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); $error = curl_error($ch); curl_close($ch); if ($error) { $this->lastError = "\x63\125\x52\x4c\x20\145\162\x72\x6f\162\72\x20{$error}"; return false; } return array("\x73\x74\141\164\165\x73" => $httpCode, "\142\x6f\x64\171" => $response); } private function parseHttpResponse($response) { $parts = explode("\15\xa\xd\xa", $response, 2); if (count($parts) < 2) { return false; } $headers = $parts[0]; $body = $parts[1]; preg_match("\57\110\x54\x54\x50\x5c\x2f\x5b\134\144\x2e\x5d\53\x5c\x73\53\x28\x5c\144\53\51\57", $headers, $matches); $status = isset($matches[1]) ? (int) $matches[1] : 0; return array("\163\164\x61\164\165\163" => $status, "\x62\x6f\x64\171" => $body); } private function cleanDockerLogs($raw) { $clean = preg_replace("\x2f\x5b\x5c\170\x30\60\x2d\x5c\x78\60\x38\135\57", '', $raw); return trim($clean); } }