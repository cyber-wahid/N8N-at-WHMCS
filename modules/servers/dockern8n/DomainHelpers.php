<?php
 goto Ab5a9; BEP2S: function dockern8n_GenerateDomain($params, $mainDomain = '', $subdomainFormat = '') { $serviceId = $params["\x73\145\162\166\x69\143\145\151\x64"]; $userId = $params["\x75\163\x65\x72\151\144"] ?? $params["\x63\154\x69\x65\156\x74\x73\144\x65\x74\141\x69\x6c\163"]["\165\x73\x65\162\151\144"] ?? 0; $customDomain = $params["\x64\157\155\141\151\156"] ?? ''; if (!empty($customDomain) && $customDomain !== "\x64\x6f\x6d\141\x69\156\x2e\143\157\155" && $customDomain !== '') { $customDomain = preg_replace("\43\x5e\150\x74\x74\x70\163\77\x3a\57\x2f\x23", '', $customDomain); $customDomain = rtrim($customDomain, "\x2f"); $customDomain = strtolower(trim($customDomain)); if (preg_match("\57\x5e\x5b\x61\55\x7a\60\55\71\134\55\134\56\x5d\53\x5c\56\133\x61\55\x7a\x5d\173\62\x2c\x7d\44\57\151", $customDomain)) { return $customDomain; } } if (empty($mainDomain)) { $mainDomain = $params["\163\x65\162\166\x65\x72\x68\x6f\163\164\156\x61\155\x65"] ?? "\154\x6f\143\141\154\150\x6f\x73\164"; } if (empty($subdomainFormat)) { $subdomainFormat = "\173\165\163\145\x72\x5f\151\x64\x7d\55\x7b\163\x65\x72\x76\x69\x63\145\137\x69\x64\175"; } $subdomain = dockern8n_ParseDomainMacros($subdomainFormat, $userId, $serviceId); $fullDomain = $subdomain . "\56" . $mainDomain; return strtolower($fullDomain); } goto FGA6d; Ab5a9: if (!defined("\127\110\x4d\x43\x53")) { die("\124\x68\151\x73\40\x66\151\x6c\x65\40\x63\141\x6e\156\x6f\164\x20\x62\145\x20\141\143\x63\145\163\163\x65\144\x20\x64\x69\162\145\143\x74\154\x79"); } goto qOGBz; FGA6d: function dockern8n_DomainExists($domain, $excludeServiceId = 0) { try { $query = \WHMCS\Database\Capsule::table("\164\142\x6c\150\x6f\x73\164\x69\x6e\147")->where("\x64\157\155\141\x69\x6e", $domain); if ($excludeServiceId > 0) { $query->where("\x69\144", "\x21\75", $excludeServiceId); } return $query->exists(); } catch (\Exception $e) { logModuleCall("\x64\x6f\143\x6b\145\x72\156\x38\156", "\x64\x6f\155\x61\x69\156\x5f\x65\170\x69\163\x74\x73\x5f\143\x68\145\x63\153\x5f\x65\162\162\157\162", compact("\144\x6f\x6d\x61\151\156"), $e->getMessage(), ''); return false; } } goto rZjQP; uOZbT: function dockern8n_ValidateDomain($domain) { if (empty($domain) || strlen($domain) > 253) { return false; } if (!preg_match("\57\136\133\141\55\172\60\x2d\x39\134\x2d\x5c\x2e\x5d\x2b\134\x2e\133\141\55\172\135\173\x32\54\175\44\57\x69", $domain)) { return false; } if (preg_match("\x2f\x5c\x2e\x5c\56\x2f", $domain) || preg_match("\57\x5e\55\x7c\55\x24\57", $domain)) { return false; } return true; } goto NwD2y; rZjQP: function dockern8n_EnsureUniqueDomain($domain, $serviceId) { $originalDomain = $domain; $attempts = 0; $maxAttempts = 10; while (dockern8n_DomainExists($domain, $serviceId) && $attempts < $maxAttempts) { $attempts++; $parts = explode("\56", $originalDomain); $subdomain = $parts[0]; $baseDomain = implode("\56", array_slice($parts, 1)); $randomSuffix = substr(md5(uniqid()), 0, 4); $domain = "{$subdomain}\55{$randomSuffix}\56{$baseDomain}"; } if ($attempts >= $maxAttempts) { $parts = explode("\x2e", $originalDomain); $baseDomain = implode("\x2e", array_slice($parts, 1)); $domain = "\163\x65\162\166\151\143\145\55{$serviceId}\x2d" . time() . "\56{$baseDomain}"; } return $domain; } goto uOZbT; qOGBz: function dockern8n_ParseDomainMacros($format, $userId, $serviceId) { $subdomain = $format; $subdomain = str_replace("\173\165\163\145\x72\137\151\x64\x7d", $userId, $subdomain); $subdomain = str_replace("\x7b\163\145\x72\166\x69\143\x65\x5f\x69\x64\175", $serviceId, $subdomain); $subdomain = str_replace("\x7b\171\145\141\x72\x7d", date("\x59"), $subdomain); $subdomain = str_replace("\173\155\x6f\156\x74\x68\175", date("\155"), $subdomain); $subdomain = str_replace("\x7b\x64\x61\x79\x7d", date("\x64"), $subdomain); $subdomain = str_replace("\173\x68\x6f\165\162\x7d", date("\x48"), $subdomain); $subdomain = str_replace("\x7b\x6d\x69\156\x75\164\x65\175", date("\x69"), $subdomain); $subdomain = str_replace("\x7b\163\145\143\x6f\x6e\x64\175", date("\x73"), $subdomain); $subdomain = str_replace("\173\165\156\x69\x78\x74\x69\155\x65\175", time(), $subdomain); $subdomain = preg_replace_callback("\57\x5c\173\x72\x61\x6e\x64\x6f\155\137\x64\x69\x67\x69\x74\137\50\x5c\x64\53\x29\x5c\x7d\57", function ($matches) { $length = (int) $matches[1]; $max = (int) str_repeat("\x39", $length); $min = (int) str_repeat("\61", max(1, $length - 1)) . "\60"; return str_pad(rand($min, $max), $length, "\x30", STR_PAD_LEFT); }, $subdomain); $subdomain = preg_replace_callback("\57\134\173\162\141\x6e\x64\x6f\x6d\137\x6c\145\164\164\x65\x72\x5f\50\134\144\x2b\x29\134\175\x2f", function ($matches) { $length = (int) $matches[1]; $chars = "\141\x62\143\144\145\146\147\150\151\152\x6b\x6c\155\x6e\x6f\160\x71\162\163\164\x75\x76\167\x78\171\172"; $result = ''; for ($i = 0; $i < $length; $i++) { $result .= $chars[rand(0, strlen($chars) - 1)]; } return $result; }, $subdomain); $subdomain = strtolower($subdomain); $subdomain = preg_replace("\x2f\x5b\136\x61\55\172\x30\55\71\134\55\x5d\57", "\x2d", $subdomain); $subdomain = preg_replace("\x2f\55\53\x2f", "\55", $subdomain); $subdomain = trim($subdomain, "\x2d"); return $subdomain; } goto BEP2S; NwD2y: function dockern8n_GetServiceDirectory($domain, $serviceId, $preferNew = true) { if ($preferNew) { $cleanDomain = preg_replace("\57\133\x5e\141\55\172\x30\x2d\x39\134\x2d\134\x2e\135\57", '', strtolower($domain)); return "\57\x6f\160\x74\x2f\x64\x6f\143\x6b\145\162\57\143\154\151\x65\x6e\x74\163\x2f{$cleanDomain}"; } else { return "\57\x76\141\162\57\x77\x77\x77\x2f\144\x6f\x63\153\145\162\156\x38\156\57\163\145\x72\166\x69\143\x65\x2d{$serviceId}"; } }